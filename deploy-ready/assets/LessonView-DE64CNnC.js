import{u as me,r as k,e as P,V as le,f as Q,j as e,S as xe,M as ve,a5 as ue,an as we,ao as Ce,T as oe,C as Se,h as ge,$ as ie,a0 as ke,a1 as Ee,ap as pe,aq as he,D as V,ar as ce,z as Le,k as Re,ag as $e,d as Ae,as as Te,at as De,au as Z,s as be,L as q,aj as Ie,ak as Oe,aa as fe}from"./vendor-D1Bc63Il.js";import{u as je,c as Me,R,C as Ne,a as S}from"./index-DmfLGNEk.js";import{a as Ue,b as Pe}from"./courseUtils-Bo8LqfoL.js";const ze=t=>{const i=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/,a=t.match(i);return a&&a[2].length===11?a[2]:null},_e=t=>{const i=/(?:vimeo\.com\/|player\.vimeo\.com\/video\/)(\d+)/,a=t.match(i);return a?a[1]:null},Fe=t=>{const i=/drive\.google\.com\/file\/d\/([a-zA-Z0-9_-]+)/,a=t.match(i);return a?a[1]:null},ye=t=>{if(!t)return"other";const i=t.toLowerCase();return i.includes("youtube.com")||i.includes("youtu.be")?"youtube":i.includes("vimeo.com")?"vimeo":i.includes("drive.google.com")?"google-drive":i.includes("vk.com/video")?"vk":/\.(mp4|webm|ogg|mov|avi|wmv|flv)(\?.*)?$/i.test(t)?"direct":"other"},Ve=t=>{if(!t)return null;switch(ye(t)){case"youtube":{const a=ze(t);return a?`https://www.youtube.com/embed/${a}`:null}case"vimeo":{const a=_e(t);return a?`https://player.vimeo.com/video/${a}`:null}case"google-drive":{const a=Fe(t);return a?`https://drive.google.com/file/d/${a}/preview`:null}case"vk":return t;case"direct":case"other":return t;default:return t}},de=ke({content:Ee().min(1,"–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º").max(1e3,"–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π")});function Qe({lessonId:t}){const{user:i}=je(),a=me(),{socket:o}=Me(),[D,v]=k.useState(null),[A,g]=k.useState(null),[E,j]=k.useState(1),[I,O]=k.useState({isOpen:!1,commentId:null});k.useEffect(()=>{if(o)return o.emit("join-lesson",t),o.on("new-comment",()=>{a.invalidateQueries(["comments",t])}),()=>{o&&(o.emit("leave-lesson",t),o.off("new-comment"))}},[o,t,a]);const{data:L,isLoading:_}=P(["comments",t,E],async()=>(await S.get(`/comments/lesson/${t}?page=${E}&limit=10`)).data,{refetchOnWindowFocus:!1}),M=L?.data?.comments||[],w=L?.data?.pagination,{register:r,handleSubmit:y,reset:N,formState:{errors:c}}=le({resolver:ie(de)}),{register:d,handleSubmit:x,reset:h,formState:{errors:T}}=le({resolver:ie(de)}),{register:H,handleSubmit:ee,reset:K,formState:{errors:X},setValue:se}=le({resolver:ie(de)}),z=Q(async l=>(await S.post(`/comments/lesson/${t}`,l)).data,{onSuccess:()=>{a.invalidateQueries(["comments",t]),N(),v(null),h(),E!==1&&j(1)}}),te=Q(async l=>{await S.delete(`/comments/${l}`)},{onSuccess:()=>{a.invalidateQueries(["comments",t])}}),J=Q(async l=>(await S.put(`/comments/${l.commentId}`,{content:l.content})).data,{onSuccess:()=>{a.invalidateQueries(["comments",t]),g(null),K()}}),$=l=>{z.mutate(l)},G=(l,b)=>{z.mutate({...l,parentId:b})},re=(l,b)=>{J.mutate({commentId:b,content:l.content})},Y=l=>{g(l.id),se("content",l.content)},ae=l=>{if(!i||l.userId!==i.id)return!1;const b=Date.now()-new Date(l.createdAt).getTime(),ne=15*60*1e3;return b<=ne},B=l=>i?l.userId===i.id||i.role===R.TEACHER||i.role===R.ADMIN:!1,W=l=>i?i.role===R.TEACHER||i.role===R.ADMIN||i.role===R.CURATOR:!1;return e.jsxs("div",{className:"card p-6 md:p-8 animate-fade-scale",style:{animationDelay:"0.4s"},children:[e.jsx("h2",{className:"text-xl md:text-2xl font-semibold text-neutral-900 mb-6",children:"–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –≤–æ–ø—Ä–æ—Å—ã"}),i?.role===R.STUDENT&&e.jsx("form",{onSubmit:y($),className:"mb-6",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("textarea",{...r("content"),placeholder:"–û—Å—Ç–∞–≤—å—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∏–ª–∏ –≤–æ–ø—Ä–æ—Å...",className:"input-field resize-none",rows:3}),c.content&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.content.message})]}),e.jsx("button",{type:"submit",disabled:z.isLoading,className:"btn-primary px-6 py-3 h-fit disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:z.isLoading?e.jsx("span",{className:"animate-spin",children:"‚ü≥"}):e.jsx(xe,{className:"h-5 w-5"})})]})}),_?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-4 border-primary-200 border-t-primary-500"}),e.jsx("p",{className:"mt-4 text-neutral-600",children:"–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤..."})]}):M.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ve,{className:"mx-auto h-12 w-12 text-neutral-400 mb-4"}),e.jsx("p",{className:"text-neutral-600",children:"–ù–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤"}),e.jsx("p",{className:"text-sm text-neutral-500 mt-2",children:"–ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º, –∫—Ç–æ –æ—Å—Ç–∞–≤–∏—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π!"})]}):e.jsxs("div",{className:"space-y-4",children:[M.map(l=>e.jsxs("div",{className:"border border-neutral-200 rounded-lg p-4 bg-white animate-slide-in hover:shadow-sm transition-shadow",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-full bg-gradient-primary text-white flex items-center justify-center font-bold",children:l.user?.firstName?.[0]||"U"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("span",{className:"font-semibold text-neutral-900",children:[l.user?.firstName," ",l.user?.lastName]}),(l.user?.role===R.TEACHER||l.user?.role===R.ADMIN||l.user?.role===R.CURATOR)&&e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-primary-100 text-primary-700 border border-primary-200 font-medium",children:"–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å"})]}),A===l.id?e.jsxs("form",{onSubmit:ee(b=>re(b,l.id)),className:"mb-2",children:[e.jsx("textarea",{...H("content"),className:"input-field text-sm resize-none",rows:3}),X.content&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:X.content.message}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{type:"submit",disabled:J.isLoading,className:"btn-primary px-3 py-1 text-sm disabled:opacity-50",children:"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"}),e.jsx("button",{type:"button",onClick:()=>{g(null),K()},className:"btn-secondary px-3 py-1 text-sm",children:"–û—Ç–º–µ–Ω–∞"})]})]}):e.jsx("p",{className:"text-neutral-700 text-sm mb-2 whitespace-pre-wrap",dangerouslySetInnerHTML:{__html:ue.sanitize(l.content,{ALLOWED_TAGS:[]})}}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-neutral-500",children:[e.jsx("span",{children:new Date(l.createdAt).toLocaleString("ru-RU")}),ae(l)&&A!==l.id&&e.jsxs("button",{onClick:()=>Y(l),className:"text-primary-600 hover:text-primary-700 transition-colors flex items-center gap-1",children:[e.jsx(we,{size:14}),e.jsx("span",{children:"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"})]}),W()&&e.jsxs("button",{onClick:()=>v(D===l.id?null:l.id),className:"text-primary-600 hover:text-primary-700 transition-colors flex items-center gap-1",children:[e.jsx(Ce,{size:14}),e.jsx("span",{children:"–û—Ç–≤–µ—Ç–∏—Ç—å"})]}),B(l)&&e.jsxs("button",{onClick:()=>O({isOpen:!0,commentId:l.id}),className:"text-red-600 hover:text-red-700 transition-colors flex items-center gap-1",children:[e.jsx(oe,{size:14}),e.jsx("span",{children:"–£–¥–∞–ª–∏—Ç—å"})]})]})]})]}),D===l.id&&W()&&e.jsxs("form",{onSubmit:x(b=>G(b,l.id)),className:"mt-3 ml-12 md:ml-14 border-l-2 border-primary-300 pl-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("textarea",{...d("content"),placeholder:"–û—Ç–≤–µ—Ç–∏—Ç—å...",className:"input-field flex-1 text-sm resize-none",rows:2}),e.jsx("button",{type:"submit",disabled:z.isLoading,className:"btn-primary px-4 py-2 h-fit disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:z.isLoading?e.jsx("span",{className:"animate-spin",children:"‚ü≥"}):e.jsx(xe,{className:"h-4 w-4"})})]}),T.content&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:T.content.message})]}),l.replies&&l.replies.length>0&&e.jsx("div",{className:"mt-3 ml-12 md:ml-14 space-y-3 border-l-2 border-primary-200 pl-4",children:l.replies.map(b=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-gradient-primary text-white flex items-center justify-center font-bold text-sm",children:b.user?.firstName?.[0]||"T"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("span",{className:"font-semibold text-neutral-900 text-sm",children:[b.user?.firstName," ",b.user?.lastName]}),(b.user?.role===R.TEACHER||b.user?.role===R.ADMIN||b.user?.role===R.CURATOR)&&e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded-full bg-primary-100 text-primary-700 border border-primary-200 font-medium",children:"–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å"})]}),e.jsx("p",{className:"text-neutral-700 text-sm mb-1 whitespace-pre-wrap",dangerouslySetInnerHTML:{__html:ue.sanitize(b.content,{ALLOWED_TAGS:[]})}}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-neutral-500",children:[e.jsx("span",{children:new Date(b.createdAt).toLocaleString("ru-RU")}),B(b)&&e.jsxs("button",{onClick:()=>O({isOpen:!0,commentId:b.id}),className:"text-red-600 hover:text-red-700 transition-colors flex items-center gap-1",children:[e.jsx(oe,{size:12}),e.jsx("span",{children:"–£–¥–∞–ª–∏—Ç—å"})]})]})]})]},b.id))})]},l.id)),w&&w.totalPages>1&&e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between mt-6 pt-6 border-t border-neutral-200 gap-4",children:[e.jsxs("div",{className:"text-sm text-neutral-600",children:["–ü–æ–∫–∞–∑–∞–Ω–æ ",(w.page-1)*w.limit+1,"-",Math.min(w.page*w.limit,w.total)," –∏–∑ ",w.total," –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>j(E-1),disabled:E===1,className:"btn-secondary px-4 py-2 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 transition-all",title:"–ü—Ä–µ–¥—ã–¥—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞",children:[e.jsx(Se,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"–ù–∞–∑–∞–¥"})]}),e.jsxs("div",{className:"flex items-center gap-1 px-3 py-2 bg-primary-50 rounded-lg border border-primary-200",children:[e.jsx("span",{className:"text-sm font-semibold text-primary-700",children:w.page}),e.jsx("span",{className:"text-sm text-primary-500",children:"/"}),e.jsx("span",{className:"text-sm text-primary-600",children:w.totalPages})]}),e.jsxs("button",{onClick:()=>j(E+1),disabled:!w.hasMore,className:"btn-secondary px-4 py-2 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 transition-all",title:"–°–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞",children:[e.jsx("span",{className:"hidden sm:inline",children:"–í–ø–µ—Ä–µ–¥"}),e.jsx(ge,{size:16})]})]})]})]}),e.jsx(Ne,{isOpen:I.isOpen,onClose:()=>O({isOpen:!1,commentId:null}),onConfirm:()=>{I.commentId&&te.mutate(I.commentId)},title:"–£–¥–∞–ª–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π",message:"–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.",confirmText:"–£–¥–∞–ª–∏—Ç—å",cancelText:"–û—Ç–º–µ–Ω–∞",variant:"danger"})]})}function Be({question:t,onAnswer:i,showResult:a,correctAnswer:o}){const[D,v]=k.useState([]),[A,g]=k.useState([]),[E,j]=k.useState([]),[I,O]=k.useState({});k.useEffect(()=>{if(t.metadata){const c=JSON.parse(t.metadata);t.type==="DRAG_DROP"?(v([...c.items]),g(c.targets.map(()=>null))):t.type==="MATCHING"&&j(c.leftItems.map(d=>({left:d,right:null})))}},[t]);const L=(c,d)=>{c.dataTransfer.setData("text/plain",d)},_=(c,d)=>{c.preventDefault();const x=c.dataTransfer.getData("text/plain"),h=[...A];h[d]=x,g(h),v(D.filter(T=>T!==x)),i(h)},M=c=>{c.preventDefault()},w=(c,d)=>{const x=[...E];x[c].right=d,j(x),i(x)},r=(c,d)=>{O({...I,[c]:d}),i(I)},y=()=>{if(t.metadata){const c=JSON.parse(t.metadata);v([...c.items]),g(c.targets.map(()=>null))}},N=()=>{if(t.metadata){const c=JSON.parse(t.metadata);j(c.leftItems.map(d=>({left:d,right:null})))}};if(t.type==="DRAG_DROP"){const c=t.metadata?JSON.parse(t.metadata):null;return c?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-900 mb-4",children:t.question}),e.jsxs("button",{onClick:y,className:"text-sm text-primary-600 hover:text-primary-700 mb-4 flex items-center gap-1",children:[e.jsx(pe,{className:"h-4 w-4"}),"–°–±—Ä–æ—Å–∏—Ç—å"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-neutral-700 mb-3",children:"–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —ç–ª–µ–º–µ–Ω—Ç—ã:"}),e.jsx("div",{className:"space-y-2",children:D.map((d,x)=>e.jsx("div",{draggable:!0,onDragStart:h=>L(h,d),className:"p-3 bg-primary-100 text-primary-900 rounded-lg cursor-move hover:bg-primary-200 transition-colors",children:d},x))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-neutral-700 mb-3",children:"–¶–µ–ª–µ–≤—ã–µ –æ–±–ª–∞—Å—Ç–∏:"}),e.jsx("div",{className:"space-y-2",children:c.targets.map((d,x)=>e.jsx("div",{onDrop:h=>_(h,x),onDragOver:M,className:`p-3 border-2 border-dashed rounded-lg min-h-[50px] flex items-center ${A[x]?"border-primary-500 bg-primary-50":"border-neutral-300"}`,children:A[x]?e.jsx("span",{className:"text-primary-900 font-medium",children:A[x]}):e.jsx("span",{className:"text-neutral-400",children:d})},x))})]})]}),a&&o&&e.jsx("div",{className:"mt-4 p-4 rounded-lg bg-neutral-50",children:e.jsxs("p",{className:"text-sm text-neutral-600",children:["–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: ",JSON.stringify(o)]})})]}):null}if(t.type==="MATCHING"){const c=t.metadata?JSON.parse(t.metadata):null;return c?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-900 mb-4",children:t.question}),e.jsxs("button",{onClick:N,className:"text-sm text-primary-600 hover:text-primary-700 mb-4 flex items-center gap-1",children:[e.jsx(pe,{className:"h-4 w-4"}),"–°–±—Ä–æ—Å–∏—Ç—å"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-neutral-700 mb-3",children:"–õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞:"}),e.jsx("div",{className:"space-y-2",children:E.map((d,x)=>e.jsx("div",{className:`p-3 rounded-lg border-2 ${d.right?"border-primary-500 bg-primary-50":"border-neutral-300 bg-neutral-50"}`,children:d.left},x))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-neutral-700 mb-3",children:"–ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞:"}),e.jsx("div",{className:"space-y-2",children:c.rightItems.map((d,x)=>{const h=E.some(T=>T.right===d);return e.jsx("button",{onClick:()=>{const T=E.findIndex(H=>!H.right);T!==-1&&!h&&w(T,d)},disabled:h,className:`w-full p-3 rounded-lg border-2 text-left transition-colors ${h?"border-primary-500 bg-primary-50 cursor-not-allowed":"border-neutral-300 hover:border-primary-300 hover:bg-primary-50"}`,children:d},x)})})]})]}),a&&o&&e.jsx("div",{className:"mt-4 p-4 rounded-lg bg-neutral-50",children:e.jsxs("p",{className:"text-sm text-neutral-600",children:["–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–∞—Ä—ã: ",JSON.stringify(o)]})})]}):null}if(t.type==="FILL_BLANK"){const c=t.metadata?JSON.parse(t.metadata):null;if(!c)return null;const d=c.text.split("___");return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-900 mb-4",children:t.question}),e.jsx("div",{className:"p-4 bg-neutral-50 rounded-lg",children:d.map((x,h)=>e.jsxs("span",{children:[x,h<d.length-1&&e.jsx("input",{type:"text",value:I[h]||"",onChange:T=>r(h,T.target.value),className:"inline-block mx-2 px-2 py-1 border-2 border-primary-300 rounded focus:outline-none focus:border-primary-500 min-w-[100px]",placeholder:"..."})]},h))}),a&&o&&e.jsx("div",{className:"mt-4 p-4 rounded-lg bg-neutral-50",children:e.jsxs("p",{className:"text-sm text-neutral-600",children:["–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: ",JSON.stringify(o)]})})]})}return null}function He({lessonId:t,onComplete:i}){const a=me(),[o,D]=k.useState({}),[v,A]=k.useState(!1),[g,E]=k.useState(null),{data:j,isLoading:I}=P(["quiz",t],async()=>(await S.get(`/quizzes/lesson/${t}`)).data.data,{enabled:!!t}),O=Q(async r=>(await S.post(`/quizzes/lesson/${t}/submit`,{answers:r})).data.data,{onSuccess:r=>{E(r),A(!0),a.invalidateQueries(["quiz",t]),i&&i(r)}}),L=(r,y)=>{D(N=>({...N,[r]:typeof y=="string"?y:JSON.stringify(y)}))},_=()=>{if(j&&Object.keys(o).length===j.questions.length){const r={};Object.keys(o).forEach(y=>{r[y]=o[y]}),O.mutate(r)}};if(I)return e.jsxs("div",{className:"card p-6 text-center",children:[e.jsx(he,{className:"h-8 w-8 animate-spin text-primary-500 mx-auto mb-4"}),e.jsx("p",{className:"text-neutral-600",children:"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ—Å—Ç–∞..."})]});if(!j)return null;const M=Object.keys(o).length===j.questions.length,w=M&&!v&&!O.isLoading;return e.jsxs("div",{className:"card p-6 md:p-8 animate-fade-scale",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl md:text-3xl font-bold text-gradient mb-2",children:j.title||"–¢–µ—Å—Ç –ø–æ —É—Ä–æ–∫—É"}),j.description&&e.jsx("p",{className:"text-neutral-600 mb-4",children:j.description}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-neutral-500",children:[e.jsxs("span",{children:["–í–æ–ø—Ä–æ—Å–æ–≤: ",j.questions.length]}),e.jsxs("span",{children:["–ü—Ä–æ—Ö–æ–¥–Ω–æ–π –±–∞–ª–ª: ",j.passingScore,"%"]})]})]}),v&&g?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:`p-6 rounded-lg border-2 ${g.passed?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[g.passed?e.jsx(V,{className:"h-8 w-8 text-green-600"}):e.jsx(ce,{className:"h-8 w-8 text-red-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:`text-xl font-bold ${g.passed?"text-green-700":"text-red-700"}`,children:g.passed?"–¢–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω!":"–¢–µ—Å—Ç –Ω–µ –ø—Ä–æ–π–¥–µ–Ω"}),e.jsxs("p",{className:`text-sm ${g.passed?"text-green-600":"text-red-600"}`,children:["–í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç: ",g.score,"%"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-neutral-600",children:"–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤:"}),e.jsxs("span",{className:"font-semibold",children:[g.correctAnswers," –∏–∑ ",g.totalQuestions]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-neutral-600",children:"–ü—Ä–æ—Ö–æ–¥–Ω–æ–π –±–∞–ª–ª:"}),e.jsxs("span",{className:"font-semibold",children:[g.passingScore,"%"]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-900",children:"–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã:"}),j.questions.map((r,y)=>{const N=o[r.id],c=r.type==="MULTIPLE_CHOICE"?r.options?.find(d=>d.id===N)?.isCorrect:N===r.correctAnswer;return e.jsx("div",{className:`p-4 rounded-lg border-2 ${c?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:e.jsxs("div",{className:"flex items-start gap-2 mb-3",children:[c?e.jsx(V,{className:"h-5 w-5 text-green-600 mt-0.5 flex-shrink-0"}):e.jsx(ce,{className:"h-5 w-5 text-red-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-semibold text-neutral-900 mb-2",children:[y+1,". ",r.question]}),r.type==="MULTIPLE_CHOICE"&&r.options&&e.jsx("div",{className:"space-y-2",children:r.options.map(d=>{const x=d.id===N,h=d.isCorrect;return e.jsx("div",{className:`p-2 rounded ${h?"bg-green-100 border-2 border-green-300":x?"bg-red-100 border-2 border-red-300":"bg-neutral-50 border border-neutral-200"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[h&&e.jsx(V,{className:"h-4 w-4 text-green-600"}),x&&!h&&e.jsx(ce,{className:"h-4 w-4 text-red-600"}),e.jsx("span",{className:h?"font-semibold text-green-700":x?"text-red-700":"text-neutral-700",children:d.text})]})},d.id)})}),r.type==="TRUE_FALSE"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:`p-2 rounded ${r.correctAnswer==="true"?"bg-green-100 border-2 border-green-300":"bg-neutral-50 border border-neutral-200"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[r.correctAnswer==="true"&&e.jsx(V,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:r.correctAnswer==="true"?"font-semibold text-green-700":"text-neutral-700",children:"–í–µ—Ä–Ω–æ"})]})}),e.jsx("div",{className:`p-2 rounded ${r.correctAnswer==="false"?"bg-green-100 border-2 border-green-300":"bg-neutral-50 border border-neutral-200"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[r.correctAnswer==="false"&&e.jsx(V,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:r.correctAnswer==="false"?"font-semibold text-green-700":"text-neutral-700",children:"–ù–µ–≤–µ—Ä–Ω–æ"})]})})]})]})]})},r.id)})]})]}):e.jsxs("div",{className:"space-y-6",children:[j.questions.map((r,y)=>e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-gradient-primary text-white font-semibold flex-shrink-0",children:y+1}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-neutral-900 mb-3",children:r.question}),r.type==="MULTIPLE_CHOICE"&&r.options&&e.jsx("div",{className:"space-y-2",children:r.options.map(N=>e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg border-2 cursor-pointer transition-all ${o[r.id]===N.id?"border-primary-500 bg-primary-50":"border-neutral-200 hover:border-primary-300 hover:bg-neutral-50"}`,children:[e.jsx("input",{type:"radio",name:r.id,value:N.id,checked:o[r.id]===N.id,onChange:()=>L(r.id,N.id),className:"w-4 h-4 text-primary-500 focus:ring-primary-500"}),e.jsx("span",{className:"text-neutral-700",children:N.text})]},N.id))}),r.type==="TRUE_FALSE"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg border-2 cursor-pointer transition-all ${o[r.id]==="true"?"border-primary-500 bg-primary-50":"border-neutral-200 hover:border-primary-300 hover:bg-neutral-50"}`,children:[e.jsx("input",{type:"radio",name:r.id,value:"true",checked:o[r.id]==="true",onChange:()=>L(r.id,"true"),className:"w-4 h-4 text-primary-500 focus:ring-primary-500"}),e.jsx("span",{className:"text-neutral-700",children:"–í–µ—Ä–Ω–æ"})]}),e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg border-2 cursor-pointer transition-all ${o[r.id]==="false"?"border-primary-500 bg-primary-50":"border-neutral-200 hover:border-primary-300 hover:bg-neutral-50"}`,children:[e.jsx("input",{type:"radio",name:r.id,value:"false",checked:o[r.id]==="false",onChange:()=>L(r.id,"false"),className:"w-4 h-4 text-primary-500 focus:ring-primary-500"}),e.jsx("span",{className:"text-neutral-700",children:"–ù–µ–≤–µ—Ä–Ω–æ"})]})]}),(r.type==="DRAG_DROP"||r.type==="MATCHING"||r.type==="FILL_BLANK")&&e.jsx(Be,{question:r,onAnswer:N=>L(r.id,N),showResult:v,correctAnswer:r.correctAnswer?JSON.parse(r.correctAnswer):void 0})]})]})},r.id)),e.jsxs("div",{className:"pt-4 border-t border-neutral-200",children:[!M&&e.jsxs("div",{className:"flex items-center gap-2 text-amber-600 mb-4",children:[e.jsx(Le,{className:"h-5 w-5"}),e.jsx("span",{className:"text-sm",children:"–û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç–µ—Å—Ç–∞"})]}),e.jsx("button",{onClick:_,disabled:!w,className:"btn-primary w-full md:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:O.isLoading?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-5 w-5 animate-spin"}),e.jsx("span",{children:"–û—Ç–ø—Ä–∞–≤–∫–∞..."})]}):"–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ—Å—Ç"})]})]})]})}function Ke(){const{t}=Re(),{courseId:i,lessonId:a}=$e(),o=Ae(),D=me(),{user:v}=je(),[A,g]=k.useState({isOpen:!1,fileId:null}),[E,j]=k.useState(new Set),[I,O]=k.useState(null),{data:L,isLoading:_,error:M}=P(["lesson",a],async()=>(await S.get(`/lessons/${a}`)).data.data,{enabled:!!a,retry:1}),{data:w}=P(["course",i],async()=>(await S.get(`/courses/${i}`)).data.data,{enabled:!!i}),{data:r}=P(["modules",i],async()=>(await S.get(`/modules/courses/${i}/modules`)).data.data||[],{enabled:!!i}),{data:y}=P(["courseLessons",i],async()=>(await S.get(`/courses/${i}/lessons`)).data.data||[],{enabled:!!i}),{data:N}=P(["practiceExercises",a],async()=>{try{return(await S.get(`/practice/lessons/${a}`)).data.data||[]}catch{return[]}},{enabled:!!a}),{data:c}=P(["flashcardDecks",a],async()=>{try{return(await S.get("/flashcards",{params:{lessonId:a}})).data.data||[]}catch{return[]}},{enabled:!!a}),{data:d}=P(["integrations",a],async()=>{try{return(await S.get("/integrations",{params:{lessonId:a}})).data.data||[]}catch{return[]}},{enabled:!!a}),x=Q(async s=>(await S.put(`/lessons/${a}/progress`,s)).data,{onSuccess:()=>{D.invalidateQueries(["lesson",a]),D.invalidateQueries(["courseLessons",i])}}),h=Q(async s=>{try{await S.post(`/lessons/${a}/feedback`,{rating:s})}catch{console.log("Feedback endpoint not implemented yet")}},{onSuccess:()=>{}}),T=Q(async s=>{await S.delete(`/files/${s}`)},{onSuccess:()=>{D.invalidateQueries(["lesson",a]),g({isOpen:!1,fileId:null})}}),H=s=>v?v.role===R.TEACHER||v.role===R.ADMIN||v.role===R.CURATOR:!1,ee=async(s,p,f)=>{s.preventDefault(),s.stopPropagation(),s.nativeEvent&&s.nativeEvent.stopImmediatePropagation();try{let u=f;try{if(/[ƒê√ë‚Ç¨√ê¬£]/.test(f)){const n=new Uint8Array(f.length);for(let m=0;m<f.length;m++)n[m]=f.charCodeAt(m)&255;u=new TextDecoder("utf-8",{fatal:!1}).decode(n),/[ƒê√ë‚Ç¨√ê¬£]/.test(u)&&(u=decodeURIComponent(escape(f)))}else if(f.includes("%"))try{u=decodeURIComponent(f)}catch{u=f}}catch{u=f}if(p.includes("supabase.co")||p.includes("cloudinary.com")||p.startsWith("http")&&!p.includes("/api/files/"))try{const n=await fetch(p,{mode:"cors"});if(!n.ok)throw new Error("Failed to fetch file");const m=await n.blob(),U=window.URL.createObjectURL(m),C=document.createElement("a");C.href=U,C.download=u,C.style.display="none",document.body.appendChild(C),C.click(),setTimeout(()=>{document.body.contains(C)&&document.body.removeChild(C),window.URL.revokeObjectURL(U)},100)}catch(n){console.error("Error fetching cloud file:",n);const m=document.createElement("a");m.href=p,m.download=u,m.target="_blank",m.rel="noopener noreferrer",m.style.display="none",document.body.appendChild(m),m.click(),setTimeout(()=>{document.body.contains(m)&&document.body.removeChild(m)},100)}else{const n=p.replace("/api/files/download/",""),m=await S.get(`/files/download/${n}`,{responseType:"blob"}),U=new Blob([m.data]),C=window.URL.createObjectURL(U),F=document.createElement("a");F.href=C,F.download=u,F.style.display="none",document.body.appendChild(F),F.click(),setTimeout(()=>{document.body.contains(F)&&document.body.removeChild(F),window.URL.revokeObjectURL(C)},100)}}catch(u){console.error("Error downloading file:",u);try{const n=document.createElement("a");n.href=p,n.target="_blank",n.rel="noopener noreferrer",n.style.display="none",document.body.appendChild(n),n.click(),setTimeout(()=>{document.body.contains(n)&&document.body.removeChild(n)},100)}catch(n){console.error("Fallback download also failed:",n)}}return!1},K=s=>{x.mutate({lastPosition:Math.floor(s.playedSeconds)})},X=()=>{x.mutate({completed:!0})},se=s=>{const p=new Set(E);p.has(s)?p.delete(s):p.add(s),j(p)},z=s=>{O(s),h.mutate(s)},te=()=>{try{const s=y||[],p=r||[],f=new Map,u=[];return s.forEach(n=>{n?.moduleId?(f.has(n.moduleId)||f.set(n.moduleId,[]),f.get(n.moduleId).push(n)):u.push(n)}),f.forEach(n=>{n.sort((m,U)=>(m.order||0)-(U.order||0))}),{lessonsByModule:f,lessonsWithoutModule:u,modules:p.sort((n,m)=>(n.order||0)-(m.order||0))}}catch(s){return console.error("Error grouping lessons by modules:",s),{lessonsByModule:new Map,lessonsWithoutModule:[],modules:[]}}},J=s=>{if(!v||v.role!=="STUDENT"||s.progress?.completed)return!0;const f=[...y||[]].sort((n,m)=>(n.order||0)-(m.order||0)),u=f.findIndex(n=>n.id===s.id);return u===0?!0:u>0&&f[u-1].progress?.completed||!1};if(k.useEffect(()=>{L?.moduleId&&j(s=>s.has(L.moduleId)?s:new Set([...s,L.moduleId]))},[a,L?.moduleId]),_)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block relative",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-primary-200 border-t-primary-500"})}),e.jsx("p",{className:"mt-4 text-neutral-600",children:t("common.loading")})]});if(M)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-red-600 mb-4",children:M instanceof Error?M.message:"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —É—Ä–æ–∫–∞"}),e.jsx("button",{onClick:()=>o(`/courses/${i}`),className:"btn-primary",children:"–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∫—É—Ä—Å—É"})]});const $=L;if(!$)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-neutral-600 mb-4",children:t("errors.notFound")}),e.jsx("button",{onClick:()=>o(`/courses/${i}`),className:"btn-primary",children:"–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∫—É—Ä—Å—É"})]});const G=w,{lessonsByModule:re,lessonsWithoutModule:Y,modules:ae}=te(),B=y||[],W=B.findIndex(s=>s.id===a),l=W<B.length-1?B[W+1]:null,b=$.videoUrl?Ve($.videoUrl):null,ne=$.videoUrl?ye($.videoUrl):null;return e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsxs("div",{className:"flex-1 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>o(`/courses/${i}`),className:"flex items-center text-neutral-600 hover:text-primary-600 mb-4 transition-colors group",children:[e.jsx(Te,{className:"h-5 w-5 mr-2 group-hover:-translate-x-1 transition-transform"}),"–ù–∞–∑–∞–¥"]}),e.jsx("h1",{className:"text-2xl md:text-3xl lg:text-4xl font-bold text-neutral-900 mb-3 break-words",children:$.title}),G?.category&&e.jsx("div",{className:"mb-6",children:e.jsx("span",{className:`inline-flex items-center px-3 py-1.5 rounded-lg text-sm font-medium ${Pe(G.category)}`,children:Ue(G.category)})})]}),b&&e.jsx("div",{className:"w-full bg-neutral-900 rounded-lg overflow-hidden shadow-lg",children:e.jsx("div",{className:"aspect-video",children:ne==="google-drive"?e.jsx("iframe",{src:b||"",width:"100%",height:"100%",allow:"autoplay",style:{border:"none"},allowFullScreen:!0}):e.jsx(De,{url:$.videoUrl||"",width:"100%",height:"100%",controls:!0,onProgress:K,onEnded:X,config:{youtube:{playerVars:{start:$.progress?.lastPosition||0}},vimeo:{playerOptions:{start:$.progress?.lastPosition||0}}}})})}),e.jsxs("div",{className:"bg-white border border-neutral-200 rounded-lg p-6 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-900 mb-2",children:"–ö–∞–∫ –ø—Ä–æ—à–µ–ª —É—Ä–æ–∫?"}),e.jsx("p",{className:"text-sm text-neutral-600 mb-4",children:"–ù–∞–º –≤–∞–∂–Ω–∞ –í–∞—à–∞ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å"}),e.jsx("div",{className:"flex items-center justify-center gap-4",children:[1,2,3,4,5].map(s=>e.jsxs("button",{onClick:()=>z(s),className:`text-4xl transition-transform hover:scale-110 ${I===s?"scale-110":"opacity-70 hover:opacity-100"}`,disabled:h.isLoading,children:[s===1&&"üò¢",s===2&&"üòï",s===3&&"üòê",s===4&&"üôÇ",s===5&&"üòÑ"]},s))})]}),$.files&&$.files.length>0&&e.jsxs("div",{className:"bg-white border border-neutral-200 rounded-lg p-6 shadow-sm",children:[e.jsx("h2",{className:"text-lg md:text-xl font-semibold text-neutral-900 mb-4",children:t("lessons.files",{defaultValue:"–§–∞–π–ª—ã —É—Ä–æ–∫–∞"})}),e.jsx("div",{className:"space-y-3",children:$.files.map(s=>{const p=/\.(mp4|webm|mov|avi|wmv|flv|mpeg)$/i.test(s.fileName),f=/\.(pdf|doc|docx|xls|xlsx|ppt|pptx|txt)$/i.test(s.fileName),u=/\.(jpg|jpeg|png|gif|webp)$/i.test(s.fileName);return e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-0 p-3 md:p-4 border border-neutral-200 rounded-lg hover:bg-neutral-50 hover:border-primary-300 transition-all group",children:[e.jsxs("div",{className:"flex items-center flex-1 min-w-0",children:[e.jsx("div",{className:"flex-shrink-0 mr-3",children:f?e.jsx(Z,{className:"h-5 w-5 text-blue-500"}):p?e.jsx(be,{className:"h-5 w-5 text-purple-500"}):u?e.jsx(Z,{className:"h-5 w-5 text-green-500"}):e.jsx(Z,{className:"h-5 w-5 text-primary-500"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-neutral-900 truncate",title:s.fileName,children:(()=>{try{const n=s.fileName;if(/[ƒê√ë‚Ç¨√ê¬£]/.test(n)){const m=new Uint8Array(n.length);for(let C=0;C<n.length;C++)m[C]=n.charCodeAt(C)&255;const U=new TextDecoder("utf-8",{fatal:!1}).decode(m);return/[ƒê√ë‚Ç¨√ê¬£]/.test(U)?decodeURIComponent(escape(n)):U}return n}catch{return s.fileName}})()}),e.jsxs("p",{className:"text-sm text-neutral-500",children:[t("lessons.fileSize",{defaultValue:"–†–∞–∑–º–µ—Ä"}),": ",(s.fileSize/1024/1024).toFixed(2)," MB"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{type:"button",onClick:n=>{n.preventDefault(),n.stopPropagation(),ee(n,s.fileUrl,s.fileName)},className:"btn-secondary px-4 py-2 text-sm flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4"}),p?"–°–º–æ—Ç—Ä–µ—Ç—å":"–°–∫–∞—á–∞—Ç—å"]}),H()&&e.jsxs("button",{type:"button",onClick:n=>{n.preventDefault(),n.stopPropagation(),g({isOpen:!0,fileId:s.id})},className:"px-3 py-2 text-sm text-red-600 hover:text-red-700 hover:bg-red-50 border border-red-200 rounded-lg transition-colors flex items-center gap-2",title:"–£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª",children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"–£–¥–∞–ª–∏—Ç—å"})]})]})]},s.id)})})]}),N&&N.length>0&&e.jsxs("div",{className:"bg-white border border-neutral-200 rounded-lg p-6 shadow-sm",children:[e.jsx("h2",{className:"text-lg md:text-xl font-semibold text-neutral-900 mb-6",children:t("practice.title")}),e.jsx("div",{className:"space-y-6",children:N.map(s=>e.jsxs("div",{className:"p-4 border border-neutral-200 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-900 mb-2",children:s.title}),s.description&&e.jsx("p",{className:"text-neutral-600 mb-4",children:s.description}),e.jsx(q,{to:`/lessons/${a}/practice`,className:"btn-primary text-sm",children:t("practice.execute",{defaultValue:"–í—ã–ø–æ–ª–Ω–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ"})})]},s.id))})]}),c&&c.length>0&&e.jsxs("div",{className:"bg-white border border-neutral-200 rounded-lg p-6 shadow-sm",children:[e.jsx("h2",{className:"text-lg md:text-xl font-semibold text-neutral-900 mb-4",children:t("flashcards.title")}),e.jsx("div",{className:"space-y-4",children:c.map(s=>e.jsxs("div",{className:"p-4 border border-neutral-200 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-900 mb-2",children:s.title}),s.description&&e.jsx("p",{className:"text-neutral-600 mb-4 text-sm",children:s.description}),e.jsx(q,{to:`/flashcards/${s.id}/study`,className:"btn-primary text-sm",children:t("flashcards.study")})]},s.id))})]}),e.jsx("div",{children:e.jsx(He,{lessonId:a,onComplete:s=>{s.passed&&D.invalidateQueries(["lesson",a])}})}),e.jsx(Qe,{lessonId:a}),l&&e.jsxs("button",{onClick:()=>o(`/courses/${i}/lessons/${l.id}`),className:"w-full bg-neutral-800 hover:bg-neutral-900 text-white font-semibold py-4 px-6 rounded-lg transition-colors flex items-center justify-center gap-2",children:[e.jsx("span",{children:"–°–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–∫"}),e.jsx(ge,{className:"h-5 w-5"})]})]}),e.jsx("div",{className:"w-full lg:w-80 flex-shrink-0",children:e.jsxs("div",{className:"bg-white border border-neutral-200 rounded-lg shadow-sm sticky top-6",children:[e.jsx("div",{className:"p-4 border-b border-neutral-200",children:e.jsx("h3",{className:"font-semibold text-neutral-900",children:"–ü—Ä–æ–≥—Ä–∞–º–º–∞ –∫—É—Ä—Å–∞"})}),e.jsxs("div",{className:"p-2 max-h-[calc(100vh-200px)] overflow-y-auto",children:[ae.map(s=>{const p=re.get(s.id)||[],f=E.has(s.id);return e.jsxs("div",{className:"mb-2",children:[e.jsxs("button",{onClick:()=>se(s.id),className:"w-full flex items-center justify-between p-3 hover:bg-neutral-50 rounded-lg transition-colors text-left",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx(be,{className:"h-5 w-5 text-primary-500 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-neutral-900 truncate",children:s.title}),e.jsxs("div",{className:"text-xs text-neutral-500",children:[p.length," —É—Ä–æ–∫–æ–≤"]})]})]}),f?e.jsx(Ie,{className:"h-5 w-5 text-neutral-400 flex-shrink-0"}):e.jsx(Oe,{className:"h-5 w-5 text-neutral-400 flex-shrink-0"})]}),f&&e.jsx("div",{className:"ml-4 mt-1 space-y-1",children:p.map((u,n)=>{const m=u.id===a,U=J(u),C=u.progress?.completed||!1;return e.jsxs(q,{to:`/courses/${i}/lessons/${u.id}`,className:`flex items-center justify-between p-2 rounded-lg transition-colors ${m?"bg-primary-50 border-l-4 border-primary-600":"hover:bg-neutral-50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsxs("span",{className:"text-sm text-neutral-500 flex-shrink-0",children:[String(n+1).padStart(2,"0"),"."]}),e.jsx("span",{className:`text-sm truncate ${m?"font-semibold text-primary-700":"text-neutral-700"}`,children:u.title})]}),e.jsx("div",{className:"flex-shrink-0 ml-2",children:U?e.jsx(V,{className:`h-4 w-4 ${C?"text-green-500":"text-neutral-400"}`}):e.jsx(fe,{className:"h-4 w-4 text-neutral-300"})})]},u.id)})})]},s.id)}),Y.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-sm font-medium text-neutral-500 mb-2 px-3",children:"–ë–µ–∑ –º–æ–¥—É–ª—è"}),e.jsx("div",{className:"space-y-1",children:Y.map(s=>{const p=s.id===a,f=J(s),u=s.progress?.completed||!1;return e.jsxs(q,{to:`/courses/${i}/lessons/${s.id}`,className:`flex items-center justify-between p-2 rounded-lg transition-colors ${p?"bg-primary-50 border-l-4 border-primary-600":"hover:bg-neutral-50"}`,children:[e.jsx("span",{className:`text-sm truncate ${p?"font-semibold text-primary-700":"text-neutral-700"}`,children:s.title}),e.jsx("div",{className:"flex-shrink-0 ml-2",children:f?e.jsx(V,{className:`h-4 w-4 ${u?"text-green-500":"text-neutral-400"}`}):e.jsx(fe,{className:"h-4 w-4 text-neutral-300"})})]},s.id)})})]})]})]})}),e.jsx(Ne,{isOpen:A.isOpen,onClose:()=>g({isOpen:!1,fileId:null}),onConfirm:()=>{A.fileId&&T.mutate(A.fileId)},title:"–£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª",message:"–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ñ–∞–π–ª? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.",confirmText:"–£–¥–∞–ª–∏—Ç—å",cancelText:"–û—Ç–º–µ–Ω–∞",variant:"danger"})]})}export{Ke as default};
