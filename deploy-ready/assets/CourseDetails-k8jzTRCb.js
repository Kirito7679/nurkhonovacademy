import{j as e,X as U,a8 as W,a9 as G,Z as u,q as I,aa as O,k as Q,ab as z,u as _,d as X,r as T,e as y,f as Z,U as H,a1 as J,ac as K,ad as Y,ae as ee,a7 as F,af as se,a6 as te}from"./vendor-react-B4b84SyH.js";import{a as f}from"./index-D6PcLXw1.js";import{B as ae}from"./Banner-Mwj-ZcmD.js";function le({isOpen:a,onClose:r,onConfirm:p,courseTitle:g,coursePrice:N,teacherTelegram:o,isLoading:c=!1}){if(!a)return null;const m=N===0,k=m?"Бесплатно":`${N.toLocaleString("ru-RU")} сум`,L=o?o.startsWith("http")?o:o.startsWith("@")?`https://t.me/${o.slice(1)}`:`https://t.me/${o}`:"https://t.me/Nurkhonov_Dilmurod";return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 animate-fade-in-scale p-4",onClick:v=>{v.target===v.currentTarget&&!c&&r()},children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md relative animate-slide-in overflow-hidden",children:[e.jsx("button",{onClick:r,disabled:c,className:"absolute top-4 right-4 z-10 text-neutral-400 hover:text-neutral-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed bg-white/80 backdrop-blur-sm rounded-full p-1.5 hover:bg-white",children:e.jsx(U,{className:"h-5 w-5"})}),e.jsx("div",{className:`${m?"bg-gradient-to-br from-green-500 via-emerald-500 to-teal-500":"bg-gradient-to-br from-primary-500 to-primary-600"} p-6 md:p-8 pb-8`,children:e.jsxs("div",{className:"flex flex-col items-center text-center text-white",children:[e.jsx("div",{className:"w-20 h-20 rounded-full flex items-center justify-center mb-4 bg-white/20 backdrop-blur-sm border-2 border-white/30",children:m?e.jsx(W,{className:"h-10 w-10 text-white"}):e.jsx(G,{className:"h-10 w-10 text-white"})}),e.jsx("h3",{className:"text-2xl md:text-3xl font-bold mb-2",children:m?"Бесплатный курс":"Стоимость курса"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("p",{className:"text-4xl md:text-5xl font-bold mb-1",children:k}),m&&e.jsx("p",{className:"text-white/90 text-sm md:text-base",children:"Начните обучение прямо сейчас!"})]})]})}),e.jsx("div",{className:"p-6 md:p-8",children:m?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h4",{className:"text-lg font-semibold text-neutral-900 mb-2",children:g}),e.jsx("p",{className:"text-neutral-600 text-sm",children:"После подтверждения курс будет автоматически добавлен в ваш список доступных курсов"})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(u,{className:"h-5 w-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-900",children:"Мгновенный доступ"}),e.jsx("p",{className:"text-xs text-green-700",children:"Курс будет доступен сразу после подтверждения"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(I,{className:"h-5 w-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-900",children:"Все материалы включены"}),e.jsx("p",{className:"text-xs text-green-700",children:"Получите доступ ко всем урокам и материалам курса"})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{onClick:r,disabled:c,className:"flex-1 px-4 py-3 border-2 border-neutral-300 rounded-xl text-sm font-semibold text-neutral-700 hover:bg-neutral-50 hover:border-neutral-400 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:"Отмена"}),e.jsx("button",{onClick:p,disabled:c,className:"flex-1 px-4 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl text-sm font-semibold hover:shadow-lg hover:scale-[1.02] transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:c?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin",children:"⟳"}),e.jsx("span",{children:"Обработка..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(u,{className:"h-5 w-5"}),e.jsx("span",{children:"Начать обучение"})]})})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h4",{className:"text-lg font-semibold text-neutral-900 mb-2",children:g}),e.jsx("p",{className:"text-neutral-600 text-sm",children:"Чтобы купить курс, свяжитесь с преподавателем в Telegram"})]}),e.jsxs("a",{href:L,target:"_blank",rel:"noopener noreferrer",className:"w-full flex items-center justify-center gap-3 px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-xl transition-all font-semibold shadow-md hover:shadow-lg group",children:[e.jsx(O,{className:"h-5 w-5 group-hover:scale-110 transition-transform"}),e.jsx("span",{children:"Написать в Telegram"})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{onClick:r,disabled:c,className:"flex-1 px-4 py-3 border-2 border-neutral-300 rounded-xl text-sm font-semibold text-neutral-700 hover:bg-neutral-50 hover:border-neutral-400 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:"Отмена"}),e.jsx("button",{onClick:p,disabled:c,className:"flex-1 px-4 py-3 bg-gradient-primary text-white rounded-xl text-sm font-semibold hover:shadow-lg hover:scale-[1.02] transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:c?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin",children:"⟳"}),e.jsx("span",{children:"Отправка..."})]}):"Отправить запрос"})]})]})})]})})}function ce(){var A;const{t:a}=Q(),{id:r}=z(),p=_(),g=X(),[N,o]=T.useState(!1),[c,m]=T.useState(!0),{data:k,isLoading:L}=y(["course",r],async()=>(await f.get(`/courses/${r}`)).data.data,{staleTime:5*60*1e3,cacheTime:10*60*1e3,enabled:!!r}),{data:v,isLoading:S}=y(["courseLessons",r],async()=>(await f.get(`/courses/${r}/lessons`)).data.data||[],{staleTime:5*60*1e3,cacheTime:10*60*1e3,enabled:!!r}),{data:D,isLoading:re}=y(["modules",r],async()=>(await f.get(`/modules/courses/${r}/modules`)).data.data||[],{staleTime:10*60*1e3,cacheTime:20*60*1e3,enabled:!!r}),{data:E}=y(["tests",r],async()=>(await f.get(`/tests/courses/${r}/tests`)).data.data||[],{staleTime:5*60*1e3,cacheTime:10*60*1e3,enabled:!!r&&(t==null?void 0:t.hasAccess)}),w=Z(async()=>(await f.post(`/courses/${r}/request`)).data,{onSuccess:()=>{g.invalidateQueries(["course",r]),o(!1)},onError:()=>{}}),t=k,d=v||[],b=D||[],V=E||[];t!=null&&t.trialLessonId&&d.find(s=>s.id===t.trialLessonId);const M=d.filter(s=>{var i;return(i=s.progress)==null?void 0:i.completed}).length,C=d.length>0?Math.round(M/d.length*100):0,q=()=>{const s=new Map,i=[];return d.forEach(l=>{l.moduleId?(s.has(l.moduleId)||s.set(l.moduleId,[]),s.get(l.moduleId).push(l)):i.push(l)}),s.forEach(l=>{l.sort((x,n)=>x.order-n.order)}),i.sort((l,x)=>l.order-x.order),{lessonsByModule:s,lessonsWithoutModule:i}},{lessonsByModule:$,lessonsWithoutModule:j}=q();if(L)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block relative",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-primary-200 border-t-primary-500"})}),e.jsx("p",{className:"mt-4 text-neutral-600",children:a("common.loading")})]});if(!t)return e.jsx("div",{className:"text-center py-12 animate-fade-scale",children:e.jsx("p",{className:"text-neutral-600",children:a("errors.notFound")})});const R=()=>{o(!0)},B=()=>{w.mutate()};return e.jsxs("div",{children:[e.jsx(ae,{position:"TOP"}),t.thumbnailUrl&&e.jsxs("div",{className:"relative w-full h-48 md:h-64 lg:h-80 mb-8 rounded-lg overflow-hidden animate-fade-scale",children:[e.jsx("img",{src:t.thumbnailUrl,alt:t.title,className:"w-full h-full object-cover",onError:s=>{s.target.style.display="none"}}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 via-black/30 to-transparent"}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-6 md:p-8",children:[e.jsx("h1",{className:"text-2xl md:text-4xl lg:text-5xl font-bold text-white mb-2 break-words",children:t.title}),t.teacher&&e.jsxs("div",{className:"flex items-center text-white/90 text-sm md:text-base",children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),e.jsxs("span",{children:[a("courses.teacher",{defaultValue:"Преподаватель"}),": ",t.teacher.firstName," ",t.teacher.lastName]})]})]})]}),e.jsxs("div",{className:"mb-8 animate-slide-in",children:[!t.thumbnailUrl&&e.jsx("h1",{className:"text-2xl md:text-3xl lg:text-5xl font-bold text-gradient mb-4 break-words",children:t.title}),t.hasAccess&&d.length>0&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"card p-4 text-center",children:[e.jsx(I,{className:"h-6 w-6 text-primary-500 mx-auto mb-2"}),e.jsx("div",{className:"text-2xl font-bold text-neutral-900",children:d.length}),e.jsx("div",{className:"text-sm text-neutral-600",children:a("lessons.title")})]}),e.jsxs("div",{className:"card p-4 text-center",children:[e.jsx(u,{className:"h-6 w-6 text-green-500 mx-auto mb-2"}),e.jsx("div",{className:"text-2xl font-bold text-neutral-900",children:M}),e.jsx("div",{className:"text-sm text-neutral-600",children:a("lessons.completed")})]}),e.jsxs("div",{className:"card p-4 text-center",children:[e.jsx("div",{className:"h-6 w-6 mx-auto mb-2 flex items-center justify-center",children:e.jsx("div",{className:"w-12 h-12 rounded-full border-4 border-primary-200 border-t-primary-500",style:{background:`conic-gradient(from 0deg, #39ff14 ${C*3.6}deg, #e5e7eb ${C*3.6}deg)`}})}),e.jsxs("div",{className:"text-2xl font-bold text-neutral-900",children:[C,"%"]}),e.jsx("div",{className:"text-sm text-neutral-600",children:a("dashboard.overallProgress",{defaultValue:"Прогресс"})})]}),e.jsxs("div",{className:"card p-4 text-center",children:[e.jsx(J,{className:"h-6 w-6 text-primary-500 mx-auto mb-2"}),e.jsx("div",{className:"text-2xl font-bold text-neutral-900",children:b.length}),e.jsx("div",{className:"text-sm text-neutral-600",children:a("modules.title")})]})]}),t.description&&e.jsxs("div",{className:"card p-6 md:p-8 mb-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-semibold text-neutral-900 mb-4",children:a("courses.aboutCourse",{defaultValue:"О курсе"})}),e.jsx("p",{className:"text-neutral-600 text-sm md:text-base lg:text-lg leading-relaxed break-words whitespace-pre-line",children:t.description})]}),t.hasAccess&&V.length>0&&e.jsxs("div",{className:"card p-6 md:p-8 mb-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-semibold text-neutral-900 mb-6",children:"Промежуточные тесты"}),e.jsx("div",{className:"space-y-3",children:V.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-neutral-200 rounded-lg hover:border-primary-300 transition-colors",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-neutral-900",children:s.title}),s.description&&e.jsx("p",{className:"text-sm text-neutral-600 mt-1",children:s.description}),e.jsxs("p",{className:"text-xs text-neutral-500 mt-2",children:["Проходной балл: ",s.passingScore,"% •",s.timeLimit?` Время: ${s.timeLimit} мин`:" Без ограничения времени"]})]}),e.jsxs("button",{onClick:()=>p(`/courses/${r}/tests/${s.id}`),className:"btn-primary text-sm ml-4",children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Пройти тест"]})]},s.id))})]}),t.hasAccess&&b.length>0&&e.jsxs("div",{className:"card p-6 md:p-8 mb-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-semibold text-neutral-900 mb-6",children:a("courses.program",{defaultValue:"Программа обучения"})}),e.jsxs("div",{className:"space-y-4",children:[b.sort((s,i)=>s.order-i.order).map((s,i)=>{const l=$.get(s.id)||[];if(l.length===0)return null;let x=1;for(let n=0;n<i;n++){const h=$.get(b[n].id)||[];x+=h.length}return e.jsxs("div",{className:"border-l-4 border-primary-500 pl-4 md:pl-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-gradient-primary text-white font-bold text-lg flex-shrink-0",children:i+1}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg md:text-xl font-semibold text-neutral-900",children:s.title}),s.description&&e.jsx("p",{className:"text-sm text-neutral-500 mt-1",children:s.description})]}),e.jsxs("span",{className:"text-sm text-neutral-500 ml-auto",children:[l.length," ",a("lessons.lessonsCount",{count:l.length,defaultValue:l.length===1?"урок":"уроков"})]})]}),e.jsx("div",{className:"ml-12 md:ml-14 space-y-2",children:l.map((n,h)=>{var P;return e.jsxs("div",{className:"flex items-center gap-2 text-neutral-600 hover:text-primary-600 transition-colors",children:[e.jsxs("span",{className:"text-sm font-medium w-6",children:[x+h,"."]}),e.jsx("span",{className:"text-sm md:text-base",children:n.title}),((P=n.progress)==null?void 0:P.completed)&&e.jsx(u,{className:"h-4 w-4 text-green-500 ml-auto"})]},n.id)})})]},s.id)}),j.length>0&&e.jsxs("div",{className:"border-l-4 border-neutral-300 pl-4 md:pl-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("h3",{className:"text-lg md:text-xl font-semibold text-neutral-900",children:a("modules.additionalLessons",{defaultValue:"Дополнительные уроки"})}),e.jsxs("span",{className:"text-sm text-neutral-500 ml-auto",children:[j.length," ",a("lessons.lessonsCount",{count:j.length,defaultValue:j.length===1?"урок":"уроков"})]})]}),e.jsx("div",{className:"ml-12 md:ml-14 space-y-2",children:j.map((s,i)=>{var x;let l=1;return b.forEach(n=>{const h=$.get(n.id)||[];l+=h.length}),l+=i,e.jsxs("div",{className:"flex items-center gap-2 text-neutral-600 hover:text-primary-600 transition-colors",children:[e.jsxs("span",{className:"text-sm font-medium w-6",children:[l,"."]}),e.jsx("span",{className:"text-sm md:text-base",children:s.title}),((x=s.progress)==null?void 0:x.completed)&&e.jsx(u,{className:"h-4 w-4 text-green-500 ml-auto"})]},s.id)})})]})]})]})]}),e.jsxs("div",{className:"animate-fade-scale",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 md:mb-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-semibold text-neutral-900",children:a("courses.courseLessons",{defaultValue:"Уроки курса"})}),d.length>0&&e.jsx("button",{onClick:()=>m(!c),className:"flex items-center gap-2 text-primary-600 hover:text-primary-700 transition-colors text-sm md:text-base",children:c?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:a("common.close")}),e.jsx(Y,{className:"h-5 w-5"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:a("courses.showAll",{defaultValue:"Показать все"})}),e.jsx(ee,{className:"h-5 w-5"})]})})]}),S?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block relative",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-primary-200 border-t-primary-500"})}),e.jsx("p",{className:"mt-4 text-neutral-600",children:a("common.loading")})]}):d.length===0?e.jsx("div",{className:"text-center py-12 animate-fade-scale",children:e.jsx("p",{className:"text-neutral-500",children:a("lessons.noLessons")})}):e.jsxs(e.Fragment,{children:[!t.hasAccess&&e.jsx("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("span",{className:"font-semibold",children:a("courses.trialLessons",{defaultValue:"Пробные уроки"})})," ",a("courses.trialLessonsDescription",{defaultValue:"доступны для просмотра. Для доступа ко всем урокам запросите доступ к курсу."})]})}),e.jsx("div",{className:"space-y-4",children:(c?d:d.slice(0,5)).map((s,i)=>{var h;const l=(t==null?void 0:t.trialLessonId)===s.id,n=!(t.hasAccess||l);return e.jsx("div",{className:`card p-4 md:p-6 animate-slide-in group ${n?"opacity-60 cursor-not-allowed":"card-hover cursor-pointer"}`,style:{animationDelay:`${.1*i}s`},onClick:()=>{n||p(`/courses/${r}/lessons/${s.id}`)},children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 md:gap-3 mb-2",children:[e.jsx("span",{className:`flex items-center justify-center w-8 h-8 md:w-10 md:h-10 rounded-full font-semibold text-sm md:text-base flex-shrink-0 transition-transform ${n?"bg-neutral-300 text-neutral-600":"bg-gradient-primary text-white group-hover:scale-110"}`,children:i+1}),e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx("h3",{className:`text-base md:text-lg font-semibold break-words transition-colors ${n?"text-neutral-500":"text-neutral-900 group-hover:text-primary-600"}`,children:s.title}),l&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-700 border border-blue-200",children:a("courses.trial",{defaultValue:"Пробный"})}),n&&e.jsx(F,{className:"h-4 w-4 text-neutral-400 flex-shrink-0"})]})]}),s.description&&e.jsx("p",{className:`text-xs md:text-sm ml-10 md:ml-12 break-words line-clamp-2 ${n?"text-neutral-400":"text-neutral-600"}`,children:s.description}),e.jsx("div",{className:"flex items-center gap-3 mt-2 ml-10 md:ml-12",children:((h=s.progress)==null?void 0:h.completed)&&e.jsxs("span",{className:"inline-flex items-center px-2 md:px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-700 border border-green-200",children:[e.jsx(u,{className:"h-3 w-3 mr-1 text-green-700"}),a("lessons.completed")]})})]}),e.jsx("div",{className:"flex items-center gap-2",children:n?e.jsx(F,{className:"h-5 w-5 text-neutral-400 flex-shrink-0"}):e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"h-5 w-5 text-primary-500 flex-shrink-0 group-hover:scale-110 transition-transform"}),e.jsx(te,{className:"h-5 w-5 text-neutral-400 group-hover:text-primary-500 group-hover:translate-x-1 transition-all flex-shrink-0"})]})})]})},s.id)})}),!c&&d.length>5&&e.jsx("div",{className:"text-center mt-4",children:e.jsx("button",{onClick:()=>m(!0),className:"text-primary-600 hover:text-primary-700 font-medium text-sm",children:a("courses.showAllLessons",{count:d.length,defaultValue:`Показать все ${d.length} уроков`})})}),!t.hasAccess&&e.jsx("div",{className:"mt-6 card p-4 md:p-6 text-center",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4 justify-center",children:[t.studentCourseStatus!=="PENDING"&&e.jsx("button",{onClick:R,disabled:w.isLoading,className:"btn-primary inline-flex items-center disabled:opacity-50 disabled:cursor-not-allowed",children:w.isLoading?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"animate-spin",children:"⟳"}),e.jsx("span",{children:a("common.loading")})]}):e.jsx("span",{children:t.price===0?a("courses.startCourse",{defaultValue:"Пройти курс"}):a("courses.requestAccess",{defaultValue:"Запросить доступ к курсу"})})}),t.studentCourseStatus==="PENDING"&&e.jsxs("div",{className:"text-neutral-600",children:[e.jsx("p",{className:"font-medium mb-2",children:a("courses.requestPending",{defaultValue:"Запрос ожидает одобрения"})}),e.jsx("p",{className:"text-sm",children:a("courses.requestPendingDescription",{defaultValue:"Вы получите уведомление, когда доступ будет предоставлен"})})]})]})})]})]}),e.jsx(le,{isOpen:N,onClose:()=>o(!1),onConfirm:B,courseTitle:t.title,coursePrice:t.price,teacherTelegram:(A=t.teacher)==null?void 0:A.telegram,isLoading:w.isLoading})]})}export{ce as default};
