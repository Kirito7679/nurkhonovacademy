import{k as me,r as c,j as e,af as Ke,aW as we,z as Ye,D as et,at as ee,X as $,aN as G,T as te,aR as de,ae as tt,aX as st,d as at,u as lt,e as Q,f as E,V as rt,ap as it,aY as Ce,s as nt,aZ as ot,x as ct,$ as dt,a0 as mt,a1 as B,aT as ut,av as De}from"./vendor-D-riqg-X.js";import{a as b,C as pt}from"./index-CVGNmkiu.js";import{E as xt}from"./ErrorModal-CzR1kAop.js";import{S as ft}from"./SuccessModal-2VojkkiP.js";import{F as Oe}from"./FileUploadProgress-YX5frkCv.js";function ht({docUrl:s,title:m,width:r="100%",height:p="600px"}){const{t:j}=me(),[x,l]=c.useState(!1),y=(N=>{const v=N.match(/\/d\/([a-zA-Z0-9-_]+)/);return v?`https://docs.google.com/document/d/${v[1]}/preview`:N})(s),w=()=>{window.open(s,"_blank")};return x?e.jsxs("div",{className:"card p-6 text-center",children:[e.jsx(Ke,{className:"h-12 w-12 text-neutral-400 mx-auto mb-4"}),e.jsx("p",{className:"text-neutral-600 mb-4",children:j("integrations.failedToLoad",{defaultValue:"Не удалось загрузить документ"})}),e.jsxs("button",{onClick:w,className:"btn-secondary inline-flex items-center gap-2",children:[e.jsx(we,{className:"h-4 w-4"}),j("integrations.openInNewTab",{defaultValue:"Открыть в новой вкладке"})]})]}):e.jsxs("div",{className:"card p-4",children:[m&&e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-neutral-900",children:m}),e.jsx("button",{onClick:w,className:"text-primary-600 hover:text-primary-700 transition-colors",title:j("integrations.openInNewTab",{defaultValue:"Открыть в новой вкладке"}),children:e.jsx(we,{className:"h-5 w-5"})})]}),e.jsx("iframe",{src:y,width:r,height:p,className:"border-0 rounded-lg",onError:()=>l(!0),title:m||"Google Docs Document"})]})}function gt({lessonId:s,onImportComplete:m}){const{t:r}=me(),[p,j]=c.useState(""),[x,l]=c.useState(!1),[u,y]=c.useState(null),[w,N]=c.useState(!1),v=async()=>{if(!p.trim()){y(r("integrations.enterQuizletUrl",{defaultValue:"Введите URL набора Quizlet"}));return}l(!0),y(null),N(!1);try{if(!p.match(/quizlet\.com\/([^\/]+)\/([^\/]+)/))throw new Error(r("integrations.invalidQuizletUrl",{defaultValue:"Неверный формат URL Quizlet"}));const O=await b.post("/api/flashcards/import-quizlet",{lessonId:s,quizletUrl:p});N(!0),m?.(O.data.data||[]),j("")}catch(C){y(C.response?.data?.message||r("integrations.importError",{defaultValue:"Ошибка при импорте карточек"}))}finally{l(!1)}};return e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-900 mb-4",children:r("integrations.importFromQuizlet",{defaultValue:"Импорт из Quizlet"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:r("integrations.quizletSetUrl",{defaultValue:"URL набора Quizlet"})}),e.jsx("input",{type:"url",value:p,onChange:C=>j(C.target.value),placeholder:"https://quizlet.com/...",className:"input-field"}),e.jsx("p",{className:"text-xs text-neutral-500 mt-1",children:r("integrations.pasteQuizletLink",{defaultValue:"Вставьте ссылку на набор карточек Quizlet"})})]}),u&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(Ye,{className:"h-5 w-5 text-red-500"}),e.jsx("p",{className:"text-sm text-red-700",children:u})]}),w&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx(et,{className:"h-5 w-5 text-green-500"}),e.jsx("p",{className:"text-sm text-green-700",children:r("integrations.importSuccess",{defaultValue:"Карточки успешно импортированы!"})})]}),e.jsxs("button",{onClick:v,disabled:x||!p.trim(),className:"btn-primary w-full disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5"}),x?r("common.loading"):r("integrations.importCards",{defaultValue:"Импортировать карточки"})]})]})]})}function bt({isOpen:s,onClose:m,onConfirm:r,title:p,label:j,placeholder:x,confirmText:l="OK",cancelText:u="Отмена",defaultValue:y="",required:w=!0}){const[N,v]=c.useState("");c.useEffect(()=>{s?(v(y),setTimeout(()=>{document.getElementById("input-modal-field")?.focus()},100)):v("")},[s,y]);const C=()=>{if(w&&!N.trim())return;const g=N.trim();v(""),r(g),m()},O=g=>{g.key==="Enter"?(g.preventDefault(),C()):g.key==="Escape"&&m()};return s?e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 animate-fade-in-scale p-4",onClick:g=>{g.target===g.currentTarget&&m()},children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md relative animate-slide-in overflow-hidden",children:[e.jsx("button",{onClick:m,className:"absolute top-4 right-4 z-10 text-neutral-400 hover:text-neutral-600 transition-colors bg-white/80 backdrop-blur-sm rounded-full p-1.5 hover:bg-white",children:e.jsx($,{className:"h-5 w-5"})}),e.jsx("div",{className:"bg-gradient-to-br from-primary-500 to-primary-600 p-6 md:p-8 pb-6",children:e.jsx("h3",{className:"text-2xl md:text-3xl font-bold text-white pr-8",children:p})}),e.jsx("div",{className:"p-6 md:p-8",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"input-modal-field",className:"block text-sm font-semibold text-neutral-900 mb-2",children:j}),e.jsx("input",{id:"input-modal-field",type:"text",value:N,onChange:g=>v(g.target.value),onKeyDown:O,placeholder:x,className:"w-full px-4 py-3 border-2 border-neutral-300 rounded-xl text-neutral-900 placeholder-neutral-400 focus:outline-none focus:border-primary-500 focus:ring-2 focus:ring-primary-200 transition-all",autoFocus:!0})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{onClick:m,className:"flex-1 px-4 py-3 border-2 border-neutral-300 rounded-xl text-sm font-semibold text-neutral-700 hover:bg-neutral-50 hover:border-neutral-400 transition-all",children:u}),e.jsx("button",{onClick:C,disabled:w&&!N.trim(),className:"flex-1 px-4 py-3 bg-gradient-primary text-white rounded-xl text-sm font-semibold hover:shadow-lg hover:scale-[1.02] transition-all disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100",children:l})]})]})})]})}):null}function jt({isOpen:s,onClose:m,onSave:r,exercise:p}){const[j,x]=c.useState(""),[l,u]=c.useState(null);if(c.useEffect(()=>{if(s&&p){x(p.title);try{const i=p.instructions?JSON.parse(p.instructions):null;u(i)}catch{p.type==="DRAG_DROP"?u({type:"DRAG_DROP",items:[],dropZones:[]}):p.type==="MATCHING"&&u({type:"MATCHING",items:[]})}}},[s,p]),!s||!p)return null;const y=()=>{if(!j.trim())return;const i={...p,title:j.trim(),instructions:l?JSON.stringify(l):""};r(i),m()},w=()=>{if(l&&l.type==="DRAG_DROP"){const i=`item_${Date.now()}`;u({...l,items:[...l.items,{id:i,content:""}]})}},N=()=>{if(l&&l.type==="DRAG_DROP"){const i=`zone_${Date.now()}`;u({...l,dropZones:[...l.dropZones,{id:i,label:"",correctItemId:""}]})}},v=()=>{if(l&&l.type==="MATCHING"){const i=`item_${Date.now()}`;u({...l,items:[...l.items,{id:i,left:"",right:""}]})}},C=(i,d)=>{l&&l.type==="DRAG_DROP"&&u({...l,items:l.items.map(S=>S.id===i?{...S,content:d}:S)})},O=(i,d,S)=>{l&&l.type==="DRAG_DROP"&&u({...l,dropZones:l.dropZones.map(I=>I.id===i?{...I,[d]:S}:I)})},g=(i,d,S)=>{l&&l.type==="MATCHING"&&u({...l,items:l.items.map(I=>I.id===i?{...I,[d]:S}:I)})},P=i=>{l&&l.type==="DRAG_DROP"&&u({...l,items:l.items.filter(d=>d.id!==i),dropZones:l.dropZones.map(d=>d.correctItemId===i?{...d,correctItemId:""}:d)})},R=i=>{l&&l.type==="DRAG_DROP"&&u({...l,dropZones:l.dropZones.filter(d=>d.id!==i)})},q=i=>{l&&l.type==="MATCHING"&&u({...l,items:l.items.filter(d=>d.id!==i)})};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 animate-fade-in-scale p-4 overflow-y-auto",onClick:i=>{i.target===i.currentTarget&&m()},children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-4xl relative animate-slide-in overflow-hidden my-8 max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary-500 to-primary-600 p-6 flex items-center justify-between",children:[e.jsx("h3",{className:"text-2xl font-bold text-white",children:"Редактировать упражнение"}),e.jsx("button",{onClick:m,className:"text-white/80 hover:text-white transition-colors bg-white/20 backdrop-blur-sm rounded-full p-1.5 hover:bg-white/30",children:e.jsx($,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"p-6 overflow-y-auto flex-1",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-neutral-900 mb-2",children:"Название упражнения"}),e.jsx("input",{type:"text",value:j,onChange:i=>x(i.target.value),className:"w-full px-4 py-3 border-2 border-neutral-300 rounded-xl text-neutral-900 focus:outline-none focus:border-primary-500 focus:ring-2 focus:ring-primary-200 transition-all",placeholder:"Введите название упражнения"})]}),p.type==="DRAG_DROP"&&l&&l.type==="DRAG_DROP"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-lg font-semibold text-neutral-900",children:"Элементы для перетаскивания"}),e.jsxs("button",{onClick:w,className:"btn-secondary flex items-center gap-2 text-sm",children:[e.jsx(G,{className:"h-4 w-4"}),"Добавить элемент"]})]}),e.jsx("div",{className:"space-y-2",children:l.items.map(i=>e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-neutral-50 rounded-lg",children:[e.jsx("input",{type:"text",value:i.content,onChange:d=>C(i.id,d.target.value),className:"flex-1 px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:border-primary-500",placeholder:"Содержимое элемента"}),e.jsx("button",{onClick:()=>P(i.id),className:"text-red-500 hover:text-red-600 p-2",children:e.jsx(te,{className:"h-4 w-4"})})]},i.id))}),e.jsxs("div",{className:"flex items-center justify-between mt-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-neutral-900",children:"Зоны для размещения"}),e.jsxs("button",{onClick:N,className:"btn-secondary flex items-center gap-2 text-sm",children:[e.jsx(G,{className:"h-4 w-4"}),"Добавить зону"]})]}),e.jsx("div",{className:"space-y-2",children:l.dropZones.map(i=>e.jsxs("div",{className:"p-3 bg-neutral-50 rounded-lg space-y-2",children:[e.jsx("input",{type:"text",value:i.label,onChange:d=>O(i.id,"label",d.target.value),className:"w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:border-primary-500",placeholder:"Название зоны"}),e.jsxs("select",{value:i.correctItemId,onChange:d=>O(i.id,"correctItemId",d.target.value),className:"w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:border-primary-500",children:[e.jsx("option",{value:"",children:"Выберите правильный элемент"}),l.items.map(d=>e.jsx("option",{value:d.id,children:d.content||`Элемент ${d.id}`},d.id))]}),e.jsxs("button",{onClick:()=>R(i.id),className:"text-red-500 hover:text-red-600 text-sm flex items-center gap-1",children:[e.jsx(te,{className:"h-4 w-4"}),"Удалить зону"]})]},i.id))})]}),p.type==="MATCHING"&&l&&l.type==="MATCHING"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-lg font-semibold text-neutral-900",children:"Пары для сопоставления"}),e.jsxs("button",{onClick:v,className:"btn-secondary flex items-center gap-2 text-sm",children:[e.jsx(G,{className:"h-4 w-4"}),"Добавить пару"]})]}),e.jsx("div",{className:"space-y-2",children:l.items.map(i=>e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-neutral-50 rounded-lg",children:[e.jsx("input",{type:"text",value:i.left,onChange:d=>g(i.id,"left",d.target.value),className:"flex-1 px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:border-primary-500",placeholder:"Левая часть"}),e.jsx("span",{className:"text-neutral-500",children:"→"}),e.jsx("input",{type:"text",value:i.right,onChange:d=>g(i.id,"right",d.target.value),className:"flex-1 px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:border-primary-500",placeholder:"Правая часть"}),e.jsx("button",{onClick:()=>q(i.id),className:"text-red-500 hover:text-red-600 p-2",children:e.jsx(te,{className:"h-4 w-4"})})]},i.id))})]})]})}),e.jsxs("div",{className:"p-6 border-t border-neutral-200 flex gap-3",children:[e.jsx("button",{onClick:m,className:"flex-1 px-4 py-3 border-2 border-neutral-300 rounded-xl text-sm font-semibold text-neutral-700 hover:bg-neutral-50 transition-all",children:"Отмена"}),e.jsxs("button",{onClick:y,disabled:!j.trim(),className:"flex-1 px-4 py-3 bg-gradient-primary text-white rounded-xl text-sm font-semibold hover:shadow-lg hover:scale-[1.02] transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[e.jsx(de,{className:"h-5 w-5"}),"Сохранить"]})]})]})})}const Nt=mt({courseId:B().uuid("Неверный ID курса"),moduleId:B().uuid("Неверный ID модуля").optional().or(De("")),title:B().min(1,"Название урока обязательно"),description:B().optional(),order:ut().int().min(0).default(0),videoUrl:B().optional().or(De("")).refine(s=>!!(!s||s===""||s.startsWith("http://")||s.startsWith("https://")||s.startsWith("/api/files/")||s.includes("supabase.co")||s.includes("cloudinary.com")),{message:"Введите валидный URL или загрузите видео файл"})});function Ot(){const{t:s}=me(),{courseId:m,lessonId:r}=tt(),[p]=st(),j=at(),x=lt(),l=!!r,u=p.get("moduleId")||"",[y,w]=c.useState(!1),[N,v]=c.useState(!1),[C,O]=c.useState(null),[g,P]=c.useState(null),R=c.useRef(null),[q,i]=c.useState(!1),[d,S]=c.useState(""),[I,ue]=c.useState(""),[pe,xe]=c.useState(70),[V,L]=c.useState([]),[se,Ve]=c.useState(!1),[ae,Se]=c.useState(!1),[fe,Ie]=c.useState([]),[he,Me]=c.useState([]),H=c.useRef(!1),[z,Z]=c.useState({isOpen:!1,title:"",label:"",onConfirm:()=>{}}),[W,f]=c.useState({isOpen:!1,title:"",message:""}),[X,M]=c.useState({isOpen:!1,title:"",message:""}),[F,K]=c.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}}),[ge,le]=c.useState({isOpen:!1,exercise:null}),{data:T,isLoading:ke}=Q(["lesson",r],async()=>(await b.get(`/lessons/${r}`)).data.data,{enabled:l}),{data:Ee}=Q(["lessonFiles",r],async()=>(await b.get(`/lessons/${r}/files`)).data.data||[],{enabled:l}),{data:U}=Q(["quiz",r],async()=>{try{return(await b.get(`/quizzes/lesson/${r}`)).data.data}catch{return null}},{enabled:l&&!!r}),{data:ze}=Q(["modules",m],async()=>(await b.get(`/modules/courses/${m}/modules`)).data.data||[],{enabled:!!m}),{data:re}=Q(["lessonExercises",r],async()=>{try{return(await b.get(`/practice/lessons/${r}`)).data.data||[]}catch{return[]}},{enabled:l&&!!r}),{data:ie}=Q(["lessonIntegrations",r],async()=>{try{return(await b.get("/integrations",{params:{lessonId:r}})).data.data||[]}catch{return[]}},{enabled:l&&!!r});c.useEffect(()=>{re&&Ie(re)},[re]),c.useEffect(()=>{ie&&Me(ie)},[ie]);const ne=E(async()=>{const t=V.map(n=>({question:n.question,type:n.type,order:0,metadata:n.metadata||null,options:n.options,correctAnswer:n.correctAnswer||(n.metadata?JSON.stringify(JSON.parse(n.metadata).correctMapping||{}):null)}));return(await b.post(`/quizzes/lesson/${r}`,{title:d||null,description:I||null,passingScore:pe,questions:t})).data.data},{onSuccess:()=>{x.invalidateQueries(["quiz",r]),M({isOpen:!0,title:s("common.success",{defaultValue:"Успешно"}),message:s("quiz.saveSuccess",{defaultValue:"Тест успешно сохранен!"})})},onError:t=>{f({isOpen:!0,title:s("common.error",{defaultValue:"Ошибка"}),message:t.response?.data?.message||"Ошибка при сохранении теста"})}}),oe=E(async t=>(await b.post("/lessons",t)).data.data,{onSuccess:t=>{x.invalidateQueries(["course",m]),j(`/teacher/courses/${m}/lessons/${t?.id}/edit`)}}),ce=E(async t=>(await b.put(`/lessons/${r}`,t)).data.data,{onSuccess:()=>{x.invalidateQueries(["lesson",r]),x.invalidateQueries(["course",m])}}),Te=E(async t=>{await b.delete(`/files/${t}`)},{onSuccess:()=>{x.invalidateQueries(["lessonFiles",r])}}),be=E(async t=>(await b.post(`/practice/lessons/${r}`,{title:t.title,description:t.description,type:t.type,instructions:t.metadata})).data.data,{onSuccess:()=>{x.invalidateQueries(["lessonExercises",r]),M({isOpen:!0,title:s("common.success",{defaultValue:"Успешно"}),message:s("practice.createSuccess",{defaultValue:"Упражнение успешно создано!"})})},onError:t=>{f({isOpen:!0,title:s("common.error",{defaultValue:"Ошибка"}),message:t.response?.data?.message||s("practice.createError",{defaultValue:"Ошибка при создании упражнения"})})}}),Pe=E(async t=>(await b.put(`/practice/exercises/${t.exerciseId}`,{title:t.title,instructions:t.instructions})).data.data,{onSuccess:()=>{x.invalidateQueries(["lessonExercises",r]),M({isOpen:!0,title:s("common.success",{defaultValue:"Успешно"}),message:s("practice.updateSuccess",{defaultValue:"Упражнение успешно обновлено!"})}),le({isOpen:!1,exercise:null})},onError:t=>{f({isOpen:!0,title:s("common.error",{defaultValue:"Ошибка"}),message:t.response?.data?.message||s("practice.updateError",{defaultValue:"Ошибка при обновлении упражнения"})})}}),Le=E(async t=>{await b.delete(`/practice/exercises/${t}`)},{onSuccess:()=>{x.invalidateQueries(["lessonExercises",r]),M({isOpen:!0,title:s("common.success",{defaultValue:"Успешно"}),message:s("practice.deleteSuccess",{defaultValue:"Упражнение успешно удалено"})})},onError:t=>{f({isOpen:!0,title:s("common.error",{defaultValue:"Ошибка"}),message:t.response?.data?.message||s("practice.deleteError",{defaultValue:"Ошибка при удалении упражнения"})})}}),Ae=E(async t=>(await b.post(`/lessons/${r}/integrations`,t)).data.data,{onSuccess:()=>{x.invalidateQueries(["lessonIntegrations",r]),M({isOpen:!0,title:s("common.success",{defaultValue:"Успешно"}),message:s("integrations.addSuccess",{defaultValue:"Интеграция успешно добавлена!"})})},onError:t=>{f({isOpen:!0,title:s("common.error",{defaultValue:"Ошибка"}),message:t.response?.data?.message||"Ошибка при добавлении интеграции"})}}),Ge=E(async t=>{await b.delete(`/integrations/${t}`)},{onSuccess:()=>{x.invalidateQueries(["lessonIntegrations",r])}}),Re=()=>{Z({isOpen:!0,title:s("practice.createDragDrop",{defaultValue:"Создать упражнение Drag & Drop"}),label:s("practice.enterExerciseTitle",{defaultValue:"Введите название упражнения:"}),placeholder:s("practice.exerciseTitlePlaceholder",{defaultValue:"Название упражнения"}),required:!0,onConfirm:t=>{if(!t)return;const a={type:"DRAG_DROP",items:[{id:"1",content:"Пример 1"},{id:"2",content:"Пример 2"}],dropZones:[{id:"zone1",label:"Зона 1",correctItemId:"1"},{id:"zone2",label:"Зона 2",correctItemId:"2"}]};be.mutate({title:t,type:"DRAG_DROP",metadata:JSON.stringify(a)})}})},Fe=()=>{Z({isOpen:!0,title:s("practice.createMatching",{defaultValue:"Создать упражнение Matching"}),label:s("practice.enterExerciseTitle",{defaultValue:"Введите название упражнения:"}),placeholder:s("practice.exerciseTitlePlaceholder",{defaultValue:"Название упражнения"}),required:!0,onConfirm:t=>{if(!t)return;const a={type:"MATCHING",items:[{id:"1",left:"Пример 1",right:"Example 1"},{id:"2",left:"Пример 2",right:"Example 2"}]};be.mutate({title:t,type:"MATCHING",metadata:JSON.stringify(a)})}})},Ue=()=>{Z({isOpen:!0,title:s("integrations.addGoogleDocs",{defaultValue:"Добавить Google Docs"}),label:"Введите URL документа Google Docs:",placeholder:"https://docs.google.com/...",required:!0,onConfirm:t=>{t&&setTimeout(()=>{Z({isOpen:!0,title:s("integrations.addGoogleDocs",{defaultValue:"Добавить Google Docs"}),label:s("integrations.enterDocumentTitle",{defaultValue:"Введите название документа (необязательно):"}),placeholder:s("integrations.documentTitlePlaceholder",{defaultValue:"Название документа"}),required:!1,onConfirm:a=>{Ae.mutate({type:"GOOGLE_DOCS",externalUrl:t,metadata:a?JSON.stringify({title:a}):void 0})}})},100)}})},{register:J,handleSubmit:_e,formState:{errors:_},reset:je,setValue:Ne}=rt({resolver:dt(Nt),defaultValues:{courseId:m||"",moduleId:u||"",title:"",description:"",order:0,videoUrl:""}});c.useEffect(()=>{T&&l&&!H.current?(je({courseId:T.courseId,moduleId:T.moduleId||"",title:T.title,description:T.description||"",order:T.order,videoUrl:T.videoUrl||""}),H.current=!0):m&&!l&&!H.current&&(je({courseId:m,moduleId:u||"",title:"",description:"",order:0,videoUrl:""}),H.current=!0),u&&!l&&H.current&&Ne("moduleId",u)},[T,m,l,u]),c.useEffect(()=>{U&&(S(U.title||""),ue(U.description||""),xe(U.passingScore),L(U.questions.map(t=>({question:t.question,type:t.type,options:t.options?.map(a=>({text:a.text,isCorrect:a.isCorrect||!1})),correctAnswer:t.correctAnswer||void 0,metadata:t.metadata||void 0}))),i(!0))},[U]);const Qe=t=>{l?ce.mutate(t):oe.mutate(t)},$e=async t=>{const a=t.target.files?.[0];if(!a||!r)return;const n=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","text/plain","image/jpeg","image/png","image/gif","image/webp","video/mp4","video/webm","video/ogg","video/quicktime","video/x-msvideo","video/x-ms-wmv","video/x-flv","video/mpeg","application/zip","application/x-zip-compressed"],o=/\.(pdf|doc|docx|xls|xlsx|ppt|pptx|txt|zip|jpg|jpeg|png|gif|webp|mp4|webm|ogg|mov|avi|wmv|flv|mpeg|mpg)$/i;if(!n.includes(a.type)&&!o.test(a.name)){f({isOpen:!0,title:s("common.error",{defaultValue:"Ошибка"}),message:"Неподдерживаемый тип файла. Разрешены: документы (PDF, DOC, DOCX, XLS, XLSX, PPT, PPTX), изображения (JPG, PNG, GIF, WebP), видео (MP4, WebM, MOV, AVI и др.), архивы (ZIP)"}),t.target.value="";return}const h=100*1024*1024;if(a.size>h){f({isOpen:!0,title:s("common.error",{defaultValue:"Ошибка"}),message:`Размер файла не должен превышать ${(h/1024/1024).toFixed(0)} MB. Текущий размер: ${(a.size/1024/1024).toFixed(2)} MB`}),t.target.value="";return}w(!0),O({fileName:a.name,progress:0});const D=new FormData;D.append("file",a),D.append("lessonId",r);try{await b.post("/files/upload",D,{headers:{"Content-Type":"multipart/form-data"},timeout:3e5,onUploadProgress:k=>{if(k.total){const A=Math.round(k.loaded*100/k.total);O({fileName:a.name,progress:A})}}}),x.invalidateQueries(["lessonFiles",r]),O(null),M({isOpen:!0,title:s("common.success",{defaultValue:"Успешно"}),message:"Файл успешно загружен"})}catch(k){let A="Ошибка при загрузке файла";k.isNetworkError?A="Ошибка сети. Проверьте подключение к интернету и попробуйте снова.":k.isTimeout?A="Превышено время ожидания. Файл слишком большой или соединение медленное.":A=k.response?.data?.message||A,f({isOpen:!0,title:s("common.error",{defaultValue:"Ошибка"}),message:A}),O(null)}finally{w(!1),t.target.value=""}},qe=async t=>{const a=t.target.files?.[0];if(!a)return;if(!["video/mp4","video/webm","video/ogg","video/quicktime","video/x-msvideo","video/x-ms-wmv","video/x-flv","video/mpeg"].includes(a.type)&&!a.name.match(/\.(mp4|webm|ogg|mov|avi|wmv|flv|mpeg|mpg)$/i)){f({isOpen:!0,title:s("common.error",{defaultValue:"Ошибка"}),message:"Пожалуйста, выберите видео файл (MP4, WebM, MOV, AVI и т.д.)"}),t.target.value="";return}if(a.size>500*1024*1024){f({isOpen:!0,title:s("common.error",{defaultValue:"Ошибка"}),message:"Размер видео файла не должен превышать 500 MB"}),t.target.value="";return}v(!0),P({fileName:a.name,progress:0});const o=new FormData;o.append("file",a),r&&o.append("lessonId",r);try{const h=await b.post("/files/upload",o,{headers:{"Content-Type":"multipart/form-data"},timeout:6e5,onUploadProgress:D=>{if(D.total){const k=Math.round(D.loaded*100/D.total);P({fileName:a.name,progress:k})}}});h.data.data?.fileUrl&&(Ne("videoUrl",h.data.data.fileUrl),r&&x.invalidateQueries(["lessonFiles",r]),M({isOpen:!0,title:s("common.success",{defaultValue:"Успешно"}),message:"Видео успешно загружено! Не забудьте сохранить урок."})),P(null)}catch(h){let D="Ошибка при загрузке видео";h.isNetworkError?D="Ошибка сети. Проверьте подключение к интернету и попробуйте снова.":h.isTimeout?D="Превышено время ожидания. Видео слишком большое или соединение медленное. Попробуйте загрузить файл меньшего размера или используйте прямую ссылку на видео.":D=h.response?.data?.message||D,f({isOpen:!0,title:s("common.error",{defaultValue:"Ошибка"}),message:D}),P(null)}finally{v(!1),t.target.value=""}},He=t=>{K({isOpen:!0,title:s("files.deleteFile",{defaultValue:"Удалить файл"}),message:s("files.deleteConfirm",{defaultValue:"Вы уверены, что хотите удалить этот файл?"}),variant:"danger",onConfirm:()=>{Te.mutate(t)}})},Ze=()=>{L([...V,{question:"",type:"MULTIPLE_CHOICE",options:[{text:"",isCorrect:!1},{text:"",isCorrect:!1}],metadata:void 0}])},Je=t=>{L(V.filter((a,n)=>n!==t))},Y=(t,a,n)=>{const o=[...V];o[t]={...o[t],[a]:n},a==="type"&&(n==="TRUE_FALSE"?(o[t].options=void 0,o[t].metadata=void 0):n==="MULTIPLE_CHOICE"&&!o[t].options?(o[t].options=[{text:"",isCorrect:!1},{text:"",isCorrect:!1}],o[t].metadata=void 0):(n==="DRAG_DROP"||n==="MATCHING"||n==="FILL_BLANK")&&(o[t].options=void 0,o[t].metadata||(n==="DRAG_DROP"?o[t].metadata=JSON.stringify({items:[],targets:[],correctMapping:{}}):n==="MATCHING"?o[t].metadata=JSON.stringify({leftItems:[],rightItems:[],correctPairs:[]}):n==="FILL_BLANK"&&(o[t].metadata=JSON.stringify({text:"",blanks:[]}))))),L(o)},Be=t=>{const a=[...V];a[t].options||(a[t].options=[]),a[t].options.push({text:"",isCorrect:!1}),L(a)},We=(t,a)=>{const n=[...V];n[t].options&&(n[t].options=n[t].options.filter((o,h)=>h!==a)),L(n)},ve=(t,a,n,o)=>{const h=[...V];h[t].options&&(h[t].options[a]={...h[t].options[a],[n]:o}),L(h)},Xe=()=>{if(!r){f({isOpen:!0,title:s("common.error",{defaultValue:"Ошибка"}),message:s("lessons.saveLessonFirst",{defaultValue:"Сначала сохраните урок"})});return}for(let t=0;t<V.length;t++){const a=V[t];if(!a.question.trim()){f({isOpen:!0,title:s("common.error",{defaultValue:"Ошибка"}),message:s("quiz.enterQuestionText",{questionNum:t+1,defaultValue:`Вопрос ${t+1}: введите текст вопроса`})});return}if(a.type==="MULTIPLE_CHOICE"){if(!a.options||a.options.length<2){f({isOpen:!0,title:s("common.error",{defaultValue:"Ошибка"}),message:s("quiz.addMinOptions",{questionNum:t+1,defaultValue:`Вопрос ${t+1}: добавьте минимум 2 варианта ответа`})});return}if(!a.options.some(o=>o.isCorrect)){f({isOpen:!0,title:s("common.error",{defaultValue:"Ошибка"}),message:s("quiz.selectCorrectAnswer",{questionNum:t+1,defaultValue:`Вопрос ${t+1}: выберите правильный ответ`})});return}for(let o=0;o<a.options.length;o++)if(!a.options[o].text.trim()){f({isOpen:!0,title:s("common.error",{defaultValue:"Ошибка"}),message:`Вопрос ${t+1}, вариант ${o+1}: введите текст варианта`});return}}else if(a.type==="TRUE_FALSE"){if(!a.correctAnswer){f({isOpen:!0,title:s("common.error",{defaultValue:"Ошибка"}),message:s("quiz.selectTrueFalse",{questionNum:t+1,defaultValue:`Вопрос ${t+1}: выберите правильный ответ (Верно/Неверно)`})});return}}else if(a.type==="DRAG_DROP"||a.type==="MATCHING"||a.type==="FILL_BLANK"){if(!a.metadata||!a.metadata.trim()){f({isOpen:!0,title:s("common.error",{defaultValue:"Ошибка"}),message:s("quiz.fillMetadata",{questionNum:t+1,defaultValue:`Вопрос ${t+1}: заполните метаданные для интерактивного задания`})});return}try{JSON.parse(a.metadata)}catch{f({isOpen:!0,title:s("common.error",{defaultValue:"Ошибка"}),message:s("quiz.metadataMustBeJson",{questionNum:t+1,defaultValue:`Вопрос ${t+1}: метаданные должны быть в формате JSON`})});return}}}ne.mutate()};if(ke)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block relative",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-primary-200 border-t-primary-500"})}),e.jsx("p",{className:"mt-4 text-neutral-600",children:s("common.loading")})]});const ye=Ee||[];return e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>j(`/teacher/courses/${m}/edit`),className:"flex items-center text-neutral-600 hover:text-primary-600 mb-6 transition-colors animate-slide-in",children:[e.jsx(it,{className:"h-5 w-5 mr-2"}),s("common.back")," ",s("courses.title")]}),e.jsx("div",{className:"relative mb-8 animate-fade-scale",children:e.jsx("h1",{className:"text-2xl md:text-3xl lg:text-5xl font-bold text-gradient",children:s(l?"lessons.editLesson":"lessons.createLesson")})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx("div",{className:"card p-6 animate-fade-scale",children:e.jsxs("form",{onSubmit:_e(Qe),className:"space-y-6",children:[e.jsxs("div",{className:"animate-slide-in",style:{animationDelay:"0.1s"},children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-neutral-700 mb-2",children:s("lessons.lessonTitle")}),e.jsx("input",{...J("title"),type:"text",className:"input-field",placeholder:s("lessons.lessonTitle")}),_.title&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:_.title.message})]}),e.jsxs("div",{className:"animate-slide-in",style:{animationDelay:"0.2s"},children:[e.jsxs("label",{htmlFor:"moduleId",className:"block text-sm font-medium text-neutral-700 mb-2",children:[s("modules.title")," ",e.jsxs("span",{className:"text-neutral-500 text-xs",children:["(",s("common.optional"),")"]})]}),e.jsxs("select",{...J("moduleId"),className:"input-field",children:[e.jsx("option",{value:"",children:s("courses.notSelected")}),(ze||[]).map(t=>e.jsx("option",{value:t.id,children:t.title},t.id))]})]}),e.jsxs("div",{className:"animate-slide-in",style:{animationDelay:"0.3s"},children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-neutral-700 mb-2",children:s("lessons.lessonDescription")}),e.jsx("textarea",{...J("description"),rows:4,className:"input-field",placeholder:s("lessons.lessonDescription")})]}),e.jsxs("div",{className:"animate-slide-in",style:{animationDelay:"0.4s"},children:[e.jsx("label",{htmlFor:"order",className:"block text-sm font-medium text-neutral-700 mb-2",children:s("lessons.order")}),e.jsx("input",{...J("order",{valueAsNumber:!0}),type:"number",min:"0",className:"input-field"}),_.order&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:_.order.message})]}),e.jsxs("div",{className:"animate-slide-in",style:{animationDelay:"0.5s"},children:[e.jsx("label",{htmlFor:"videoUrl",className:"block text-sm font-medium text-neutral-700 mb-2",children:"Видео урока"}),g&&e.jsx(Oe,{fileName:g.fileName,progress:g.progress,onCancel:()=>{v(!1),P(null),R.current&&(R.current.value="")}}),e.jsxs("div",{className:"mb-3",children:[e.jsx("input",{ref:R,type:"file",accept:"video/mp4,video/webm,video/ogg,video/quicktime,video/x-msvideo,video/x-ms-wmv,video/x-flv,video/mpeg,.mp4,.webm,.ogg,.mov,.avi,.wmv,.flv,.mpeg,.mpg",onChange:qe,disabled:N,className:"hidden"}),e.jsxs("button",{type:"button",onClick:()=>R.current?.click(),disabled:N,className:"w-full px-4 py-2 border-2 border-dashed border-primary-300 rounded-lg hover:border-primary-500 cursor-pointer transition-all hover:bg-primary-50 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5 text-primary-500"}),N?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"animate-spin",children:"⟳"}),e.jsx("span",{children:"Загрузка видео..."})]}):e.jsx("span",{children:"Загрузить видео с компьютера (MP4, WebM, MOV, AVI и т.д.)"})]}),e.jsx("p",{className:"mt-1 text-xs text-neutral-500",children:"Максимальный размер: 500 MB. Поддерживаются: MP4, WebM, MOV, AVI, WMV, FLV, MPEG"})]}),e.jsxs("div",{className:"flex items-center gap-3 my-4",children:[e.jsx("div",{className:"flex-1 border-t border-neutral-300"}),e.jsx("span",{className:"text-xs text-neutral-500",children:"или"}),e.jsx("div",{className:"flex-1 border-t border-neutral-300"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"videoUrl",className:"block text-sm font-medium text-neutral-700 mb-2",children:"Или введите URL видео"}),e.jsx("input",{...J("videoUrl"),type:"url",placeholder:"YouTube, Vimeo, Google Drive, VK или прямая ссылка на видео",className:"input-field"}),_.videoUrl&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:_.videoUrl.message}),e.jsx("p",{className:"mt-1 text-sm text-neutral-500",children:"Поддерживаются: YouTube, Vimeo, Google Drive, VK и прямые ссылки на видео (mp4, webm и т.д.)"}),e.jsxs("div",{className:"mt-2 text-xs text-neutral-400 space-y-1",children:[e.jsx("p",{children:"Примеры:"}),e.jsx("p",{children:"• YouTube: https://www.youtube.com/watch?v=..."}),e.jsx("p",{children:"• Vimeo: https://vimeo.com/123456789"}),e.jsx("p",{children:"• Google Drive: https://drive.google.com/file/d/FILE_ID/view"}),e.jsx("p",{children:"• VK: https://vk.com/video-123456789_123456789"}),e.jsx("p",{children:"• Прямая ссылка: https://example.com/video.mp4"})]})]})]}),e.jsx("div",{className:"animate-slide-in",style:{animationDelay:"0.5s"},children:e.jsxs("button",{type:"submit",disabled:oe.isLoading||ce.isLoading,className:"btn-primary w-full disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(de,{className:"h-5 w-5 mr-2"}),oe.isLoading||ce.isLoading?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"animate-spin",children:"⟳"})," ",e.jsx("span",{children:"Сохранение..."})]}):e.jsx("span",{children:"Сохранить"})]})})]})})}),l&&e.jsxs("div",{className:"space-y-6 animate-fade-scale",style:{animationDelay:"0.6s"},children:[e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold text-neutral-900 flex items-center gap-2",children:[e.jsx(Ce,{className:"h-5 w-5 text-primary-500"}),s("quiz.lessonQuiz",{defaultValue:"Тест к уроку"})]}),e.jsx("button",{type:"button",onClick:()=>i(!q),className:"text-sm text-primary-600 hover:text-primary-700",children:s(q?"common.hide":"common.show")})]}),q&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:[s("quiz.quizTitle")," (",s("common.optional"),")"]}),e.jsx("input",{type:"text",value:d,onChange:t=>S(t.target.value),placeholder:s("quiz.quizTitleExample",{defaultValue:"Например: Проверочный тест"}),className:"input-field"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:[s("quiz.quizDescription")," (",s("common.optional"),")"]}),e.jsx("textarea",{value:I,onChange:t=>ue(t.target.value),rows:2,placeholder:s("quiz.quizDescription"),className:"input-field"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:s("quiz.passingScore")}),e.jsx("input",{type:"number",min:"0",max:"100",value:pe,onChange:t=>xe(Number(t.target.value)),className:"input-field"})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-neutral-900",children:s("quiz.questions")}),e.jsxs("button",{type:"button",onClick:Ze,className:"btn-secondary text-sm inline-flex items-center",children:[e.jsx(G,{className:"h-4 w-4 mr-1"}),s("quiz.addQuestion")]})]}),V.length===0?e.jsx("p",{className:"text-sm text-neutral-500 text-center py-4",children:s("quiz.noQuestions",{defaultValue:"Нет вопросов. Добавьте первый вопрос."})}):e.jsx("div",{className:"space-y-4",children:V.map((t,a)=>e.jsxs("div",{className:"border border-neutral-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("span",{className:"text-sm font-medium text-neutral-700",children:[s("quiz.question")," ",a+1]}),e.jsx("button",{type:"button",onClick:()=>Je(a),className:"text-red-500 hover:text-red-600",children:e.jsx(te,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"mb-3",children:e.jsx("input",{type:"text",value:t.question,onChange:n=>Y(a,"question",n.target.value),placeholder:"Введите вопрос...",className:"input-field"})}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:s("quiz.questionType",{defaultValue:"Тип вопроса"})}),e.jsxs("select",{value:t.type,onChange:n=>Y(a,"type",n.target.value),className:"input-field",children:[e.jsx("option",{value:"MULTIPLE_CHOICE",children:s("quiz.multipleChoice")}),e.jsx("option",{value:"TRUE_FALSE",children:s("quiz.trueFalse")}),e.jsx("option",{value:"DRAG_DROP",children:s("quiz.dragDrop")}),e.jsx("option",{value:"MATCHING",children:s("quiz.matching")}),e.jsx("option",{value:"FILL_BLANK",children:s("quiz.fillBlank")})]})]}),t.type==="MULTIPLE_CHOICE"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-sm font-medium text-neutral-700",children:"Варианты ответов"}),e.jsxs("button",{type:"button",onClick:()=>Be(a),className:"text-xs text-primary-600 hover:text-primary-700",children:["+ ",s("quiz.addOption")]})]}),t.options?.map((n,o)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:n.text,onChange:h=>ve(a,o,"text",h.target.value),placeholder:`Вариант ${o+1}`,className:"input-field flex-1"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:n.isCorrect,onChange:h=>ve(a,o,"isCorrect",h.target.checked),className:"w-4 h-4"}),e.jsx("span",{className:"text-sm text-neutral-600",children:"Правильный"})]}),t.options.length>2&&e.jsx("button",{type:"button",onClick:()=>We(a,o),className:"text-red-500 hover:text-red-600",children:e.jsx($,{className:"h-4 w-4"})})]},o))]}),t.type==="TRUE_FALSE"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Правильный ответ"}),e.jsxs("select",{value:t.correctAnswer||"",onChange:n=>Y(a,"correctAnswer",n.target.value),className:"input-field",children:[e.jsx("option",{value:"",children:"Выберите ответ"}),e.jsx("option",{value:"true",children:"Верно"}),e.jsx("option",{value:"false",children:"Неверно"})]})]}),(t.type==="DRAG_DROP"||t.type==="MATCHING"||t.type==="FILL_BLANK")&&e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("p",{className:"text-sm text-blue-800 mb-2",children:[e.jsx("strong",{children:"Интерактивные задания"})," требуют настройки метаданных."]}),e.jsx("p",{className:"text-xs text-blue-600",children:"Для создания таких заданий используйте JSON формат в поле метаданных. Примеры форматов можно найти в документации."}),e.jsx("textarea",{value:t.metadata||"",onChange:n=>Y(a,"metadata",n.target.value),placeholder:'{"items": [...], "targets": [...], "correctMapping": {...}}',rows:4,className:"input-field mt-2 font-mono text-xs"})]})]},a))}),e.jsx("button",{type:"button",onClick:Xe,disabled:ne.isLoading||V.length===0,className:"btn-primary w-full mt-4 disabled:opacity-50 disabled:cursor-not-allowed",children:ne.isLoading?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"animate-spin",children:"⟳"}),e.jsx("span",{children:"Сохранение..."})]}):"Сохранить тест"})]})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-neutral-900 mb-4",children:"Файлы урока"}),C&&e.jsx(Oe,{fileName:C.fileName,progress:C.progress,onCancel:()=>{w(!1),O(null)}}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block w-full",children:[e.jsx("input",{type:"file",onChange:$e,disabled:y||!r,accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.zip,.jpg,.jpeg,.png,.gif,.webp,.mp4,.webm,.ogg,.mov,.avi,.wmv,.flv,.mpeg",className:"hidden"}),e.jsxs("span",{className:"flex items-center justify-center w-full px-4 py-2 border-2 border-dashed border-neutral-300 rounded-lg hover:border-primary-400 cursor-pointer transition-all hover:bg-primary-50 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ee,{className:"h-5 w-5 mr-2 text-primary-500"}),y?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"animate-spin",children:"⟳"}),e.jsx("span",{children:"Загрузка..."})]}):r?e.jsx("span",{children:"Загрузить файл (PDF, DOC, видео, изображения и др.)"}):e.jsx("span",{className:"text-neutral-500",children:"Сначала сохраните урок"})]})]}),e.jsx("p",{className:"mt-2 text-xs text-neutral-500",children:"Поддерживаются: документы (PDF, DOC, DOCX, XLS, XLSX, PPT, PPTX), изображения (JPG, PNG, GIF, WebP), видео (MP4, WebM, MOV, AVI и др.), архивы (ZIP). Максимальный размер: 100 MB"})]}),ye.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("p",{className:"text-neutral-500",children:"Нет файлов"}),e.jsx("p",{className:"text-xs text-neutral-400 mt-1",children:"Загрузите файлы к уроку (PDF, документы, видео и др.)"})]}):e.jsx("div",{className:"space-y-2",children:ye.map((t,a)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-neutral-200 rounded-lg hover:border-primary-300 hover:bg-neutral-50 transition-all animate-slide-in",style:{animationDelay:`${.1*a}s`},children:[e.jsxs("div",{className:"flex items-center flex-1 min-w-0",children:[e.jsx("div",{className:"flex-shrink-0 mr-3",children:t.fileName.match(/\.(pdf|doc|docx)$/i)?e.jsx(Ce,{className:"h-5 w-5 text-blue-500"}):t.fileName.match(/\.(mp4|webm|mov|avi)$/i)?e.jsx(nt,{className:"h-5 w-5 text-purple-500"}):e.jsx(ee,{className:"h-5 w-5 text-primary-500"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-neutral-900 truncate",children:t.fileName}),e.jsxs("p",{className:"text-xs text-neutral-500",children:[(t.fileSize/1024/1024).toFixed(2)," MB"]})]})]}),e.jsx("button",{onClick:()=>He(t.id),className:"ml-2 p-1 text-red-500 hover:text-red-600 hover:bg-red-50 rounded transition-all",title:"Удалить",children:e.jsx($,{className:"h-4 w-4"})})]},t.id))})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold text-neutral-900 flex items-center gap-2",children:[e.jsx(ot,{className:"h-5 w-5 text-primary-500"}),"Интерактивные упражнения"]}),e.jsx("button",{type:"button",onClick:()=>Ve(!se),className:"text-sm text-primary-600 hover:text-primary-700",children:se?"Скрыть":"Показать"})]}),se&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("button",{type:"button",onClick:Re,className:"btn-secondary flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),"Добавить Drag & Drop"]}),e.jsxs("button",{type:"button",onClick:Fe,className:"btn-secondary flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),"Добавить Matching"]})]}),fe.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("p",{className:"text-neutral-500",children:"Нет упражнений"}),e.jsx("p",{className:"text-sm text-neutral-400 mt-1",children:"Создайте упражнение, нажав на кнопки выше"})]}):e.jsx("div",{className:"space-y-4",children:fe.map(t=>e.jsx("div",{className:"p-4 border border-neutral-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-neutral-900 mb-1",children:t.title}),t.description&&e.jsx("p",{className:"text-sm text-neutral-600 mb-1",children:t.description}),e.jsxs("p",{className:"text-sm text-neutral-600",children:["Тип: ",e.jsx("span",{className:"font-medium",children:t.type==="DRAG_DROP"?"Drag & Drop":t.type==="MATCHING"?"Matching":t.type})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>{le({isOpen:!0,exercise:t})},className:"px-3 py-1.5 text-sm font-medium text-primary-600 hover:text-primary-700 hover:bg-primary-50 rounded-lg transition-colors flex items-center gap-1.5",title:"Редактировать упражнение",children:[e.jsx(de,{className:"h-4 w-4"}),"Редактировать"]}),e.jsx("button",{type:"button",onClick:()=>{K({isOpen:!0,title:s("practice.deleteExercise",{defaultValue:"Удалить упражнение"}),message:s("practice.deleteConfirm",{defaultValue:"Удалить это упражнение?"}),variant:"danger",onConfirm:()=>{Le.mutate(t.id)}})},className:"text-red-500 hover:text-red-600 p-1.5 hover:bg-red-50 rounded transition-colors",title:"Удалить упражнение",children:e.jsx($,{className:"h-4 w-4"})})]})]})},t.id))})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold text-neutral-900 flex items-center gap-2",children:[e.jsx(ct,{className:"h-5 w-5 text-primary-500"}),"Интеграции"]}),e.jsx("button",{type:"button",onClick:()=>Se(!ae),className:"text-sm text-primary-600 hover:text-primary-700",children:ae?"Скрыть":"Показать"})]}),ae&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex gap-2 flex-wrap",children:e.jsxs("button",{type:"button",onClick:Ue,className:"btn-secondary flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),"Добавить Google Docs"]})}),he.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("p",{className:"text-neutral-500",children:"Нет интеграций"}),e.jsx("p",{className:"text-sm text-neutral-400 mt-1",children:"Добавьте интеграцию, нажав на кнопку выше"})]}):e.jsx("div",{className:"space-y-4",children:he.map(t=>e.jsxs("div",{className:"p-4 border border-neutral-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold text-neutral-900",children:t.type==="GOOGLE_DOCS"?"Google Docs":t.type}),e.jsx("button",{type:"button",onClick:()=>{K({isOpen:!0,title:s("integrations.deleteIntegration",{defaultValue:"Удалить интеграцию"}),message:s("integrations.deleteConfirm",{defaultValue:"Удалить эту интеграцию?"}),variant:"danger",onConfirm:()=>{Ge.mutate(t.id)}})},className:"text-red-500 hover:text-red-600",children:e.jsx($,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-sm text-neutral-600 break-all",children:t.externalUrl}),t.type==="GOOGLE_DOCS"&&e.jsx("div",{className:"mt-4",children:e.jsx(ht,{docUrl:t.externalUrl,title:t.metadata?JSON.parse(t.metadata).title:void 0})})]},t.id))}),r&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Импорт из Quizlet"}),e.jsx(gt,{lessonId:r,onImportComplete:t=>{M({isOpen:!0,title:s("common.success",{defaultValue:"Успешно"}),message:s("flashcards.imported",{count:t.length,defaultValue:`Импортировано ${t.length} карточек!`})}),x.invalidateQueries(["lessonFlashcardDecks",r])}})]})]})]})]})]}),e.jsx(bt,{isOpen:z.isOpen,onClose:()=>Z({...z,isOpen:!1}),onConfirm:z.onConfirm,title:z.title,label:z.label,placeholder:z.placeholder,defaultValue:z.defaultValue,required:z.required}),e.jsx(xt,{isOpen:W.isOpen,onClose:()=>f({...W,isOpen:!1}),title:W.title,message:W.message}),e.jsx(ft,{isOpen:X.isOpen,onClose:()=>M({...X,isOpen:!1}),title:X.title,message:X.message}),e.jsx(pt,{isOpen:F.isOpen,onClose:()=>K({...F,isOpen:!1}),onConfirm:F.onConfirm,title:F.title,message:F.message,variant:F.variant||"warning"}),e.jsx(jt,{isOpen:ge.isOpen,onClose:()=>le({isOpen:!1,exercise:null}),onSave:t=>{Pe.mutate({exerciseId:t.id,title:t.title,instructions:t.instructions})},exercise:ge.exercise})]})}export{Ot as default};
