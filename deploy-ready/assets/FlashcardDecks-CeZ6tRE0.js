import{e as R,j as e,p as S,s as j,D as $,a4 as K,ae as Q,ax as v,aI as w,az as C,aA as D,aB as k,aC as A,aJ as O,aH as T,a2 as U,k as H,u as Y,r as d,f as E,aN as _,Z as q,a7 as z,L as M,aU as G,T as J}from"./vendor-DS3OdKc2.js";import{a as m,u as W,C as X}from"./index-BAsZs2-V.js";import{E as Z}from"./ErrorModal-CX1_5zyu.js";function ee({deckId:a}){const{data:o,isLoading:i}=R(["flashcardAnalytics",a],async()=>(await m.get(`/flashcards/${a}/analytics`)).data),t=o?.data;if(i)return e.jsxs("div",{className:"card p-6 animate-pulse",children:[e.jsx("div",{className:"h-6 bg-neutral-200 rounded w-1/3 mb-4"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Array.from({length:4}).map((l,c)=>e.jsx("div",{className:"h-20 bg-neutral-200 rounded"},c))})]});if(!t)return null;const r=[{name:"Новые",value:t.difficultyDistribution.NEW,color:"#94a3b8"},{name:"Сложные",value:t.difficultyDistribution.HARD,color:"#ef4444"},{name:"Средние",value:t.difficultyDistribution.MEDIUM,color:"#f59e0b"},{name:"Легкие",value:t.difficultyDistribution.EASY,color:"#10b981"}].filter(l=>l.value>0),n=[{name:"Изучено",value:t.studiedCards,color:"#10b981"},{name:"Не изучено",value:t.unstudiedCards,color:"#e5e7eb"}];return e.jsxs("div",{className:"card p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(S,{className:"h-6 w-6 text-primary-600"}),e.jsxs("h3",{className:"text-xl font-bold text-neutral-900",children:["Аналитика: ",t.deckTitle]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary-50 to-primary-50 p-4 rounded-xl border-2 border-primary-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(j,{className:"h-5 w-5 text-primary-600"}),e.jsx("span",{className:"text-2xl font-bold text-primary-700",children:t.totalCards})]}),e.jsx("p",{className:"text-sm text-neutral-600",children:"Всего карточек"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-accent-50 to-accent-50 p-4 rounded-xl border-2 border-accent-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx($,{className:"h-5 w-5 text-accent-600"}),e.jsx("span",{className:"text-2xl font-bold text-accent-700",children:t.studiedCards})]}),e.jsxs("p",{className:"text-sm text-neutral-600",children:["Изучено (",t.studiedPercentage,"%)"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-education-50 to-education-50 p-4 rounded-xl border-2 border-education-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(K,{className:"h-5 w-5 text-education-600"}),e.jsx("span",{className:"text-2xl font-bold text-education-700",children:t.dueForReview})]}),e.jsx("p",{className:"text-sm text-neutral-600",children:"К повторению"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-primary-50 to-accent-50 p-4 rounded-xl border-2 border-primary-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Q,{className:"h-5 w-5 text-primary-600"}),e.jsx("span",{className:"text-2xl font-bold text-primary-700",children:t.masteredCards})]}),e.jsxs("p",{className:"text-sm text-neutral-600",children:["Освоено (",t.masteryPercentage,"%)"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-6",children:[r.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-neutral-900 mb-4",children:"Распределение по сложности"}),e.jsx(v,{width:"100%",height:200,children:e.jsxs(w,{data:r,children:[e.jsx(C,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(D,{dataKey:"name"}),e.jsx(k,{}),e.jsx(A,{}),e.jsx(O,{dataKey:"value",fill:"#8884d8",children:r.map((l,c)=>e.jsx(T,{fill:l.color},`cell-${c}`))})]})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-neutral-900 mb-4",children:"Прогресс изучения"}),e.jsx(v,{width:"100%",height:200,children:e.jsxs(w,{data:n,children:[e.jsx(C,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(D,{dataKey:"name"}),e.jsx(k,{}),e.jsx(A,{}),e.jsx(O,{dataKey:"value",children:n.map((l,c)=>e.jsx(T,{fill:l.color},`cell-${c}`))})]})})]})]}),e.jsxs("div",{className:"mt-6 p-4 bg-primary-50 rounded-xl border-2 border-primary-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(U,{className:"h-5 w-5 text-primary-600"}),e.jsx("h4",{className:"font-semibold text-neutral-900",children:"Дополнительная статистика"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-neutral-600",children:"Среднее количество повторений"}),e.jsx("p",{className:"text-lg font-bold text-primary-700",children:t.averageReviewCount})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-neutral-600",children:"Процент изучения"}),e.jsxs("p",{className:"text-lg font-bold text-primary-700",children:[t.studiedPercentage,"%"]})]})]})]})]})}function re(){const{t:a}=H(),o=Y(),{user:i}=W(),[t,r]=d.useState(!1),[n,l]=d.useState(""),[c,x]=d.useState(""),[b,F]=d.useState(null),[N,g]=d.useState({isOpen:!1,message:""}),[h,u]=d.useState({isOpen:!1,deckId:null}),{data:I,isLoading:P}=R("flashcardDecks",async()=>(await m.get("/flashcards")).data.data||[]),f=E(async s=>(await m.post("/flashcards",s)).data.data,{onSuccess:()=>{o.invalidateQueries("flashcardDecks"),r(!1),l(""),x("")}}),V=E(async s=>{await m.delete(`/flashcards/${s}`)},{onSuccess:()=>{o.invalidateQueries("flashcardDecks")}}),L=()=>{if(!n.trim()){g({isOpen:!0,message:a("flashcards.enterTitle",{defaultValue:"Введите название колоды"})});return}f.mutate({title:n,description:c||void 0,isPublic:!1})},B=s=>{u({isOpen:!0,deckId:s})},p=i?.role==="TEACHER"||i?.role==="ADMIN"||i?.role==="MODERATOR"||i?.role==="CURATOR";if(P)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block relative",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-primary-200 border-t-primary-500"})}),e.jsx("p",{className:"mt-4 text-neutral-600",children:a("common.loading")})]});const y=I||[];return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsx("h1",{className:"text-2xl md:text-3xl lg:text-5xl font-bold text-gradient",children:a("flashcards.title")}),p&&e.jsxs("button",{onClick:()=>r(!t),className:"btn-primary",children:[e.jsx(_,{className:"h-5 w-5 mr-2"}),a("flashcards.createDeck")]})]}),t&&e.jsxs("div",{className:"card p-6 mb-6 animate-fade-scale",children:[e.jsx("h2",{className:"text-xl font-semibold text-neutral-900 mb-4",children:a("flashcards.createNewDeck",{defaultValue:"Создать новую колоду"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:a("flashcards.deckTitle")}),e.jsx("input",{type:"text",value:n,onChange:s=>l(s.target.value),placeholder:a("flashcards.deckTitleExample",{defaultValue:"Например: Английские слова"}),className:"input-field"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:[a("flashcards.deckDescription")," (",a("common.optional"),")"]}),e.jsx("textarea",{value:c,onChange:s=>x(s.target.value),placeholder:a("flashcards.deckDescriptionPlaceholder",{defaultValue:"Описание колоды..."}),rows:3,className:"input-field"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:L,disabled:f.isLoading,className:"btn-primary disabled:opacity-50",children:f.isLoading?a("common.loading"):a("common.create")}),e.jsx("button",{onClick:()=>{r(!1),l(""),x("")},className:"btn-secondary",children:a("common.cancel")})]})]})]}),y.length===0?e.jsxs("div",{className:"text-center py-12 animate-fade-scale",children:[e.jsx(j,{className:"h-16 w-16 text-neutral-300 mx-auto mb-4"}),e.jsx("p",{className:"text-neutral-500",children:a("flashcards.noDecks")}),p&&e.jsx("button",{onClick:()=>r(!0),className:"btn-primary mt-4",children:a("flashcards.createFirstDeck",{defaultValue:"Создать первую колоду"})})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:y.map(s=>e.jsxs("div",{className:"card p-6 hover:shadow-lg transition-all animate-fade-scale",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-900 mb-2",children:s.title}),s.description&&e.jsx("p",{className:"text-sm text-neutral-600 mb-3 line-clamp-2",children:s.description}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-neutral-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(j,{className:"h-4 w-4"}),s._count?.flashcards||0," ",a("flashcards.cards")]}),s.isPublic?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(q,{className:"h-4 w-4"}),a("flashcards.public")]}):e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(z,{className:"h-4 w-4"}),a("flashcards.private")]})]}),s.creator&&e.jsxs("p",{className:"text-xs text-neutral-400 mt-2",children:[a("flashcards.author",{defaultValue:"Автор"}),": ",s.creator.firstName," ",s.creator.lastName]})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(M,{to:`/flashcards/${s.id}/study`,className:"btn-primary flex-1 text-center",children:a("flashcards.study")}),e.jsx("button",{onClick:()=>F(b===s.id?null:s.id),className:"btn-secondary",title:"Аналитика",children:e.jsx(S,{className:"h-4 w-4"})}),p&&s.createdBy===i?.id&&e.jsxs(e.Fragment,{children:[e.jsx(M,{to:`/flashcards/${s.id}/edit`,className:"btn-secondary",children:e.jsx(G,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>B(s.id),className:"btn-secondary text-red-600 hover:text-red-700",children:e.jsx(J,{className:"h-4 w-4"})})]})]}),b===s.id&&e.jsx("div",{className:"mt-4",children:e.jsx(ee,{deckId:s.id})})]},s.id))}),e.jsx(Z,{isOpen:N.isOpen,onClose:()=>g({isOpen:!1,message:""}),message:N.message}),e.jsx(X,{isOpen:h.isOpen,onClose:()=>u({isOpen:!1,deckId:null}),onConfirm:()=>{h.deckId&&(V.mutate(h.deckId),u({isOpen:!1,deckId:null}))},title:a("flashcards.deleteDeck",{defaultValue:"Удалить колоду"}),message:a("flashcards.deleteConfirm",{defaultValue:"Вы уверены, что хотите удалить эту колоду?"}),variant:"danger"})]})}export{re as default};
