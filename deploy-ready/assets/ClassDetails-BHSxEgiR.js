import{af as M,d as Q,u as I,r as h,e as f,f as m,j as e,as as $,M as R,an as A,T as g,q as v,ad as L,v as T,aP as y,b2 as q,b3 as O}from"./vendor-DlLoZmjg.js";import{E as n,a as r}from"./index-BKx-YTe7.js";import{C as G}from"./ClassFormModal-dRfXnUnt.js";function z(){const{id:a}=M(),i=Q(),l=I(),[b,x]=h.useState(!1),[w,c]=h.useState(!1),[C,u]=h.useState(!1),{data:t,isLoading:E}=f(["class",a],async()=>(await r.get(`/classes/${a}`)).data.data,{enabled:!!a}),{data:k}=f(["students"],async()=>(await r.get("/students")).data.data||[]),d=m(async()=>{await r.delete(`/classes/${a}`)},{onSuccess:()=>{l.invalidateQueries("classes"),i("/teacher/classes")}}),N=m(async s=>(await r.post(`/classes/${a}/students`,{studentId:s})).data.data,{onSuccess:()=>{l.invalidateQueries(["class",a]),l.invalidateQueries("classes"),c(!1)}}),S=m(async s=>{await r.delete(`/classes/${a}/students/${s}`)},{onSuccess:()=>{l.invalidateQueries(["class",a]),l.invalidateQueries("classes")}}),j=m(async({studentId:s,status:o})=>{await r.put(`/classes/${a}/students/${s}/status`,{status:o})},{onSuccess:()=>{l.invalidateQueries(["class",a]),l.invalidateQueries("classes")}});if(E)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block relative",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-primary-200 border-t-primary-500"})}),e.jsx("p",{className:"mt-4 text-neutral-600",children:"Загрузка класса..."})]});if(!t)return e.jsxs("div",{className:"card p-12 text-center",children:[e.jsx("h3",{className:"text-xl font-semibold text-neutral-700 mb-2",children:"Класс не найден"}),e.jsx("button",{onClick:()=>i("/teacher/classes"),className:"btn-primary mt-4",children:"Вернуться к списку классов"})]});const D=s=>{switch(s){case n.APPROVED:return"bg-green-100 text-green-700 border-green-200";case n.PENDING:return"bg-yellow-100 text-yellow-700 border-yellow-200";case n.REJECTED:return"bg-red-100 text-red-700 border-red-200";default:return"bg-gray-100 text-gray-700 border-gray-200"}},P=s=>{switch(s){case n.APPROVED:return"Одобрен";case n.PENDING:return"Ожидает";case n.REJECTED:return"Отклонен";default:return s}},p=k?.filter(s=>!t.students?.some(o=>o.studentId===s.id))||[];return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:()=>i("/teacher/classes"),className:"p-2 text-neutral-600 hover:text-primary-600 hover:bg-primary-50 rounded transition-colors",children:e.jsx($,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gradient",children:t.name}),e.jsx("p",{className:"text-neutral-600 mt-1",children:t.description||"Нет описания"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>i(`/classes/${a}/chat`),className:"btn-primary flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4"}),"Групповой чат"]}),e.jsxs("button",{onClick:()=>x(!0),className:"btn-secondary flex items-center gap-2",children:[e.jsx(A,{className:"h-4 w-4"}),"Редактировать"]}),e.jsxs("button",{onClick:()=>u(!0),className:"btn-danger flex items-center gap-2",disabled:d.isLoading,children:[e.jsx(g,{className:"h-4 w-4"}),"Удалить"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(v,{className:"h-5 w-5 text-primary-600"}),e.jsx("h3",{className:"font-semibold text-neutral-900",children:"Студенты"})]}),e.jsxs("p",{className:"text-2xl font-bold text-primary-600",children:[t.students?.length||0," / ",t.maxStudents]})]}),t.level&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(L,{className:"h-5 w-5 text-primary-600"}),e.jsx("h3",{className:"font-semibold text-neutral-900",children:"Уровень"})]}),e.jsx("p",{className:"text-lg font-semibold text-neutral-700",children:t.level})]}),t.language&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(T,{className:"h-5 w-5 text-primary-600"}),e.jsx("h3",{className:"font-semibold text-neutral-900",children:"Язык"})]}),e.jsx("p",{className:"text-lg font-semibold text-neutral-700",children:t.language})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-neutral-900",children:"Студенты класса"}),e.jsxs("button",{onClick:()=>c(!0),className:"btn-primary flex items-center gap-2",disabled:t.students?.length>=t.maxStudents,children:[e.jsx(y,{className:"h-4 w-4"}),"Добавить студента"]})]}),t.students&&t.students.length>0?e.jsx("div",{className:"space-y-4",children:t.students.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-neutral-200 rounded-lg hover:bg-neutral-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary-100 flex items-center justify-center",children:e.jsxs("span",{className:"text-primary-600 font-semibold",children:[s.student?.firstName?.[0]||"?",s.student?.lastName?.[0]||""]})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-semibold text-neutral-900",children:[s.student?.firstName," ",s.student?.lastName]}),e.jsx("p",{className:"text-sm text-neutral-600",children:s.student?.phone})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium border ${D(s.status)}`,children:P(s.status)})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[s.status==="PENDING"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>j.mutate({studentId:s.studentId,status:n.APPROVED}),className:"p-2 text-green-600 hover:bg-green-50 rounded transition-colors",title:"Одобрить",children:e.jsx(q,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>j.mutate({studentId:s.studentId,status:n.REJECTED}),className:"p-2 text-red-600 hover:bg-red-50 rounded transition-colors",title:"Отклонить",children:e.jsx(O,{className:"h-4 w-4"})})]}),e.jsx("button",{onClick:()=>S.mutate(s.studentId),className:"p-2 text-red-600 hover:bg-red-50 rounded transition-colors",title:"Удалить из класса",children:e.jsx(g,{className:"h-4 w-4"})})]})]},s.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(v,{className:"h-16 w-16 text-neutral-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-neutral-700 mb-2",children:"Нет студентов"}),e.jsx("p",{className:"text-neutral-500 mb-6",children:"Добавьте студентов в этот класс"}),e.jsxs("button",{onClick:()=>c(!0),className:"btn-primary inline-flex items-center gap-2",children:[e.jsx(y,{className:"h-5 w-5"}),"Добавить студента"]})]})]}),b&&e.jsx(G,{isOpen:b,onClose:()=>x(!1),onSuccess:()=>{x(!1),l.invalidateQueries(["class",a]),l.invalidateQueries("classes")},classData:t}),w&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-neutral-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-neutral-900",children:"Добавить студента"}),e.jsx("button",{onClick:()=>c(!1),className:"text-neutral-400 hover:text-neutral-600 transition-colors",children:"✕"})]}),e.jsx("div",{className:"p-6",children:p.length>0?e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:p.map(s=>e.jsxs("button",{onClick:()=>N.mutate(s.id),className:"w-full text-left p-3 border border-neutral-200 rounded-lg hover:bg-primary-50 hover:border-primary-300 transition-colors",disabled:N.isLoading,children:[e.jsxs("p",{className:"font-semibold text-neutral-900",children:[s.firstName," ",s.lastName]}),e.jsx("p",{className:"text-sm text-neutral-600",children:s.phone})]},s.id))}):e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-neutral-600",children:"Нет доступных студентов для добавления"})})})]})}),C&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-neutral-900 mb-4",children:"Удалить класс?"}),e.jsxs("p",{className:"text-neutral-600 mb-6",children:['Вы уверены, что хотите удалить класс "',t.name,'"? Это действие нельзя отменить.']}),e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[e.jsx("button",{onClick:()=>u(!1),className:"btn-secondary",children:"Отмена"}),e.jsx("button",{onClick:()=>{d.mutate(),u(!1)},className:"btn-danger",disabled:d.isLoading,children:d.isLoading?"Удаление...":"Удалить"})]})]})})})]})}export{z as default};
