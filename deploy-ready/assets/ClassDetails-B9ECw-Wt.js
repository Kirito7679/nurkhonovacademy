import{ac as G,u as O,f as q,r as j,h as D,k as x,j as e,am as z,M as F,ah as J,T as M,t as P,av as U,z as V,at as Q,aF as X,aG as B}from"./vendor-react-BjEyyFPN.js";import{E as n,a as i}from"./index-DvAsZ7Fn.js";import{C as H}from"./ClassFormModal-rThBn3Cv.js";import"./vendor-other-DqScX_4L.js";import"./vendor-network-DuohUtNG.js";import"./vendor-state-J2SV4L1Z.js";import"./vendor-forms-DJ3QO7Zi.js";function te(){var v,y;const{id:a}=G(),c=O(),l=q(),[p,u]=j.useState(!1),[I,d]=j.useState(!1),[$,h]=j.useState(!1),{data:t,isLoading:A}=D(["class",a],async()=>(await i.get(`/classes/${a}`)).data.data,{enabled:!!a}),{data:N}=D(["students"],async()=>(await i.get("/students")).data.data||[]),o=x(async()=>{await i.delete(`/classes/${a}`)},{onSuccess:()=>{l.invalidateQueries("classes"),c("/teacher/classes")}}),b=x(async s=>(await i.post(`/classes/${a}/students`,{studentId:s})).data.data,{onSuccess:()=>{l.invalidateQueries(["class",a]),l.invalidateQueries("classes"),d(!1)}}),L=x(async s=>{await i.delete(`/classes/${a}/students/${s}`)},{onSuccess:()=>{l.invalidateQueries(["class",a]),l.invalidateQueries("classes")}}),f=x(async({studentId:s,status:r})=>{await i.put(`/classes/${a}/students/${s}/status`,{status:r})},{onSuccess:()=>{l.invalidateQueries(["class",a]),l.invalidateQueries("classes")}});if(A)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block relative",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-primary-200 border-t-primary-500"})}),e.jsx("p",{className:"mt-4 text-neutral-600",children:"Загрузка класса..."})]});if(!t)return e.jsxs("div",{className:"card p-12 text-center",children:[e.jsx("h3",{className:"text-xl font-semibold text-neutral-700 mb-2",children:"Класс не найден"}),e.jsx("button",{onClick:()=>c("/teacher/classes"),className:"btn-primary mt-4",children:"Вернуться к списку классов"})]});const R=s=>{switch(s){case n.APPROVED:return"bg-green-100 text-green-700 border-green-200";case n.PENDING:return"bg-yellow-100 text-yellow-700 border-yellow-200";case n.REJECTED:return"bg-red-100 text-red-700 border-red-200";default:return"bg-gray-100 text-gray-700 border-gray-200"}},T=s=>{switch(s){case n.APPROVED:return"Одобрен";case n.PENDING:return"Ожидает";case n.REJECTED:return"Отклонен";default:return s}},g=(N==null?void 0:N.filter(s=>{var r;return!((r=t.students)!=null&&r.some(m=>m.studentId===s.id))}))||[];return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:()=>c("/teacher/classes"),className:"p-2 text-neutral-600 hover:text-primary-600 hover:bg-primary-50 rounded transition-colors",children:e.jsx(z,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gradient",children:t.name}),e.jsx("p",{className:"text-neutral-600 mt-1",children:t.description||"Нет описания"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>c(`/classes/${a}/chat`),className:"btn-primary flex items-center gap-2",children:[e.jsx(F,{className:"h-4 w-4"}),"Групповой чат"]}),e.jsxs("button",{onClick:()=>u(!0),className:"btn-secondary flex items-center gap-2",children:[e.jsx(J,{className:"h-4 w-4"}),"Редактировать"]}),e.jsxs("button",{onClick:()=>h(!0),className:"btn-danger flex items-center gap-2",disabled:o.isLoading,children:[e.jsx(M,{className:"h-4 w-4"}),"Удалить"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(P,{className:"h-5 w-5 text-primary-600"}),e.jsx("h3",{className:"font-semibold text-neutral-900",children:"Студенты"})]}),e.jsxs("p",{className:"text-2xl font-bold text-primary-600",children:[((v=t.students)==null?void 0:v.length)||0," / ",t.maxStudents]})]}),t.level&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(U,{className:"h-5 w-5 text-primary-600"}),e.jsx("h3",{className:"font-semibold text-neutral-900",children:"Уровень"})]}),e.jsx("p",{className:"text-lg font-semibold text-neutral-700",children:t.level})]}),t.language&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(V,{className:"h-5 w-5 text-primary-600"}),e.jsx("h3",{className:"font-semibold text-neutral-900",children:"Язык"})]}),e.jsx("p",{className:"text-lg font-semibold text-neutral-700",children:t.language})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-neutral-900",children:"Студенты класса"}),e.jsxs("button",{onClick:()=>d(!0),className:"btn-primary flex items-center gap-2",disabled:((y=t.students)==null?void 0:y.length)>=t.maxStudents,children:[e.jsx(Q,{className:"h-4 w-4"}),"Добавить студента"]})]}),t.students&&t.students.length>0?e.jsx("div",{className:"space-y-4",children:t.students.map(s=>{var r,m,w,C,E,k,S;return e.jsxs("div",{className:"flex items-center justify-between p-4 border border-neutral-200 rounded-lg hover:bg-neutral-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary-100 flex items-center justify-center",children:e.jsxs("span",{className:"text-primary-600 font-semibold",children:[((m=(r=s.student)==null?void 0:r.firstName)==null?void 0:m[0])||"?",((C=(w=s.student)==null?void 0:w.lastName)==null?void 0:C[0])||""]})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-semibold text-neutral-900",children:[(E=s.student)==null?void 0:E.firstName," ",(k=s.student)==null?void 0:k.lastName]}),e.jsx("p",{className:"text-sm text-neutral-600",children:(S=s.student)==null?void 0:S.phone})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium border ${R(s.status)}`,children:T(s.status)})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[s.status==="PENDING"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>f.mutate({studentId:s.studentId,status:n.APPROVED}),className:"p-2 text-green-600 hover:bg-green-50 rounded transition-colors",title:"Одобрить",children:e.jsx(X,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>f.mutate({studentId:s.studentId,status:n.REJECTED}),className:"p-2 text-red-600 hover:bg-red-50 rounded transition-colors",title:"Отклонить",children:e.jsx(B,{className:"h-4 w-4"})})]}),e.jsx("button",{onClick:()=>L.mutate(s.studentId),className:"p-2 text-red-600 hover:bg-red-50 rounded transition-colors",title:"Удалить из класса",children:e.jsx(M,{className:"h-4 w-4"})})]})]},s.id)})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(P,{className:"h-16 w-16 text-neutral-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-neutral-700 mb-2",children:"Нет студентов"}),e.jsx("p",{className:"text-neutral-500 mb-6",children:"Добавьте студентов в этот класс"}),e.jsxs("button",{onClick:()=>d(!0),className:"btn-primary inline-flex items-center gap-2",children:[e.jsx(Q,{className:"h-5 w-5"}),"Добавить студента"]})]})]}),p&&e.jsx(H,{isOpen:p,onClose:()=>u(!1),onSuccess:()=>{u(!1),l.invalidateQueries(["class",a]),l.invalidateQueries("classes")},classData:t}),I&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-neutral-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-neutral-900",children:"Добавить студента"}),e.jsx("button",{onClick:()=>d(!1),className:"text-neutral-400 hover:text-neutral-600 transition-colors",children:"✕"})]}),e.jsx("div",{className:"p-6",children:g.length>0?e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:g.map(s=>e.jsxs("button",{onClick:()=>b.mutate(s.id),className:"w-full text-left p-3 border border-neutral-200 rounded-lg hover:bg-primary-50 hover:border-primary-300 transition-colors",disabled:b.isLoading,children:[e.jsxs("p",{className:"font-semibold text-neutral-900",children:[s.firstName," ",s.lastName]}),e.jsx("p",{className:"text-sm text-neutral-600",children:s.phone})]},s.id))}):e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-neutral-600",children:"Нет доступных студентов для добавления"})})})]})}),$&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-neutral-900 mb-4",children:"Удалить класс?"}),e.jsxs("p",{className:"text-neutral-600 mb-6",children:['Вы уверены, что хотите удалить класс "',t.name,'"? Это действие нельзя отменить.']}),e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[e.jsx("button",{onClick:()=>h(!1),className:"btn-secondary",children:"Отмена"}),e.jsx("button",{onClick:()=>{o.mutate(),h(!1)},className:"btn-danger",disabled:o.isLoading,children:o.isLoading?"Удаление...":"Удалить"})]})]})})})]})}export{te as default};
