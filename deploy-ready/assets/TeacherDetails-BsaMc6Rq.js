import{ae as E,d as M,u as $,r as b,j as e,e as D,f,V as g,ap as Q,q as C,aO as F,aa as U,U as V,s as q,$ as y,a0 as v,a1 as d,aV as R,av as _}from"./vendor-D-riqg-X.js";import{u as B,a as h}from"./index-s2Bp9abg.js";import{S as I}from"./SuccessModal-2VojkkiP.js";const K=v({newPassword:d().min(6,"Пароль должен содержать минимум 6 символов")}),z=v({firstName:d().min(1,"Имя обязательно").max(50,"Имя слишком длинное").optional(),lastName:d().min(1,"Фамилия обязательна").max(50,"Фамилия слишком длинная").optional(),phone:d().min(10,"Номер телефона должен содержать минимум 10 символов").max(15,"Номер телефона слишком длинный").optional(),email:d().email("Неверный формат email").optional().or(_("")),isPaidTeacher:R().optional()});function W(){const{id:l}=E(),w=M(),m=$(),{user:T}=B(),[u,o]=b.useState({isOpen:!1,message:""});if(T?.role!=="ADMIN")return e.jsxs("div",{className:"card p-12 text-center",children:[e.jsx("h3",{className:"text-xl font-semibold text-neutral-700 mb-2",children:"Доступ запрещен"}),e.jsx("p",{className:"text-neutral-600",children:"Только администратор может просматривать детали учителя"})]});const{data:t,isLoading:x}=D(["curator",l],async()=>(await h.get(`/curators/${l}`)).data.data),i=f(async a=>(await h.put(`/curators/${l}/reset-password`,a)).data,{onSuccess:()=>{m.invalidateQueries(["curator",l]),o({isOpen:!0,message:"Пароль успешно изменен"})}}),n=f(async a=>(await h.put(`/curators/${l}`,a)).data,{onSuccess:()=>{m.invalidateQueries(["curator",l]),m.invalidateQueries("curators"),o({isOpen:!0,message:"Профиль учителя успешно обновлен"})}}),{register:S,handleSubmit:P,formState:{errors:j},reset:k}=g({resolver:y(K),defaultValues:{newPassword:""}}),{register:c,handleSubmit:L,formState:{errors:r},reset:N}=g({resolver:y(z)});if(b.useEffect(()=>{t&&!x&&N({firstName:t.firstName,lastName:t.lastName,phone:t.phone,email:t.email||"",isPaidTeacher:t.isPaidTeacher||!1})},[t,x,N]),x)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block relative",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-primary-200 border-t-primary-500"})}),e.jsx("p",{className:"mt-4 text-neutral-600",children:"Загрузка учителя..."})]});const s=t;if(!s)return e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-neutral-600",children:"Учитель не найден"})});const O=a=>{i.mutate(a,{onSuccess:()=>{k()}})},A=a=>{n.mutate(a)};return e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>w("/admin/curators"),className:"flex items-center text-neutral-600 hover:text-primary-600 mb-6 transition-colors animate-slide-in",children:[e.jsx(Q,{className:"h-5 w-5 mr-2"}),"Назад к учителям"]}),e.jsx("div",{className:"relative mb-8 animate-fade-scale",children:e.jsxs("h1",{className:"text-xl md:text-2xl lg:text-4xl font-bold text-gradient break-words",children:[s.firstName," ",s.lastName]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6",children:[e.jsxs("div",{className:"lg:col-span-1",children:[e.jsx("div",{className:"card p-6 mb-6 animate-fade-scale",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("div",{className:"flex items-center justify-center w-24 h-24 rounded-full bg-gradient-to-br from-green-500 to-emerald-600 text-white mb-4 animate-pulse-glow",children:e.jsx(C,{className:"h-12 w-12"})}),e.jsxs("h2",{className:"text-2xl font-bold text-neutral-900 mb-2",children:[s.firstName," ",s.lastName]}),e.jsxs("p",{className:"text-neutral-600",children:["Телефон: ",s.phone]}),s.email&&e.jsxs("p",{className:"text-neutral-600",children:["Email: ",s.email]}),e.jsx("div",{className:"mt-4",children:e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-xs font-medium ${s.isPaidTeacher?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:s.isPaidTeacher?"Оплачено":"Не оплачено"})})]})}),e.jsxs("div",{className:"card p-6 animate-fade-scale",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(F,{className:"h-6 w-6 text-primary-500 mr-3"}),e.jsx("h2",{className:"text-xl font-semibold text-neutral-900",children:"Сбросить пароль"})]}),e.jsxs("form",{onSubmit:P(O),className:"space-y-4",children:[e.jsxs("div",{className:"animate-slide-in",style:{animationDelay:"0.1s"},children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Новый пароль"}),e.jsx("input",{...S("newPassword"),type:"password",className:"input-field",placeholder:"Введите новый пароль"}),j.newPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:j.newPassword.message})]}),i.error&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm",children:i.error?.response?.data?.message||"Ошибка при изменении пароля"}),e.jsx("div",{className:"animate-slide-in",style:{animationDelay:"0.2s"},children:e.jsxs("button",{type:"submit",disabled:i.isLoading,className:"btn-primary w-full disabled:opacity-50 disabled:cursor-not-allowed inline-flex items-center justify-center gap-2","aria-busy":i.isLoading,children:[e.jsx(U,{className:"h-5 w-5"}),i.isLoading?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin",children:"⟳"}),e.jsx("span",{children:"Сброс..."})]}):"Сбросить пароль"]})})]})]})]}),e.jsxs("div",{className:"lg:col-span-2",children:[e.jsxs("div",{className:"card p-6 mb-6 animate-fade-scale",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(V,{className:"h-6 w-6 text-primary-500 mr-3"}),e.jsx("h2",{className:"text-xl font-semibold text-neutral-900",children:"Редактировать профиль"})]}),e.jsxs("form",{onSubmit:L(A),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:["Имя ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{...c("firstName"),type:"text",className:"input-field",placeholder:"Введите имя"}),r.firstName&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.firstName.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:["Фамилия ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{...c("lastName"),type:"text",className:"input-field",placeholder:"Введите фамилию"}),r.lastName&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.lastName.message})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Номер телефона"}),e.jsx("input",{...c("phone"),type:"text",className:"input-field",placeholder:"+998901234567"}),r.phone&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.phone.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Email"}),e.jsx("input",{...c("email"),type:"email",className:"input-field",placeholder:"email@example.com"}),r.email&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.email.message})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{...c("isPaidTeacher"),type:"checkbox",className:"mr-2 w-4 h-4 text-primary-500 bg-white border-neutral-300 rounded focus:ring-primary-500"}),e.jsx("span",{className:"text-sm font-medium text-neutral-700",children:"Оплачена регистрация учителя"})]})}),n.error&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm",children:n.error?.response?.data?.message||"Ошибка при обновлении профиля"}),e.jsx("div",{className:"pt-4",children:e.jsx("button",{type:"submit",disabled:n.isLoading,className:"btn-primary w-full md:w-auto disabled:opacity-50 disabled:cursor-not-allowed inline-flex items-center justify-center gap-2","aria-busy":n.isLoading,children:n.isLoading?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin",children:"⟳"}),e.jsx("span",{children:"Сохранение..."})]}):"Сохранить изменения"})})]})]}),e.jsxs("div",{className:"card p-6 animate-fade-scale",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(q,{className:"h-6 w-6 text-primary-500 mr-3"}),e.jsx("h2",{className:"text-xl font-semibold text-neutral-900",children:"Курсы учителя"})]}),s.coursesAsTeacher&&s.coursesAsTeacher.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-neutral-500",children:"Нет курсов"})}):e.jsx("div",{className:"space-y-3",children:s.coursesAsTeacher?.map((a,p)=>e.jsx("div",{className:"flex items-center justify-between p-4 border border-neutral-200 rounded-lg hover:border-primary-300 hover:bg-neutral-50 transition-all animate-slide-in",style:{animationDelay:`${.1*p}s`},children:e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-neutral-900 mb-1",children:a.title}),a.description&&e.jsx("p",{className:"text-sm text-neutral-600 line-clamp-2",children:a.description})]})},a.id))}),e.jsx("div",{className:"mt-6 pt-6 border-t border-neutral-200",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-primary-600",children:s._count?.coursesAsTeacher||0}),e.jsx("div",{className:"text-sm text-neutral-600",children:"Курсов"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-primary-600",children:s._count?.createdUsers||0}),e.jsx("div",{className:"text-sm text-neutral-600",children:"Студентов"})]})]})})]})]})]}),e.jsx(I,{isOpen:u.isOpen,onClose:()=>o({isOpen:!1,message:""}),message:u.message})]})}export{W as default};
