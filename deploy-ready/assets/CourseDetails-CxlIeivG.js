import{j as e,X as O,ab as W,ac as G,D as p,s as T,ad as Q,k as z,ae as _,d as H,u as X,r as P,e as k,f as J,U as K,a4 as Y,af as Z,ag as ee,ah as se,aa as S,ai as te,a9 as ae}from"./vendor-D-riqg-X.js";import{u as le,R as C,S as re,a as N}from"./index-uPHzQqHW.js";import{B as ne}from"./Banner-Dk274XMz.js";function ie({isOpen:t,onClose:r,onConfirm:b,courseTitle:v,coursePrice:x,teacherTelegram:u,isLoading:c=!1}){if(!t)return null;const o=x===0,w=o?"Бесплатно":`${x.toLocaleString("ru-RU")} сум`,h=u?u.startsWith("http")?u:u.startsWith("@")?`https://t.me/${u.slice(1)}`:`https://t.me/${u}`:"https://t.me/Nurkhonov_Dilmurod";return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 animate-fade-in-scale p-4",onClick:j=>{j.target===j.currentTarget&&!c&&r()},children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md relative animate-slide-in overflow-hidden",children:[e.jsx("button",{onClick:r,disabled:c,className:"absolute top-4 right-4 z-10 text-neutral-400 hover:text-neutral-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed bg-white/80 backdrop-blur-sm rounded-full p-1.5 hover:bg-white",children:e.jsx(O,{className:"h-5 w-5"})}),e.jsx("div",{className:`${o?"bg-gradient-to-br from-green-500 via-emerald-500 to-teal-500":"bg-gradient-to-br from-primary-500 to-primary-600"} p-6 md:p-8 pb-8`,children:e.jsxs("div",{className:"flex flex-col items-center text-center text-white",children:[e.jsx("div",{className:"w-20 h-20 rounded-full flex items-center justify-center mb-4 bg-white/20 backdrop-blur-sm border-2 border-white/30",children:o?e.jsx(W,{className:"h-10 w-10 text-white"}):e.jsx(G,{className:"h-10 w-10 text-white"})}),e.jsx("h3",{className:"text-2xl md:text-3xl font-bold mb-2",children:o?"Бесплатный курс":"Стоимость курса"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("p",{className:"text-4xl md:text-5xl font-bold mb-1",children:w}),o&&e.jsx("p",{className:"text-white/90 text-sm md:text-base",children:"Начните обучение прямо сейчас!"})]})]})}),e.jsx("div",{className:"p-6 md:p-8",children:o?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h4",{className:"text-lg font-semibold text-neutral-900 mb-2",children:v}),e.jsx("p",{className:"text-neutral-600 text-sm",children:"После подтверждения курс будет автоматически добавлен в ваш список доступных курсов"})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(p,{className:"h-5 w-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-900",children:"Мгновенный доступ"}),e.jsx("p",{className:"text-xs text-green-700",children:"Курс будет доступен сразу после подтверждения"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(T,{className:"h-5 w-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-900",children:"Все материалы включены"}),e.jsx("p",{className:"text-xs text-green-700",children:"Получите доступ ко всем урокам и материалам курса"})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{onClick:r,disabled:c,className:"flex-1 px-4 py-3 border-2 border-neutral-300 rounded-xl text-sm font-semibold text-neutral-700 hover:bg-neutral-50 hover:border-neutral-400 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:"Отмена"}),e.jsx("button",{onClick:b,disabled:c,className:"flex-1 px-4 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl text-sm font-semibold hover:shadow-lg hover:scale-[1.02] transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:c?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin",children:"⟳"}),e.jsx("span",{children:"Обработка..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"h-5 w-5"}),e.jsx("span",{children:"Начать обучение"})]})})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h4",{className:"text-lg font-semibold text-neutral-900 mb-2",children:v}),e.jsx("p",{className:"text-neutral-600 text-sm",children:"Чтобы купить курс, свяжитесь с преподавателем в Telegram"})]}),e.jsxs("a",{href:h,target:"_blank",rel:"noopener noreferrer",className:"w-full flex items-center justify-center gap-3 px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-xl transition-all font-semibold shadow-md hover:shadow-lg group",children:[e.jsx(Q,{className:"h-5 w-5 group-hover:scale-110 transition-transform"}),e.jsx("span",{children:"Написать в Telegram"})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{onClick:r,disabled:c,className:"flex-1 px-4 py-3 border-2 border-neutral-300 rounded-xl text-sm font-semibold text-neutral-700 hover:bg-neutral-50 hover:border-neutral-400 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:"Отмена"}),e.jsx("button",{onClick:b,disabled:c,className:"flex-1 px-4 py-3 bg-gradient-primary text-white rounded-xl text-sm font-semibold hover:shadow-lg hover:scale-[1.02] transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:c?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin",children:"⟳"}),e.jsx("span",{children:"Отправка..."})]}):"Отправить запрос"})]})]})})]})})}function xe(){const{t}=z(),{id:r}=_(),b=H(),v=X(),{user:x}=le(),[u,c]=P.useState(!1),[o,w]=P.useState(!0),{data:h,isLoading:j}=k(["course",r],async()=>(await N.get(`/courses/${r}`)).data.data,{staleTime:5*60*1e3,cacheTime:10*60*1e3,enabled:!!r}),{data:R,isLoading:D}=k(["courseLessons",r],async()=>(await N.get(`/courses/${r}/lessons`)).data.data||[],{staleTime:5*60*1e3,cacheTime:10*60*1e3,enabled:!!r}),{data:E,isLoading:de}=k(["modules",r],async()=>(await N.get(`/modules/courses/${r}/modules`)).data.data||[],{staleTime:10*60*1e3,cacheTime:20*60*1e3,enabled:!!r}),I=j||!h?!1:x?.role===C.ADMIN||x?.role===C.CURATOR?!0:x?.role===C.TEACHER?h.teacherId===x.id:x?.role===C.STUDENT?h.hasAccess===!0&&h.studentCourseStatus===re.APPROVED:!1,{data:F}=k(["tests",r],async()=>{try{return(await N.get(`/tests/courses/${r}/tests`)).data.data||[]}catch(s){if(s.response?.status===403)return[];throw s}},{staleTime:5*60*1e3,cacheTime:10*60*1e3,enabled:!!r&&!!I,retry:!1}),y=J(async()=>(await N.post(`/courses/${r}/request`)).data,{onSuccess:()=>{v.invalidateQueries(["course",r]),c(!1)},onError:()=>{}}),a=h,i=R||[],f=E||[],V=F||[];a?.trialLessonId&&i.find(s=>s.id===a.trialLessonId);const M=i.filter(s=>s.progress?.completed).length,L=i.length>0?Math.round(M/i.length*100):0,U=()=>{const s=new Map,d=[];return i.forEach(l=>{l.moduleId?(s.has(l.moduleId)||s.set(l.moduleId,[]),s.get(l.moduleId).push(l)):d.push(l)}),s.forEach(l=>{l.sort((m,n)=>m.order-n.order)}),d.sort((l,m)=>l.order-m.order),{lessonsByModule:s,lessonsWithoutModule:d}},{lessonsByModule:$,lessonsWithoutModule:g}=U();if(j)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block relative",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-primary-200 border-t-primary-500"})}),e.jsx("p",{className:"mt-4 text-neutral-600",children:t("common.loading")})]});if(!a)return e.jsx("div",{className:"text-center py-12 animate-fade-scale",children:e.jsx("p",{className:"text-neutral-600",children:t("errors.notFound")})});const q=()=>{c(!0)},B=()=>{y.mutate()};return e.jsxs("div",{children:[e.jsx(ne,{position:"TOP"}),a.thumbnailUrl&&e.jsxs("div",{className:"relative w-full h-48 md:h-64 lg:h-80 mb-8 rounded-lg overflow-hidden animate-fade-scale",children:[e.jsx("img",{src:a.thumbnailUrl,alt:a.title,className:"w-full h-full object-cover",onError:s=>{s.target.style.display="none"}}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 via-black/30 to-transparent"}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-6 md:p-8",children:[e.jsx("h1",{className:"text-2xl md:text-4xl lg:text-5xl font-bold text-white mb-2 break-words",children:a.title}),a.teacher&&e.jsxs("div",{className:"flex items-center text-white/90 text-sm md:text-base",children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),e.jsxs("span",{children:[t("courses.teacher",{defaultValue:"Преподаватель"}),": ",a.teacher.firstName," ",a.teacher.lastName]})]})]})]}),e.jsxs("div",{className:"mb-8 animate-slide-in",children:[!a.thumbnailUrl&&e.jsx("h1",{className:"text-2xl md:text-3xl lg:text-5xl font-bold text-gradient mb-4 break-words",children:a.title}),a.hasAccess&&i.length>0&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"card p-4 text-center",children:[e.jsx(T,{className:"h-6 w-6 text-primary-500 mx-auto mb-2"}),e.jsx("div",{className:"text-2xl font-bold text-neutral-900",children:i.length}),e.jsx("div",{className:"text-sm text-neutral-600",children:t("lessons.title")})]}),e.jsxs("div",{className:"card p-4 text-center",children:[e.jsx(p,{className:"h-6 w-6 text-green-500 mx-auto mb-2"}),e.jsx("div",{className:"text-2xl font-bold text-neutral-900",children:M}),e.jsx("div",{className:"text-sm text-neutral-600",children:t("lessons.completed")})]}),e.jsxs("div",{className:"card p-4 text-center",children:[e.jsx("div",{className:"h-6 w-6 mx-auto mb-2 flex items-center justify-center",children:e.jsx("div",{className:"w-12 h-12 rounded-full border-4 border-primary-200 border-t-primary-500",style:{background:`conic-gradient(from 0deg, #39ff14 ${L*3.6}deg, #e5e7eb ${L*3.6}deg)`}})}),e.jsxs("div",{className:"text-2xl font-bold text-neutral-900",children:[L,"%"]}),e.jsx("div",{className:"text-sm text-neutral-600",children:t("dashboard.overallProgress",{defaultValue:"Прогресс"})})]}),e.jsxs("div",{className:"card p-4 text-center",children:[e.jsx(Y,{className:"h-6 w-6 text-primary-500 mx-auto mb-2"}),e.jsx("div",{className:"text-2xl font-bold text-neutral-900",children:f.length}),e.jsx("div",{className:"text-sm text-neutral-600",children:t("modules.title")})]})]}),a.description&&e.jsxs("div",{className:"card p-6 md:p-8 mb-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-semibold text-neutral-900 mb-4",children:t("courses.aboutCourse",{defaultValue:"О курсе"})}),e.jsx("p",{className:"text-neutral-600 text-sm md:text-base lg:text-lg leading-relaxed break-words whitespace-pre-line",children:a.description})]}),a.hasAccess&&V.length>0&&e.jsxs("div",{className:"card p-6 md:p-8 mb-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-semibold text-neutral-900 mb-6",children:"Промежуточные тесты"}),e.jsx("div",{className:"space-y-3",children:V.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-neutral-200 rounded-lg hover:border-primary-300 transition-colors",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-neutral-900",children:s.title}),s.description&&e.jsx("p",{className:"text-sm text-neutral-600 mt-1",children:s.description}),e.jsxs("p",{className:"text-xs text-neutral-500 mt-2",children:["Проходной балл: ",s.passingScore,"% •",s.timeLimit?` Время: ${s.timeLimit} мин`:" Без ограничения времени"]})]}),e.jsxs("button",{onClick:()=>b(`/courses/${r}/tests/${s.id}`),className:"btn-primary text-sm ml-4",children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Пройти тест"]})]},s.id))})]}),a.hasAccess&&f.length>0&&e.jsxs("div",{className:"card p-6 md:p-8 mb-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-semibold text-neutral-900 mb-6",children:t("courses.program",{defaultValue:"Программа обучения"})}),e.jsxs("div",{className:"space-y-4",children:[f.sort((s,d)=>s.order-d.order).map((s,d)=>{const l=$.get(s.id)||[];if(l.length===0)return null;let m=1;for(let n=0;n<d;n++){const A=$.get(f[n].id)||[];m+=A.length}return e.jsxs("div",{className:"border-l-4 border-primary-500 pl-4 md:pl-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-gradient-primary text-white font-bold text-lg flex-shrink-0",children:d+1}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg md:text-xl font-semibold text-neutral-900",children:s.title}),s.description&&e.jsx("p",{className:"text-sm text-neutral-500 mt-1",children:s.description})]}),e.jsxs("span",{className:"text-sm text-neutral-500 ml-auto",children:[l.length," ",t("lessons.lessonsCount",{count:l.length,defaultValue:l.length===1?"урок":"уроков"})]})]}),e.jsx("div",{className:"ml-12 md:ml-14 space-y-2",children:l.map((n,A)=>e.jsxs("div",{className:"flex items-center gap-2 text-neutral-600 hover:text-primary-600 transition-colors",children:[e.jsxs("span",{className:"text-sm font-medium w-6",children:[m+A,"."]}),e.jsx("span",{className:"text-sm md:text-base",children:n.title}),n.progress?.completed&&e.jsx(p,{className:"h-4 w-4 text-green-500 ml-auto"})]},n.id))})]},s.id)}),g.length>0&&e.jsxs("div",{className:"border-l-4 border-neutral-300 pl-4 md:pl-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("h3",{className:"text-lg md:text-xl font-semibold text-neutral-900",children:t("modules.additionalLessons",{defaultValue:"Дополнительные уроки"})}),e.jsxs("span",{className:"text-sm text-neutral-500 ml-auto",children:[g.length," ",t("lessons.lessonsCount",{count:g.length,defaultValue:g.length===1?"урок":"уроков"})]})]}),e.jsx("div",{className:"ml-12 md:ml-14 space-y-2",children:g.map((s,d)=>{let l=1;return f.forEach(m=>{const n=$.get(m.id)||[];l+=n.length}),l+=d,e.jsxs("div",{className:"flex items-center gap-2 text-neutral-600 hover:text-primary-600 transition-colors",children:[e.jsxs("span",{className:"text-sm font-medium w-6",children:[l,"."]}),e.jsx("span",{className:"text-sm md:text-base",children:s.title}),s.progress?.completed&&e.jsx(p,{className:"h-4 w-4 text-green-500 ml-auto"})]},s.id)})})]})]})]})]}),e.jsxs("div",{className:"animate-fade-scale",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 md:mb-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-semibold text-neutral-900",children:t("courses.courseLessons",{defaultValue:"Уроки курса"})}),i.length>0&&e.jsx("button",{onClick:()=>w(!o),className:"flex items-center gap-2 text-primary-600 hover:text-primary-700 transition-colors text-sm md:text-base",children:o?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:t("common.close")}),e.jsx(ee,{className:"h-5 w-5"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:t("courses.showAll",{defaultValue:"Показать все"})}),e.jsx(se,{className:"h-5 w-5"})]})})]}),D?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block relative",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-primary-200 border-t-primary-500"})}),e.jsx("p",{className:"mt-4 text-neutral-600",children:t("common.loading")})]}):i.length===0?e.jsx("div",{className:"text-center py-12 animate-fade-scale",children:e.jsx("p",{className:"text-neutral-500",children:t("lessons.noLessons")})}):e.jsxs(e.Fragment,{children:[!a.hasAccess&&e.jsx("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("span",{className:"font-semibold",children:t("courses.trialLessons",{defaultValue:"Пробные уроки"})})," ",t("courses.trialLessonsDescription",{defaultValue:"доступны для просмотра. Для доступа ко всем урокам запросите доступ к курсу."})]})}),e.jsx("div",{className:"space-y-4",children:(o?i:i.slice(0,5)).map((s,d)=>{const l=a?.trialLessonId===s.id,n=!(a.hasAccess||l);return e.jsx("div",{className:`card p-4 md:p-6 animate-slide-in group ${n?"opacity-60 cursor-not-allowed":"card-hover cursor-pointer"}`,style:{animationDelay:`${.1*d}s`},onClick:()=>{n||b(`/courses/${r}/lessons/${s.id}`)},children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 md:gap-3 mb-2",children:[e.jsx("span",{className:`flex items-center justify-center w-8 h-8 md:w-10 md:h-10 rounded-full font-semibold text-sm md:text-base flex-shrink-0 transition-transform ${n?"bg-neutral-300 text-neutral-600":"bg-gradient-primary text-white group-hover:scale-110"}`,children:d+1}),e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx("h3",{className:`text-base md:text-lg font-semibold break-words transition-colors ${n?"text-neutral-500":"text-neutral-900 group-hover:text-primary-600"}`,children:s.title}),l&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-700 border border-blue-200",children:t("courses.trial",{defaultValue:"Пробный"})}),n&&e.jsx(S,{className:"h-4 w-4 text-neutral-400 flex-shrink-0"})]})]}),s.description&&e.jsx("p",{className:`text-xs md:text-sm ml-10 md:ml-12 break-words line-clamp-2 ${n?"text-neutral-400":"text-neutral-600"}`,children:s.description}),e.jsx("div",{className:"flex items-center gap-3 mt-2 ml-10 md:ml-12",children:s.progress?.completed&&e.jsxs("span",{className:"inline-flex items-center px-2 md:px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-700 border border-green-200",children:[e.jsx(p,{className:"h-3 w-3 mr-1 text-green-700"}),t("lessons.completed")]})})]}),e.jsx("div",{className:"flex items-center gap-2",children:n?e.jsx(S,{className:"h-5 w-5 text-neutral-400 flex-shrink-0"}):e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"h-5 w-5 text-primary-500 flex-shrink-0 group-hover:scale-110 transition-transform"}),e.jsx(ae,{className:"h-5 w-5 text-neutral-400 group-hover:text-primary-500 group-hover:translate-x-1 transition-all flex-shrink-0"})]})})]})},s.id)})}),!o&&i.length>5&&e.jsx("div",{className:"text-center mt-4",children:e.jsx("button",{onClick:()=>w(!0),className:"text-primary-600 hover:text-primary-700 font-medium text-sm",children:t("courses.showAllLessons",{count:i.length,defaultValue:`Показать все ${i.length} уроков`})})}),!a.hasAccess&&e.jsx("div",{className:"mt-6 card p-4 md:p-6 text-center",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4 justify-center",children:[a.studentCourseStatus!=="PENDING"&&e.jsx("button",{onClick:q,disabled:y.isLoading,className:"btn-primary inline-flex items-center disabled:opacity-50 disabled:cursor-not-allowed",children:y.isLoading?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"animate-spin",children:"⟳"}),e.jsx("span",{children:t("common.loading")})]}):e.jsx("span",{children:a.price===0?t("courses.startCourse",{defaultValue:"Пройти курс"}):t("courses.requestAccess",{defaultValue:"Запросить доступ к курсу"})})}),a.studentCourseStatus==="PENDING"&&e.jsxs("div",{className:"text-neutral-600",children:[e.jsx("p",{className:"font-medium mb-2",children:t("courses.requestPending",{defaultValue:"Запрос ожидает одобрения"})}),e.jsx("p",{className:"text-sm",children:t("courses.requestPendingDescription",{defaultValue:"Вы получите уведомление, когда доступ будет предоставлен"})})]})]})})]})]}),e.jsx(ie,{isOpen:u,onClose:()=>c(!1),onConfirm:B,courseTitle:a.title,coursePrice:a.price,teacherTelegram:a.teacher?.telegram,isLoading:y.isLoading})]})}export{xe as default};
