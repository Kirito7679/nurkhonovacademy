import{k as H,d as J,r as o,e as K,f as k,H as E,j as e,U as X,ap as Y,aq as Z,ar as _,a7 as R,P as T,V as L,W as n,as as ee}from"./vendor-react-B4b84SyH.js";import{u as ae,a as g}from"./index-D6PcLXw1.js";import{S as se}from"./SuccessModal-D5rdaVaY.js";import{F as te}from"./FileUploadProgress-Bee-_BeT.js";const le=L({firstName:n().min(1,"Ð˜Ð¼Ñ Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾"),lastName:n().min(1,"Ð¤Ð°Ð¼Ð¸Ð»Ð¸Ñ Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð°"),phone:n().min(10,"ÐÐ¾Ð¼ÐµÑ€ Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½Ð° Ð´Ð¾Ð»Ð¶ÐµÐ½ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ Ð¼Ð¸Ð½Ð¸Ð¼ÑƒÐ¼ 10 ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð²"),email:n().email("ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ email").optional().or(ee("")),language:n().optional()}),re=L({currentPassword:n().min(1,"Ð¢ÐµÐºÑƒÑ‰Ð¸Ð¹ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÐµÐ½"),newPassword:n().min(6,"ÐÐ¾Ð²Ñ‹Ð¹ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ Ð´Ð¾Ð»Ð¶ÐµÐ½ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ Ð¼Ð¸Ð½Ð¸Ð¼ÑƒÐ¼ 6 ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð²"),confirmPassword:n().min(6,"ÐŸÐ¾Ð´Ñ‚Ð²ÐµÑ€Ð¶Ð´ÐµÐ½Ð¸Ðµ Ð¿Ð°Ñ€Ð¾Ð»Ñ Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾")}).refine(f=>f.newPassword===f.confirmPassword,{message:"ÐŸÐ°Ñ€Ð¾Ð»Ð¸ Ð½Ðµ ÑÐ¾Ð²Ð¿Ð°Ð´Ð°ÑŽÑ‚",path:["confirmPassword"]});function de(){var U;const{t:f,i18n:N}=H(),{user:z,updateUser:M}=ae(),D=J(),[F,i]=o.useState(""),[d,j]=o.useState(!1),[u,b]=o.useState(null),[A,p]=o.useState(!1),[C,w]=o.useState(""),[$,y]=o.useState(""),G=o.useRef(null),{data:a}=K("me",async()=>(await g.get("/auth/me")).data.data,{initialData:z||void 0}),v=k(async s=>(await g.put("/auth/me",s)).data.data,{onSuccess:s=>{s&&(M(s),w("ÐŸÑ€Ð¾Ñ„Ð¸Ð»ÑŒ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½"),y("ÐŸÑ€Ð¾Ñ„Ð¸Ð»ÑŒ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½"),p(!0),i(""))},onError:s=>{var t,r;i(((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.message)||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ð¸ Ð¿Ñ€Ð¾Ñ„Ð¸Ð»Ñ")}}),P=k(async s=>(await g.put("/auth/me/password",s)).data,{onSuccess:()=>{w("ÐŸÐ°Ñ€Ð¾Ð»ÑŒ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½"),y("ÐŸÐ°Ñ€Ð¾Ð»ÑŒ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½"),p(!0),i("")},onError:s=>{var t,r;i(((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.message)||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ ÑÐ¼ÐµÐ½Ðµ Ð¿Ð°Ñ€Ð¾Ð»Ñ")}}),I=k(async s=>{const t=new FormData;return t.append("avatar",s),(await g.post("/auth/me/avatar",t,{onUploadProgress:x=>{if(x.total){const h=Math.round(x.loaded*100/x.total);b({fileName:s.name,progress:h})}}})).data.data},{onSuccess:s=>{s&&(M(s),D.setQueryData("me",s),D.invalidateQueries("me"),w("Ð£ÑÐ¿ÐµÑˆÐ½Ð¾!"),y("Ð¤Ð¾Ñ‚Ð¾ Ð¿Ñ€Ð¾Ñ„Ð¸Ð»Ñ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ð¾"),p(!0),i("")),j(!1),b(null)},onError:s=>{var t,r;i(((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.message)||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐµ Ñ„Ð¾Ñ‚Ð¾"),j(!1),b(null)}}),Q=s=>{var h;const t=(h=s.target.files)==null?void 0:h[0];if(!t)return;if(!["image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(t.type)){i("Ð Ð°Ð·Ñ€ÐµÑˆÐµÐ½Ñ‹ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ (JPEG, PNG, GIF, WebP)");return}const x=5*1024*1024;if(t.size>x){i("Ð Ð°Ð·Ð¼ÐµÑ€ Ñ„Ð°Ð¹Ð»Ð° Ð½Ðµ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð¿Ñ€ÐµÐ²Ñ‹ÑˆÐ°Ñ‚ÑŒ 5MB");return}j(!0),i(""),I.mutate(t)},{register:c,handleSubmit:W,formState:{errors:l}}=E({resolver:T(le),defaultValues:{firstName:(a==null?void 0:a.firstName)||"",lastName:(a==null?void 0:a.lastName)||"",phone:(a==null?void 0:a.phone)||"",email:(a==null?void 0:a.email)||"",language:(a==null?void 0:a.language)||N.language||"ru"}}),{register:S,handleSubmit:q,formState:{errors:m},reset:O}=E({resolver:T(re)}),V=async s=>{v.mutate(s),s.language&&s.language!==N.language&&(await N.changeLanguage(s.language),localStorage.setItem("i18nextLng",s.language))},B=s=>{P.mutate({currentPassword:s.currentPassword,newPassword:s.newPassword}),O()};return e.jsxs("div",{className:"max-w-2xl",children:[e.jsxs("div",{className:"relative mb-8 animate-slide-in",children:[e.jsx("h1",{className:"text-2xl md:text-3xl lg:text-5xl font-bold text-gradient",children:"ÐŸÑ€Ð¾Ñ„Ð¸Ð»ÑŒ"}),(a==null?void 0:a.coins)!==void 0&&e.jsxs("div",{className:"mt-4 inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-yellow-50 to-amber-50 border-2 border-yellow-300 rounded-lg",children:[e.jsx("span",{className:"text-2xl",children:"ðŸª™"}),e.jsxs("span",{className:"text-lg font-bold text-yellow-700",children:[a.coins," ÐºÐ¾Ð¸Ð½Ð¾Ð²"]})]})]}),F&&e.jsx("div",{className:"mb-6 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg animate-fade-scale",children:F}),e.jsxs("div",{className:"card p-4 md:p-6 mb-4 md:mb-6 animate-fade-scale",style:{animationDelay:"0.1s"},children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center sm:items-start gap-4 mb-4 md:mb-6",children:[e.jsxs("div",{className:"relative group",children:[e.jsxs("label",{htmlFor:"avatar-upload-input",className:"flex items-center justify-center w-20 h-20 md:w-24 md:h-24 rounded-full bg-gradient-primary text-white shadow-soft overflow-hidden cursor-pointer relative",children:[a!=null&&a.avatarUrl?e.jsx("img",{src:(U=a.avatarUrl)!=null&&U.startsWith("http")?a.avatarUrl:`${"https://api.academy.dilmurodnurkhonov.uz/api".replace("/api","")||"https://api.academy.dilmurodnurkhonov.uz"}${a.avatarUrl}`,alt:`${a.firstName} ${a.lastName}`,className:"w-full h-full object-cover",onError:s=>{console.error("Error loading avatar:",a.avatarUrl),s.currentTarget.style.display="none"},onLoad:()=>{console.log("Avatar loaded successfully:",a.avatarUrl)}},a.avatarUrl):e.jsx(X,{className:"h-12 w-12"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity rounded-full pointer-events-none",children:d?e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-white border-t-transparent"}):e.jsx(Y,{className:"h-8 w-8 text-white"})})]}),e.jsx("input",{ref:G,type:"file",accept:"image/jpeg,image/jpg,image/png,image/gif,image/webp",onChange:Q,disabled:d,style:{position:"absolute",width:0,height:0,opacity:0,overflow:"hidden",zIndex:-1,pointerEvents:d?"none":"auto"},id:"avatar-upload-input"})]}),e.jsxs("div",{className:"flex-1 text-center sm:text-left",children:[e.jsxs("h2",{className:"text-base md:text-xl font-semibold text-neutral-900 break-words",children:[a==null?void 0:a.firstName," ",a==null?void 0:a.lastName]}),e.jsx("p",{className:"text-sm md:text-base text-neutral-600 break-words",children:a==null?void 0:a.phone}),u&&e.jsx("div",{className:"mt-2",children:e.jsx(te,{fileName:u.fileName,progress:u.progress})}),!u&&e.jsxs("label",{htmlFor:"avatar-upload-input",className:`mt-2 flex items-center gap-2 text-sm text-neutral-600 hover:text-primary-600 transition-colors cursor-pointer ${d?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsx("span",{children:d?"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ°...":"Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ñ„Ð¾Ñ‚Ð¾"})]})]})]}),e.jsxs("form",{onSubmit:W(V),className:"space-y-4",children:[e.jsxs("div",{className:"animate-slide-in",style:{animationDelay:"0.2s"},children:[e.jsx("label",{htmlFor:"firstName",className:"block text-sm font-medium text-neutral-700 mb-2",children:"Ð˜Ð¼Ñ"}),e.jsx("input",{...c("firstName"),type:"text",className:"input-field",placeholder:"Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð¸Ð¼Ñ"}),l.firstName&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.firstName.message})]}),e.jsxs("div",{className:"animate-slide-in",style:{animationDelay:"0.3s"},children:[e.jsx("label",{htmlFor:"lastName",className:"block text-sm font-medium text-neutral-700 mb-2",children:"Ð¤Ð°Ð¼Ð¸Ð»Ð¸Ñ"}),e.jsx("input",{...c("lastName"),type:"text",className:"input-field",placeholder:"Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ñ„Ð°Ð¼Ð¸Ð»Ð¸ÑŽ"}),l.lastName&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.lastName.message})]}),e.jsxs("div",{className:"animate-slide-in",style:{animationDelay:"0.4s"},children:[e.jsx("label",{htmlFor:"phone",className:"block text-sm font-medium text-neutral-700 mb-2",children:"Ð¢ÐµÐ»ÐµÑ„Ð¾Ð½"}),e.jsx("input",{...c("phone"),type:"text",className:"input-field",placeholder:"+998901234567"}),l.phone&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.phone.message})]}),e.jsxs("div",{className:"animate-slide-in",style:{animationDelay:"0.5s"},children:[e.jsxs("label",{htmlFor:"email",className:"block text-sm font-medium text-neutral-700 mb-2",children:["Email ",e.jsx("span",{className:"text-neutral-500 text-xs",children:"(Ð½ÐµÐ¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾)"})]}),e.jsx("input",{...c("email"),type:"email",className:"input-field",placeholder:"email@example.com"}),l.email&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.email.message})]}),e.jsxs("div",{className:"animate-slide-in",style:{animationDelay:"0.55s"},children:[e.jsxs("label",{htmlFor:"language",className:"block text-sm font-medium text-neutral-700 mb-2",children:[e.jsx(_,{className:"h-4 w-4 inline mr-2"}),"Ð¯Ð·Ñ‹Ðº Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ°"]}),e.jsxs("select",{...c("language"),className:"input-field",children:[e.jsx("option",{value:"ru",children:"ðŸ‡·ðŸ‡º Ð ÑƒÑÑÐºÐ¸Ð¹"}),e.jsx("option",{value:"en",children:"ðŸ‡ºðŸ‡¸ English"}),e.jsx("option",{value:"uz",children:"ðŸ‡ºðŸ‡¿ O'zbek"}),e.jsx("option",{value:"kk",children:"ðŸ‡°ðŸ‡¿ ÒšÐ°Ð·Ð°Ò›ÑˆÐ°"})]}),l.language&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.language.message})]}),e.jsx("div",{className:"animate-slide-in",style:{animationDelay:"0.6s"},children:e.jsx("button",{type:"submit",disabled:v.isLoading,className:"btn-primary w-full disabled:opacity-50 disabled:cursor-not-allowed",children:v.isLoading?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"animate-spin",children:"âŸ³"}),e.jsx("span",{children:"Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ..."})]}):"Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ"})})]})]}),e.jsxs("div",{className:"card p-6 animate-fade-scale",style:{animationDelay:"0.7s"},children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(R,{className:"h-6 w-6 text-primary-500 mr-3"}),e.jsx("h2",{className:"text-xl font-semibold text-neutral-900",children:"Ð˜Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ"})]}),e.jsxs("form",{onSubmit:q(B),className:"space-y-4",children:[e.jsxs("div",{className:"animate-slide-in",style:{animationDelay:"0.8s"},children:[e.jsx("label",{htmlFor:"currentPassword",className:"block text-sm font-medium text-neutral-700 mb-2",children:"Ð¢ÐµÐºÑƒÑ‰Ð¸Ð¹ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ"}),e.jsx("input",{...S("currentPassword"),type:"password",className:"input-field",placeholder:"Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ñ‚ÐµÐºÑƒÑ‰Ð¸Ð¹ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ"}),m.currentPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.currentPassword.message})]}),e.jsxs("div",{className:"animate-slide-in",style:{animationDelay:"0.9s"},children:[e.jsx("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-neutral-700 mb-2",children:"ÐÐ¾Ð²Ñ‹Ð¹ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ"}),e.jsx("input",{...S("newPassword"),type:"password",className:"input-field",placeholder:"Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð½Ð¾Ð²Ñ‹Ð¹ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ"}),m.newPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.newPassword.message})]}),e.jsxs("div",{className:"animate-slide-in",style:{animationDelay:"1s"},children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-neutral-700 mb-2",children:"ÐŸÐ¾Ð´Ñ‚Ð²ÐµÑ€Ð´Ð¸Ñ‚Ðµ Ð½Ð¾Ð²Ñ‹Ð¹ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ"}),e.jsx("input",{...S("confirmPassword"),type:"password",className:"input-field",placeholder:"ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚Ðµ Ð½Ð¾Ð²Ñ‹Ð¹ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ"}),m.confirmPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.confirmPassword.message})]}),e.jsx("div",{className:"animate-slide-in",style:{animationDelay:"1.1s"},children:e.jsx("button",{type:"submit",disabled:P.isLoading,className:"btn-primary w-full disabled:opacity-50 disabled:cursor-not-allowed",children:P.isLoading?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"animate-spin",children:"âŸ³"}),e.jsx("span",{children:"ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ..."})]}):"Ð˜Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ"})})]})]}),e.jsx(se,{isOpen:A,onClose:()=>p(!1),title:C,message:$})]})}export{de as default};
