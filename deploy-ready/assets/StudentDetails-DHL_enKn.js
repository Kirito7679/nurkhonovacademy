import{ag as Z,d as _,u as ee,r as f,e as k,f as b,V as P,j as e,as as se,U as te,aQ as ae,aa as re,s as I,D as v,ar as O,ae as ne,T as $,aP as le,X as ie,$ as A,a0 as L,a1 as y}from"./vendor-D1Bc63Il.js";import{a as d}from"./index-MX_rF5Am.js";const de=L({newPassword:y().min(6,"Пароль должен содержать минимум 6 символов")}),ce=L({accessStartDate:y().optional(),accessEndDate:y().optional()}).refine(t=>t.accessEndDate&&t.accessStartDate?new Date(t.accessEndDate)>=new Date(t.accessStartDate):!0,{message:"Дата окончания не может быть раньше даты начала",path:["accessEndDate"]});function pe(){const{id:t}=Z(),M=_(),x=ee(),[R,c]=f.useState(!1),[u,o]=f.useState(null),[oe,T]=f.useState({isOpen:!1,message:""}),[me,n]=f.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}}),{data:V,isLoading:Q}=k(["student",t],async()=>(await d.get(`/students/${t}`)).data.data),{data:F}=k("allCourses",async()=>(await d.get("/courses")).data.data||[]),j=b(async({courseId:s,action:r})=>(await d.put(`/students/${t}/courses/${s}`,{action:r})).data,{onSuccess:()=>{x.invalidateQueries(["student",t])}}),l=b(async({courseId:s,data:r})=>(await d.post(`/students/${t}/courses/${s}`,r)).data,{onSuccess:()=>{x.invalidateQueries(["student",t]),c(!1),o(null),m()}}),w=b(async s=>(await d.delete(`/students/${t}/courses/${s}`)).data,{onSuccess:()=>{x.invalidateQueries(["student",t])}}),i=b(async s=>(await d.put(`/students/${t}/reset-password`,s)).data,{onSuccess:()=>{x.invalidateQueries(["student",t])}}),{register:G,handleSubmit:J,formState:{errors:D},reset:U}=P({resolver:A(de),defaultValues:{newPassword:""}}),{register:C,handleSubmit:X,formState:{errors:p},reset:m,watch:q}=P({resolver:A(ce),defaultValues:{accessStartDate:"",accessEndDate:""}}),E=q("accessEndDate"),S=!!E&&E.trim()!=="";if(Q)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block relative",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-primary-200 border-t-primary-500"})}),e.jsx("p",{className:"mt-4 text-neutral-600",children:"Загрузка студента..."})]});const a=V;if(!a)return e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-neutral-600",children:"Студент не найден"})});const g=a?.studentCourses||[],z=F||[],B=g.map(s=>s.courseId),N=z.filter(s=>!B.includes(s.id)),K=s=>{i.mutate(s,{onSuccess:()=>{U(),T({isOpen:!0,message:"Пароль успешно изменен"})}})},H=s=>{u&&l.mutate({courseId:u,data:{accessStartDate:s.accessStartDate||void 0,accessEndDate:s.accessEndDate||void 0}})},W=s=>{o(s),c(!0)},h=s=>s?new Date(s).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}):null;return e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>M("/teacher/students"),className:"flex items-center text-neutral-600 hover:text-primary-600 mb-6 transition-colors animate-slide-in",children:[e.jsx(se,{className:"h-5 w-5 mr-2"}),"Назад к студентам"]}),e.jsx("div",{className:"relative mb-8 animate-fade-scale",children:e.jsxs("h1",{className:"text-xl md:text-2xl lg:text-4xl font-bold text-gradient break-words",children:[a.firstName," ",a.lastName]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6",children:[e.jsxs("div",{className:"lg:col-span-1",children:[e.jsx("div",{className:"card p-6 mb-6 animate-fade-scale",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("div",{className:"flex items-center justify-center w-24 h-24 rounded-full bg-gradient-primary text-white mb-4 animate-pulse-glow",children:e.jsx(te,{className:"h-12 w-12"})}),e.jsxs("h2",{className:"text-2xl font-bold text-neutral-900 mb-2",children:[a.firstName," ",a.lastName]}),e.jsxs("p",{className:"text-neutral-600",children:["Телефон: ",a.phone]}),a.email&&e.jsxs("p",{className:"text-neutral-600",children:["Email: ",a.email]})]})}),e.jsxs("div",{className:"card p-6 animate-fade-scale",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(ae,{className:"h-6 w-6 text-primary-500 mr-3"}),e.jsx("h2",{className:"text-xl font-semibold text-neutral-900",children:"Сбросить пароль"})]}),e.jsxs("form",{onSubmit:J(K),className:"space-y-4",children:[e.jsxs("div",{className:"animate-slide-in",style:{animationDelay:"0.1s"},children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Новый пароль"}),e.jsx("input",{...G("newPassword"),type:"password",className:"input-field",placeholder:"Введите новый пароль"}),D.newPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:D.newPassword.message})]}),i.error&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm",children:i.error?.response?.data?.message||"Ошибка при изменении пароля"}),e.jsx("div",{className:"animate-slide-in",style:{animationDelay:"0.2s"},children:e.jsxs("button",{type:"submit",disabled:i.isLoading,className:"btn-primary w-full disabled:opacity-50 disabled:cursor-not-allowed inline-flex items-center justify-center gap-2","aria-busy":i.isLoading,children:[e.jsx(re,{className:"h-5 w-5"}),i.isLoading?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin",children:"⟳"}),e.jsx("span",{children:"Сброс..."})]}):"Сбросить пароль"]})})]})]})]}),e.jsxs("div",{className:"lg:col-span-2",children:[e.jsxs("div",{className:"card p-6 mb-6 animate-fade-scale",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(I,{className:"h-6 w-6 text-primary-500 mr-3"}),e.jsx("h2",{className:"text-xl font-semibold text-neutral-900",children:"Курсы студента"})]}),g.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-neutral-500",children:"Нет курсов"})}):e.jsx("div",{className:"space-y-3 mb-6",children:g.map((s,r)=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-[#374151] rounded-lg hover:border-[#39ff14]/50 hover:bg-[#1f2937]/50 transition-all animate-slide-in",style:{animationDelay:`${.1*r}s`},children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-neutral-900 mb-1",children:s.course?.title}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[s.status==="APPROVED"&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-mono bg-[#39ff14]/20 text-[#39ff14] border border-[#39ff14]/50",children:[e.jsx(v,{className:"h-3 w-3 mr-1"}),"APPROVED"]}),s.status==="PENDING"&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-mono bg-yellow-500/20 text-yellow-400 border border-yellow-500/50",children:"PENDING"}),s.status==="REJECTED"&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-mono bg-red-500/20 text-red-400 border border-red-500/50",children:[e.jsx(O,{className:"h-3 w-3 mr-1"}),"REJECTED"]}),s.status==="APPROVED"&&(s.accessStartDate||s.accessEndDate)&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-mono bg-blue-500/20 text-blue-400 border border-blue-500/50",children:[e.jsx(ne,{className:"h-3 w-3 mr-1"}),s.accessStartDate&&s.accessEndDate?`${h(s.accessStartDate)} - ${h(s.accessEndDate)}`:s.accessStartDate?`с ${h(s.accessStartDate)}`:s.accessEndDate?`до ${h(s.accessEndDate)}`:"бессрочно"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[s.status==="PENDING"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>j.mutate({courseId:s.courseId,action:"approve"}),className:"p-2 text-[#39ff14] hover:bg-[#39ff14]/10 rounded-lg border border-[#39ff14]/50 hover:border-[#39ff14] transition-all",title:"Одобрить",children:e.jsx(v,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>j.mutate({courseId:s.courseId,action:"reject"}),className:"p-2 text-red-400 hover:bg-red-500/10 rounded-lg border border-red-500/50 hover:border-red-500 transition-all",title:"Отклонить",children:e.jsx(O,{className:"h-5 w-5"})})]}),s.status==="APPROVED"&&e.jsx("button",{onClick:()=>{n({isOpen:!0,title:"Открепить курс",message:"Вы уверены, что хотите открепить этот курс от студента?",variant:"danger",onConfirm:()=>{w.mutate(s.courseId),n({isOpen:!1,title:"",message:"",onConfirm:()=>{}})}})},className:"p-2 text-red-400 hover:bg-red-500/10 rounded-lg border border-red-500/50 hover:border-red-500 transition-all",title:"Открепить курс",children:e.jsx($,{className:"h-5 w-5"})}),s.status==="REJECTED"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{n({isOpen:!0,title:"Одобрить курс",message:"Одобрить этот курс для студента?",variant:"info",onConfirm:()=>{j.mutate({courseId:s.courseId,action:"approve"}),n({isOpen:!1,title:"",message:"",onConfirm:()=>{}})}})},className:"p-2 text-[#39ff14] hover:bg-[#39ff14]/10 rounded-lg border border-[#39ff14]/50 hover:border-[#39ff14] transition-all",title:"Одобрить курс",children:e.jsx(v,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>{n({isOpen:!0,title:"Удалить курс",message:"Вы уверены, что хотите удалить этот отклоненный курс из списка?",variant:"danger",onConfirm:()=>{w.mutate(s.courseId),n({isOpen:!1,title:"",message:"",onConfirm:()=>{}})}})},className:"p-2 text-red-400 hover:bg-red-500/10 rounded-lg border border-red-500/50 hover:border-red-500 transition-all",title:"Удалить из списка",children:e.jsx($,{className:"h-5 w-5"})})]})]})]},s.id))})]}),N.length>0&&e.jsxs("div",{className:"card p-6 animate-fade-scale",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(le,{className:"h-6 w-6 text-primary-500 mr-3"}),e.jsx("h3",{className:"text-lg font-semibold text-neutral-900",children:"Назначить курс"})]}),e.jsx("div",{className:"space-y-2",children:N.map((s,r)=>e.jsxs("button",{onClick:()=>W(s.id),disabled:l.isLoading,className:"w-full flex items-center justify-between p-4 border border-[#374151] rounded-lg hover:border-[#39ff14]/50 hover:bg-[#1f2937]/50 text-left transition-all animate-slide-in group",style:{animationDelay:`${.1*r}s`},children:[e.jsx("span",{className:"font-medium text-neutral-900 group-hover:text-primary-600 transition-colors",children:s.title}),e.jsx(I,{className:"h-5 w-5 text-neutral-400 group-hover:text-primary-500 transition-colors"})]},s.id))})]})]})]}),R&&u&&e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 transition-opacity bg-black/75",onClick:()=>{c(!1),o(null),m()}}),e.jsx("div",{className:"inline-block align-bottom bg-[#111827] rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full border border-[#39ff14]/50 neon-border",children:e.jsxs("div",{className:"bg-[#111827] px-6 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gradient",children:"Назначить курс"}),e.jsx("button",{onClick:()=>{c(!1),o(null),m()},className:"text-gray-400 hover:text-[#39ff14] transition-colors",children:e.jsx(ie,{className:"h-6 w-6"})})]}),e.jsxs("form",{onSubmit:X(H),className:"space-y-4",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-neutral-700 mb-4",children:["Курс: ",e.jsx("span",{className:"text-primary-600 font-semibold",children:N.find(s=>s.id===u)?.title})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Тип доступа"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{children:e.jsxs("label",{className:"flex items-center text-neutral-700 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:!!S,onChange:s=>{s.target.checked||m({accessStartDate:"",accessEndDate:""})},className:"mr-2 w-4 h-4 text-primary-500 bg-white border-neutral-300 rounded focus:ring-primary-500"}),e.jsx("span",{children:"Установить срок доступа"})]})}),S&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Дата начала доступа"}),e.jsx("input",{...C("accessStartDate"),type:"date",className:"input-field"}),p.accessStartDate&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:p.accessStartDate.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Дата окончания доступа"}),e.jsx("input",{...C("accessEndDate"),type:"date",className:"input-field"}),p.accessEndDate&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:p.accessEndDate.message})]})]})]})]}),l.error&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm",children:l.error?.response?.data?.message||"Ошибка при прикреплении курса"}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{c(!1),o(null),m()},className:"btn-secondary flex-1",children:"Отмена"}),e.jsx("button",{type:"submit",disabled:l.isLoading,className:"btn-primary flex-1 disabled:opacity-50 disabled:cursor-not-allowed",children:l.isLoading?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"animate-spin",children:"⟳"}),e.jsx("span",{children:"Назначение..."})]}):"Назначить"})]})]})]})})]})})]})}export{pe as default};
