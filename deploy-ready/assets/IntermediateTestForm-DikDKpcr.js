import{ac as w,u as E,f as L,r as x,h as C,V as T,k as I,j as e,am as M,at as O,ay as Q,T as A,ax as P}from"./vendor-react-BKQy8cua.js";import{t as V,o as $,n as u,s as b}from"./vendor-forms-BFjCwuAU.js";import{a as N}from"./index-B1iTD4yI.js";import{E as F}from"./ErrorModal-DDNSR7rT.js";import"./vendor-other-Bzl34R3H.js";import"./vendor-network-CoR7wtyb.js";import"./vendor-i18n-DHwuzpMN.js";import"./vendor-state-BcnB54Y8.js";const G=$({title:b().min(1,"Название теста обязательно"),description:b().optional(),passingScore:u().int().min(0).max(100).default(70),timeLimit:u().int().min(0).optional(),order:u().int().min(0).default(0)});function Y(){const{courseId:a,testId:n}=w(),m=E(),f=L(),p=!!n,[i,v]=x.useState([]),[R,h]=x.useState(null),[j,c]=x.useState({isOpen:!1,message:""}),{data:U,isLoading:y}=C(["test",n],async()=>(await N.get(`/tests/${n}`)).data.data,{enabled:p}),{register:r,handleSubmit:g,formState:{errors:l},reset:_}=T({resolver:V(G),defaultValues:{title:"",description:"",passingScore:70,timeLimit:void 0,order:0}}),o=I(async s=>(await N.post("/tests",{...s,courseId:a})).data.data,{onSuccess:()=>{f.invalidateQueries(["tests",a]),m(`/teacher/courses/${a}/edit`)},onError:s=>{var t,d;c({isOpen:!0,message:((d=(t=s.response)==null?void 0:t.data)==null?void 0:d.message)||"Ошибка при создании теста"})}}),S=s=>{if(i.length===0){c({isOpen:!0,message:"Добавьте хотя бы один вопрос"});return}o.mutate(s)};return y?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block relative",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-primary-200 border-t-primary-500"})}),e.jsx("p",{className:"mt-4 text-neutral-600",children:"Загрузка..."})]}):e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>m(`/teacher/courses/${a}/edit`),className:"flex items-center text-neutral-600 hover:text-primary-600 mb-6 transition-colors",children:[e.jsx(M,{className:"h-5 w-5 mr-2"}),"Назад к курсу"]}),e.jsx("div",{className:"relative mb-8",children:e.jsx("h1",{className:"text-2xl md:text-3xl lg:text-5xl font-bold text-gradient",children:p?"Редактировать тест":"Создать промежуточный тест"})}),e.jsxs("form",{onSubmit:g(S),className:"space-y-6",children:[e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-neutral-900 mb-4",children:"Основная информация"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Название теста *"}),e.jsx("input",{...r("title"),className:"input-field",placeholder:"Например: Тест по модулю 1"}),l.title&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.title.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Описание"}),e.jsx("textarea",{...r("description"),className:"input-field",rows:3,placeholder:"Описание теста (необязательно)"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Проходной балл (%) *"}),e.jsx("input",{...r("passingScore",{valueAsNumber:!0}),type:"number",min:"0",max:"100",className:"input-field",defaultValue:70}),l.passingScore&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.passingScore.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Лимит времени (минуты)"}),e.jsx("input",{...r("timeLimit",{valueAsNumber:!0}),type:"number",min:"0",className:"input-field",placeholder:"Не ограничено"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Порядок"}),e.jsx("input",{...r("order",{valueAsNumber:!0}),type:"number",min:"0",className:"input-field",defaultValue:0})]})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-neutral-900",children:"Вопросы"}),e.jsxs("button",{type:"button",onClick:()=>{h({id:"",testId:n||"",question:"",type:"SINGLE",order:i.length,points:1,options:[]})},className:"btn-primary text-sm",children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Добавить вопрос"]})]}),i.length===0?e.jsx("div",{className:"text-center py-8 text-neutral-500",children:e.jsx("p",{children:"Добавьте вопросы к тесту"})}):e.jsx("div",{className:"space-y-4",children:i.map((s,t)=>e.jsx("div",{className:"border border-neutral-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-neutral-900",children:s.question}),e.jsxs("p",{className:"text-sm text-neutral-600 mt-1",children:["Тип: ",s.type==="SINGLE"?"Один ответ":s.type==="MULTIPLE"?"Несколько ответов":"Текст"," • Баллов: ",s.points]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>h(s),className:"text-primary-600 hover:text-primary-700",children:e.jsx(Q,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>v(i.filter((d,k)=>k!==t)),className:"text-red-500 hover:text-red-600",children:e.jsx(A,{className:"h-4 w-4"})})]})]})},s.id||t))})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>m(`/teacher/courses/${a}/edit`),className:"btn-secondary",children:"Отмена"}),e.jsxs("button",{type:"submit",disabled:o.isLoading,className:"btn-primary flex-1 disabled:opacity-50",children:[e.jsx(P,{className:"h-5 w-5 mr-2"}),o.isLoading?"Сохранение...":"Сохранить тест"]})]})]}),e.jsx(F,{isOpen:j.isOpen,message:j.message,onClose:()=>c({isOpen:!1,message:""})})]})}export{Y as default};
