import{j as e,X as Q,aa as ae,ab as le,D as k,s as E,ac as re,r as P,u as z,f as G,ad as X,ae as ne,k as ie,af as ce,d as de,e as S,U as oe,ag as F,ah as q,a4 as Y,q as B,a9 as $,ai as me,aj as xe,ak as ue,al as he}from"./vendor-DlLoZmjg.js";import{b as pe,a as y,u as je,R as T,S as be}from"./index-DILgJ4JJ.js";import{B as fe}from"./Banner-upwY6MZ6.js";import{g as w,a as H,b as W}from"./courseUtils-Bo8LqfoL.js";function ge({isOpen:a,onClose:l,onConfirm:p,courseTitle:N,coursePrice:i,teacherTelegram:u,isLoading:c=!1}){if(!a)return null;const h=i===0,g=h?"Бесплатно":`${i.toLocaleString("ru-RU")} сум`,j=u?u.startsWith("http")?u:u.startsWith("@")?`https://t.me/${u.slice(1)}`:`https://t.me/${u}`:"https://t.me/Nurkhonov_Dilmurod";return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 animate-fade-in-scale p-4",onClick:b=>{b.target===b.currentTarget&&!c&&l()},children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md relative animate-slide-in overflow-hidden",children:[e.jsx("button",{onClick:l,disabled:c,className:"absolute top-4 right-4 z-10 text-neutral-400 hover:text-neutral-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed bg-white/80 backdrop-blur-sm rounded-full p-1.5 hover:bg-white",children:e.jsx(Q,{className:"h-5 w-5"})}),e.jsx("div",{className:`${h?"bg-gradient-to-br from-green-500 via-emerald-500 to-teal-500":"bg-gradient-to-br from-primary-500 to-primary-600"} p-6 md:p-8 pb-8`,children:e.jsxs("div",{className:"flex flex-col items-center text-center text-white",children:[e.jsx("div",{className:"w-20 h-20 rounded-full flex items-center justify-center mb-4 bg-white/20 backdrop-blur-sm border-2 border-white/30",children:h?e.jsx(ae,{className:"h-10 w-10 text-white"}):e.jsx(le,{className:"h-10 w-10 text-white"})}),e.jsx("h3",{className:"text-2xl md:text-3xl font-bold mb-2",children:h?"Бесплатный курс":"Стоимость курса"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("p",{className:"text-4xl md:text-5xl font-bold mb-1",children:g}),h&&e.jsx("p",{className:"text-white/90 text-sm md:text-base",children:"Начните обучение прямо сейчас!"})]})]})}),e.jsx("div",{className:"p-6 md:p-8",children:h?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h4",{className:"text-lg font-semibold text-neutral-900 mb-2",children:N}),e.jsx("p",{className:"text-neutral-600 text-sm",children:"После подтверждения курс будет автоматически добавлен в ваш список доступных курсов"})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(k,{className:"h-5 w-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-900",children:"Мгновенный доступ"}),e.jsx("p",{className:"text-xs text-green-700",children:"Курс будет доступен сразу после подтверждения"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(E,{className:"h-5 w-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-900",children:"Все материалы включены"}),e.jsx("p",{className:"text-xs text-green-700",children:"Получите доступ ко всем урокам и материалам курса"})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{onClick:l,disabled:c,className:"flex-1 px-4 py-3 border-2 border-neutral-300 rounded-xl text-sm font-semibold text-neutral-700 hover:bg-neutral-50 hover:border-neutral-400 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:"Отмена"}),e.jsx("button",{onClick:p,disabled:c,className:"flex-1 px-4 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl text-sm font-semibold hover:shadow-lg hover:scale-[1.02] transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:c?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin",children:"⟳"}),e.jsx("span",{children:"Обработка..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"h-5 w-5"}),e.jsx("span",{children:"Начать обучение"})]})})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h4",{className:"text-lg font-semibold text-neutral-900 mb-2",children:N}),e.jsx("p",{className:"text-neutral-600 text-sm",children:"Чтобы купить курс, свяжитесь с преподавателем в Telegram"})]}),e.jsxs("a",{href:j,target:"_blank",rel:"noopener noreferrer",className:"w-full flex items-center justify-center gap-3 px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-xl transition-all font-semibold shadow-md hover:shadow-lg group",children:[e.jsx(re,{className:"h-5 w-5 group-hover:scale-110 transition-transform"}),e.jsx("span",{children:"Написать в Telegram"})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{onClick:l,disabled:c,className:"flex-1 px-4 py-3 border-2 border-neutral-300 rounded-xl text-sm font-semibold text-neutral-700 hover:bg-neutral-50 hover:border-neutral-400 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:"Отмена"}),e.jsx("button",{onClick:p,disabled:c,className:"flex-1 px-4 py-3 bg-gradient-primary text-white rounded-xl text-sm font-semibold hover:shadow-lg hover:scale-[1.02] transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:c?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin",children:"⟳"}),e.jsx("span",{children:"Отправка..."})]}):"Отправить запрос"})]})]})})]})})}const Ne={"30_DAYS":"30 дней","3_MONTHS":"3 месяца","6_MONTHS":"6 месяцев","1_YEAR":"1 год"};function ve({isOpen:a,onClose:l,courseId:p,courseTitle:N,prices:i,currentEndDate:u}){const[c,h]=P.useState(null),g=z(),{showToast:j}=pe(),b=G(async x=>(await y.post(`/courses/${p}/extend`,{subscriptionPeriod:x})).data,{onSuccess:x=>{g.invalidateQueries(["course",p]),j("Подписка успешно продлена!","success"),l()},onError:x=>{j(x.response?.data?.message||"Ошибка при продлении подписки","error")}}),m=[];i.price30Days&&i.price30Days>0&&m.push({period:"30_DAYS",price:i.price30Days}),i.price3Months&&i.price3Months>0&&m.push({period:"3_MONTHS",price:i.price3Months}),i.price6Months&&i.price6Months>0&&m.push({period:"6_MONTHS",price:i.price6Months}),i.price1Year&&i.price1Year>0&&m.push({period:"1_YEAR",price:i.price1Year});const D=()=>{if(!c){j("Выберите период подписки","warning");return}b.mutate(c)};return a?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 animate-fade-in",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto animate-scale-in",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-neutral-200 px-6 py-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold text-neutral-900",children:"Продлить подписку"}),e.jsx("button",{onClick:l,className:"text-neutral-400 hover:text-neutral-600 transition-colors","aria-label":"Закрыть",children:e.jsx(Q,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-neutral-900 mb-2",children:N}),u&&e.jsxs("p",{className:"text-sm text-neutral-600",children:["Текущая подписка истекает: ",new Date(u).toLocaleDateString("ru-RU",{day:"numeric",month:"long",year:"numeric"})]})]}),m.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-neutral-600",children:"Цены для подписки не установлены"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-3 mb-6",children:m.map(({period:x,price:A})=>e.jsx("button",{onClick:()=>h(x),className:`w-full p-4 border-2 rounded-lg transition-all text-left ${c===x?"border-primary-500 bg-primary-50":"border-neutral-200 hover:border-primary-300"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(X,{className:"h-5 w-5 text-primary-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-neutral-900",children:Ne[x]}),e.jsx("div",{className:"text-sm text-neutral-600",children:c===x&&"Выбрано"})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"font-semibold text-neutral-900",children:[A.toLocaleString("ru-RU")," сум"]})})]})},x))}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:l,className:"flex-1 px-4 py-2 border border-neutral-300 rounded-lg text-neutral-700 hover:bg-neutral-50 transition-colors",children:"Отмена"}),e.jsx("button",{onClick:D,disabled:!c||b.isLoading,className:"flex-1 px-4 py-2 bg-gradient-primary text-white rounded-lg hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:b.isLoading?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),e.jsx("span",{children:"Обработка..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"h-4 w-4"}),e.jsx("span",{children:"Продлить"})]})})]}),e.jsx("p",{className:"mt-4 text-xs text-neutral-500 text-center",children:'После нажатия кнопки "Продлить" будет создан платеж для оплаты выбранного периода'})]})]})]})}):null}function De(){const{t:a}=ie(),{id:l}=ce(),p=de(),N=z(),{user:i}=je(),[u,c]=P.useState(!1),[h,g]=P.useState(!1),[j,b]=P.useState(!0),{data:m,isLoading:D}=S(["course",l],async()=>(await y.get(`/courses/${l}`)).data.data,{staleTime:5*60*1e3,cacheTime:10*60*1e3,enabled:!!l}),{data:x,isLoading:A}=S(["courseLessons",l],async()=>(await y.get(`/courses/${l}/lessons`)).data.data||[],{staleTime:5*60*1e3,cacheTime:10*60*1e3,enabled:!!l}),{data:J,isLoading:we}=S(["modules",l],async()=>(await y.get(`/modules/courses/${l}/modules`)).data.data||[],{staleTime:10*60*1e3,cacheTime:20*60*1e3,enabled:!!l}),K=D||!m?!1:i?.role===T.ADMIN||i?.role===T.CURATOR?!0:i?.role===T.TEACHER?m.teacherId===i.id:i?.role===T.STUDENT?m.hasAccess===!0&&m.studentCourseStatus===be.APPROVED:!1,{data:Z}=S(["tests",l],async()=>{try{return(await y.get(`/tests/courses/${l}/tests`)).data.data||[]}catch(t){if(t.response?.status===403)return[];throw t}},{staleTime:5*60*1e3,cacheTime:10*60*1e3,enabled:!!l&&!!K,retry:!1}),V=G(async()=>(await y.post(`/courses/${l}/request`)).data,{onSuccess:()=>{N.invalidateQueries(["course",l]),c(!1)},onError:()=>{}}),s=m,d=x||[],v=J||[],U=Z||[];s?.trialLessonId&&d.find(t=>t.id===s.trialLessonId);const _=d.filter(t=>t.progress?.completed).length,R=d.length>0?Math.round(_/d.length*100):0,ee=()=>{const t=new Map,o=[];return d.forEach(n=>{n.moduleId?(t.has(n.moduleId)||t.set(n.moduleId,[]),t.get(n.moduleId).push(n)):o.push(n)}),t.forEach(n=>{n.sort((f,r)=>f.order-r.order)}),o.sort((n,f)=>n.order-f.order),{lessonsByModule:t,lessonsWithoutModule:o}},{lessonsByModule:I,lessonsWithoutModule:C}=ee();if(D)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block relative",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-primary-200 border-t-primary-500"})}),e.jsx("p",{className:"mt-4 text-neutral-600",children:a("common.loading")})]});if(!s)return e.jsx("div",{className:"text-center py-12 animate-fade-scale",children:e.jsx("p",{className:"text-neutral-600",children:a("errors.notFound")})});const se=()=>{c(!0)},te=()=>{V.mutate()};return e.jsxs("div",{children:[e.jsx(fe,{position:"TOP"}),s.thumbnailUrl&&e.jsxs("div",{className:"relative w-full h-48 md:h-64 lg:h-80 mb-8 rounded-lg overflow-hidden animate-fade-scale",children:[e.jsx("img",{src:s.thumbnailUrl,alt:s.title,className:"w-full h-full object-cover",onError:t=>{t.target.style.display="none"}}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 via-black/30 to-transparent"}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-6 md:p-8",children:[e.jsx("h1",{className:"text-2xl md:text-4xl lg:text-5xl font-bold text-white mb-2 break-words",children:s.title}),s.teacher&&e.jsxs("div",{className:"flex items-center text-white/90 text-sm md:text-base",children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),e.jsxs("span",{children:[a("courses.teacher",{defaultValue:"Преподаватель"}),": ",s.teacher.firstName," ",s.teacher.lastName]})]})]})]}),e.jsxs("div",{className:"mb-8 animate-slide-in",children:[!s.thumbnailUrl&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-4",children:[w(s.language)&&e.jsxs("span",{className:"inline-flex items-center px-3 py-1.5 rounded-lg text-sm font-medium bg-white border border-neutral-200 shadow-sm",children:[e.jsx("span",{className:"mr-1.5 text-base",children:w(s.language).flag}),e.jsx("span",{children:w(s.language).label})]}),s.category&&e.jsx("span",{className:`inline-flex items-center px-3 py-1.5 rounded-lg text-sm font-medium border ${W(s.category)}`,children:H(s.category)})]}),e.jsx("h1",{className:"text-2xl md:text-3xl lg:text-5xl font-bold text-gradient mb-4 break-words",children:s.title})]}),s.thumbnailUrl&&e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-6",children:[w(s.language)&&e.jsxs("span",{className:"inline-flex items-center px-3 py-1.5 rounded-lg text-sm font-medium bg-white border border-neutral-200 shadow-sm",children:[e.jsx("span",{className:"mr-1.5 text-base",children:w(s.language).flag}),e.jsx("span",{children:w(s.language).label})]}),s.category&&e.jsx("span",{className:`inline-flex items-center px-3 py-1.5 rounded-lg text-sm font-medium border ${W(s.category)}`,children:H(s.category)})]}),s.hasAccess&&d.length>0&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"card p-4 text-center",children:[e.jsx(k,{className:"h-6 w-6 text-green-500 mx-auto mb-2"}),e.jsx("div",{className:"text-2xl font-bold text-neutral-900",children:_}),e.jsx("div",{className:"text-sm text-neutral-600",children:a("lessons.completed",{defaultValue:"Завершено"})})]}),e.jsxs("div",{className:"card p-4 text-center",children:[e.jsx("div",{className:"h-6 w-6 mx-auto mb-2 flex items-center justify-center",children:e.jsx("div",{className:"w-12 h-12 rounded-full border-4 border-primary-200 border-t-primary-500",style:{background:`conic-gradient(from 0deg, #39ff14 ${R*3.6}deg, #e5e7eb ${R*3.6}deg)`}})}),e.jsxs("div",{className:"text-2xl font-bold text-neutral-900",children:[R,"%"]}),e.jsx("div",{className:"text-sm text-neutral-600",children:a("dashboard.overallProgress",{defaultValue:"Прогресс"})})]}),e.jsxs("div",{className:"card p-4 text-center",children:[e.jsx(F,{className:"h-6 w-6 text-yellow-500 mx-auto mb-2"}),e.jsx("div",{className:"text-2xl font-bold text-neutral-900",children:i?.coins||0}),e.jsx("div",{className:"text-sm text-neutral-600",children:a("profile.coins",{defaultValue:"Коинов"})})]})]}),s.hasAccess&&s.subscriptionType==="PAID"&&s.accessEndDate&&e.jsx("div",{className:"card p-6 md:p-8 mb-6 border-2 border-primary-200",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-900 mb-2",children:"Подписка активна"}),e.jsxs("p",{className:"text-sm text-neutral-600",children:["Подписка истекает: ",new Date(s.accessEndDate).toLocaleDateString("ru-RU",{day:"numeric",month:"long",year:"numeric"})]}),new Date(s.accessEndDate)<new Date(Date.now()+7*24*60*60*1e3)&&e.jsxs("p",{className:"text-sm text-orange-600 mt-2",children:["⚠️ Подписка истечет через ",Math.ceil((new Date(s.accessEndDate).getTime()-Date.now())/(1e3*60*60*24))," дней"]})]}),e.jsx("button",{onClick:()=>g(!0),className:"btn-primary",children:"Продлить подписку"})]})}),s.hasAccess===!1&&s.isSubscriptionExpired&&s.subscriptionType==="PAID"&&e.jsx("div",{className:"card p-6 md:p-8 mb-6 border-2 border-red-200 bg-red-50",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-red-900 mb-2",children:"Подписка истекла"}),e.jsx("p",{className:"text-sm text-red-700",children:"Ваша подписка на этот курс закончилась. Продлите подписку для продолжения обучения."})]}),e.jsx("button",{onClick:()=>g(!0),className:"btn-primary",children:"Продлить подписку"})]})}),s.description&&e.jsxs("div",{className:"card p-6 md:p-8 mb-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-semibold text-neutral-900 mb-4",children:a("courses.aboutCourse",{defaultValue:"О курсе"})}),e.jsx("p",{className:"text-neutral-600 text-sm md:text-base lg:text-lg leading-relaxed break-words whitespace-pre-line",children:s.description})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"card p-4 text-center",children:[e.jsx(q,{className:"h-6 w-6 text-primary-500 mx-auto mb-2"}),e.jsx("div",{className:"text-2xl font-bold text-neutral-900",children:v.length}),e.jsx("div",{className:"text-sm text-neutral-600",children:a("modules.title",{defaultValue:"Модулей"})})]}),e.jsxs("div",{className:"card p-4 text-center",children:[e.jsx(E,{className:"h-6 w-6 text-primary-500 mx-auto mb-2"}),e.jsx("div",{className:"text-2xl font-bold text-neutral-900",children:d.length}),e.jsx("div",{className:"text-sm text-neutral-600",children:a("lessons.title",{defaultValue:"Уроков"})})]}),e.jsxs("div",{className:"card p-4 text-center",children:[e.jsx(Y,{className:"h-6 w-6 text-primary-500 mx-auto mb-2"}),e.jsx("div",{className:"text-2xl font-bold text-neutral-900",children:d.length>0?Math.ceil(d.length*.5):0}),e.jsx("div",{className:"text-sm text-neutral-600",children:a("courses.hours",{defaultValue:"Часов"})})]}),e.jsxs("div",{className:"card p-4 text-center",children:[e.jsx(B,{className:"h-6 w-6 text-primary-500 mx-auto mb-2"}),e.jsx("div",{className:"text-2xl font-bold text-neutral-900",children:s._count?.studentCourses||0}),e.jsx("div",{className:"text-sm text-neutral-600",children:a("courses.students",{defaultValue:"Студентов"})})]})]}),e.jsxs("div",{className:"card p-6 md:p-8 mb-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-semibold text-neutral-900 mb-6",children:a("courses.advantages",{defaultValue:"Преимущества курса"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-neutral-50 rounded-lg",children:[e.jsx(X,{className:"h-6 w-6 text-primary-500 flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-neutral-900 mb-1",children:a("courses.flexibleSchedule",{defaultValue:"Гибкий график"})}),e.jsx("p",{className:"text-sm text-neutral-600",children:a("courses.flexibleScheduleDesc",{defaultValue:"Изучайте в удобное для вас время, совмещая с работой и личной жизнью"})})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-neutral-50 rounded-lg",children:[e.jsx(F,{className:"h-6 w-6 text-primary-500 flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-neutral-900 mb-1",children:a("courses.certificate",{defaultValue:"Сертификат"})}),e.jsx("p",{className:"text-sm text-neutral-600",children:a("courses.certificateDesc",{defaultValue:"Получите сертификат после успешного завершения курса"})})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-neutral-50 rounded-lg",children:[e.jsx(E,{className:"h-6 w-6 text-primary-500 flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-neutral-900 mb-1",children:a("courses.practicalTasks",{defaultValue:"Практические задания"})}),e.jsx("p",{className:"text-sm text-neutral-600",children:a("courses.practicalTasksDesc",{defaultValue:"Закрепляйте знания через практические упражнения и задания"})})]})]}),s.subscriptionType==="PAID"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-neutral-50 rounded-lg",children:[e.jsx(Y,{className:"h-6 w-6 text-primary-500 flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-neutral-900 mb-1",children:a("courses.lifetimeAccess",{defaultValue:"Доступ на период подписки"})}),e.jsx("p",{className:"text-sm text-neutral-600",children:a("courses.lifetimeAccessDesc",{defaultValue:"Доступ к курсу на выбранный период подписки"})})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-neutral-50 rounded-lg",children:[e.jsx(B,{className:"h-6 w-6 text-primary-500 flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-neutral-900 mb-1",children:a("courses.support",{defaultValue:"Поддержка преподавателя"})}),e.jsx("p",{className:"text-sm text-neutral-600",children:a("courses.supportDesc",{defaultValue:"Получайте помощь и ответы на вопросы от преподавателя"})})]})]})]}),s.subscriptionType==="FREE"&&e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-neutral-50 rounded-lg",children:[e.jsx(F,{className:"h-6 w-6 text-primary-500 flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-neutral-900 mb-1",children:a("courses.freeAccess",{defaultValue:"Бесплатный доступ"})}),e.jsx("p",{className:"text-sm text-neutral-600",children:a("courses.freeAccessDesc",{defaultValue:"Полный доступ к курсу абсолютно бесплатно"})})]})]})]})]}),s.hasAccess&&U.length>0&&e.jsxs("div",{className:"card p-6 md:p-8 mb-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-semibold text-neutral-900 mb-6",children:"Промежуточные тесты"}),e.jsx("div",{className:"space-y-3",children:U.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-neutral-200 rounded-lg hover:border-primary-300 transition-colors",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-neutral-900",children:t.title}),t.description&&e.jsx("p",{className:"text-sm text-neutral-600 mt-1",children:t.description}),e.jsxs("p",{className:"text-xs text-neutral-500 mt-2",children:["Проходной балл: ",t.passingScore,"% •",t.timeLimit?` Время: ${t.timeLimit} мин`:" Без ограничения времени"]})]}),e.jsxs("button",{onClick:()=>p(`/courses/${l}/tests/${t.id}`),className:"btn-primary text-sm ml-4",children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Пройти тест"]})]},t.id))})]}),(v.length>0||d.length>0)&&e.jsxs("div",{className:"card p-6 md:p-8 mb-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-semibold text-neutral-900 mb-6",children:a("courses.program",{defaultValue:"Структура курса"})}),e.jsxs("div",{className:"space-y-4",children:[v.sort((t,o)=>t.order-o.order).map((t,o)=>{const n=I.get(t.id)||[];if(n.length===0)return null;let f=1;for(let r=0;r<o;r++){const L=I.get(v[r].id)||[];f+=L.length}return e.jsxs("div",{className:"border-l-4 border-primary-500 pl-4 md:pl-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-gradient-primary text-white font-bold text-lg flex-shrink-0",children:o+1}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg md:text-xl font-semibold text-neutral-900",children:t.title}),t.description&&e.jsx("p",{className:"text-sm text-neutral-500 mt-1",children:t.description})]}),e.jsxs("span",{className:"text-sm text-neutral-500 ml-auto",children:[n.length," ",a("lessons.lessonsCount",{count:n.length,defaultValue:n.length===1?"урок":"уроков"})]})]}),e.jsx("div",{className:"ml-12 md:ml-14 space-y-2",children:n.map((r,L)=>{const M=!(s.hasAccess||s.trialLessonId===r.id);return e.jsxs("div",{className:`flex items-center gap-2 transition-colors ${M?"text-neutral-400 cursor-not-allowed":"text-neutral-600 hover:text-primary-600 cursor-pointer"}`,onClick:()=>{M||p(`/courses/${l}/lessons/${r.id}`)},children:[e.jsxs("span",{className:"text-sm font-medium w-6",children:[f+L,"."]}),e.jsx("span",{className:"text-sm md:text-base flex-1",children:r.title}),M&&e.jsx($,{className:"h-4 w-4 text-neutral-400 ml-auto"}),!M&&r.progress?.completed&&e.jsx(k,{className:"h-4 w-4 text-green-500 ml-auto"})]},r.id)})})]},t.id)}),C.length>0&&e.jsxs("div",{className:"border-l-4 border-neutral-300 pl-4 md:pl-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("h3",{className:"text-lg md:text-xl font-semibold text-neutral-900",children:a("modules.additionalLessons",{defaultValue:"Дополнительные уроки"})}),e.jsxs("span",{className:"text-sm text-neutral-500 ml-auto",children:[C.length," ",a("lessons.lessonsCount",{count:C.length,defaultValue:C.length===1?"урок":"уроков"})]})]}),e.jsx("div",{className:"ml-12 md:ml-14 space-y-2",children:C.map((t,o)=>{let n=1;v.forEach(L=>{const O=I.get(L.id)||[];n+=O.length}),n+=o;const r=!(s.hasAccess||s.trialLessonId===t.id);return e.jsxs("div",{className:`flex items-center gap-2 transition-colors ${r?"text-neutral-400 cursor-not-allowed":"text-neutral-600 hover:text-primary-600 cursor-pointer"}`,onClick:()=>{r||p(`/courses/${l}/lessons/${t.id}`)},children:[e.jsxs("span",{className:"text-sm font-medium w-6",children:[n,"."]}),e.jsx("span",{className:"text-sm md:text-base flex-1",children:t.title}),r&&e.jsx($,{className:"h-4 w-4 text-neutral-400 ml-auto"}),!r&&t.progress?.completed&&e.jsx(k,{className:"h-4 w-4 text-green-500 ml-auto"})]},t.id)})})]})]})]}),v.length===0&&d.length===0&&e.jsxs("div",{className:"card p-6 md:p-8 mb-6 text-center",children:[e.jsx(E,{className:"h-12 w-12 text-neutral-300 mx-auto mb-4"}),e.jsx("p",{className:"text-neutral-500",children:a("courses.noStructure",{defaultValue:"Структура курса пока не добавлена"})})]})]}),e.jsxs("div",{className:"animate-fade-scale",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 md:mb-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-semibold text-neutral-900",children:a("courses.courseLessons",{defaultValue:"Уроки курса"})}),d.length>0&&e.jsx("button",{onClick:()=>b(!j),className:"flex items-center gap-2 text-primary-600 hover:text-primary-700 transition-colors text-sm md:text-base",children:j?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:a("common.close")}),e.jsx(me,{className:"h-5 w-5"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:a("courses.showAll",{defaultValue:"Показать все"})}),e.jsx(xe,{className:"h-5 w-5"})]})})]}),A?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block relative",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-primary-200 border-t-primary-500"})}),e.jsx("p",{className:"mt-4 text-neutral-600",children:a("common.loading")})]}):d.length===0?e.jsx("div",{className:"text-center py-12 animate-fade-scale",children:e.jsx("p",{className:"text-neutral-500",children:a("lessons.noLessons")})}):e.jsxs(e.Fragment,{children:[!s.hasAccess&&e.jsx("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("span",{className:"font-semibold",children:a("courses.trialLessons",{defaultValue:"Пробные уроки"})})," ",a("courses.trialLessonsDescription",{defaultValue:"доступны для просмотра. Для доступа ко всем урокам запросите доступ к курсу."})]})}),e.jsx("div",{className:"space-y-4",children:(j?d:d.slice(0,5)).map((t,o)=>{const n=s?.trialLessonId===t.id,r=!(s.hasAccess||n);return e.jsx("div",{className:`card p-4 md:p-6 animate-slide-in group ${r?"opacity-60 cursor-not-allowed":"card-hover cursor-pointer"}`,style:{animationDelay:`${.1*o}s`},onClick:()=>{r||p(`/courses/${l}/lessons/${t.id}`)},children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 md:gap-3 mb-2",children:[e.jsx("span",{className:`flex items-center justify-center w-8 h-8 md:w-10 md:h-10 rounded-full font-semibold text-sm md:text-base flex-shrink-0 transition-transform ${r?"bg-neutral-300 text-neutral-600":"bg-gradient-primary text-white group-hover:scale-110"}`,children:o+1}),e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx("h3",{className:`text-base md:text-lg font-semibold break-words transition-colors ${r?"text-neutral-500":"text-neutral-900 group-hover:text-primary-600"}`,children:t.title}),n&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-700 border border-blue-200",children:a("courses.trial",{defaultValue:"Пробный"})}),r&&e.jsx($,{className:"h-4 w-4 text-neutral-400 flex-shrink-0"})]})]}),t.description&&e.jsx("p",{className:`text-xs md:text-sm ml-10 md:ml-12 break-words line-clamp-2 ${r?"text-neutral-400":"text-neutral-600"}`,children:t.description}),e.jsx("div",{className:"flex items-center gap-3 mt-2 ml-10 md:ml-12",children:t.progress?.completed&&e.jsxs("span",{className:"inline-flex items-center px-2 md:px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-700 border border-green-200",children:[e.jsx(k,{className:"h-3 w-3 mr-1 text-green-700"}),a("lessons.completed")]})})]}),e.jsx("div",{className:"flex items-center gap-2",children:r?e.jsx($,{className:"h-5 w-5 text-neutral-400 flex-shrink-0"}):e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"h-5 w-5 text-primary-500 flex-shrink-0 group-hover:scale-110 transition-transform"}),e.jsx(he,{className:"h-5 w-5 text-neutral-400 group-hover:text-primary-500 group-hover:translate-x-1 transition-all flex-shrink-0"})]})})]})},t.id)})}),!j&&d.length>5&&e.jsx("div",{className:"text-center mt-4",children:e.jsx("button",{onClick:()=>b(!0),className:"text-primary-600 hover:text-primary-700 font-medium text-sm",children:a("courses.showAllLessons",{count:d.length,defaultValue:`Показать все ${d.length} уроков`})})}),!s.hasAccess&&e.jsx("div",{className:"mt-6 card p-4 md:p-6 text-center",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4 justify-center",children:[s.studentCourseStatus!=="PENDING"&&e.jsx("button",{onClick:se,disabled:V.isLoading,className:"btn-primary inline-flex items-center disabled:opacity-50 disabled:cursor-not-allowed",children:V.isLoading?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"animate-spin",children:"⟳"}),e.jsx("span",{children:a("common.loading")})]}):e.jsx("span",{children:s.price===0?a("courses.startCourse",{defaultValue:"Пройти курс"}):a("courses.requestAccess",{defaultValue:"Запросить доступ к курсу"})})}),s.studentCourseStatus==="PENDING"&&e.jsxs("div",{className:"text-neutral-600",children:[e.jsx("p",{className:"font-medium mb-2",children:a("courses.requestPending",{defaultValue:"Запрос ожидает одобрения"})}),e.jsx("p",{className:"text-sm",children:a("courses.requestPendingDescription",{defaultValue:"Вы получите уведомление, когда доступ будет предоставлен"})})]})]})})]})]}),e.jsx(ge,{isOpen:u,onClose:()=>c(!1),onConfirm:te,courseTitle:s.title,coursePrice:s.price,teacherTelegram:s.teacher?.telegram,isLoading:V.isLoading}),e.jsx(ve,{isOpen:h,onClose:()=>g(!1),courseId:s.id,courseTitle:s.title,prices:{price30Days:s.price30Days,price3Months:s.price3Months,price6Months:s.price6Months,price1Year:s.price1Year},currentEndDate:s.accessEndDate})]})}export{De as default};
