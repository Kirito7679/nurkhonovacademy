import{ac as ne,u as le,f as ie,r as b,h as L,k as j,V as T,j as e,am as ce,U as de,au as oe,a8 as me,v as V,$ as y,al as Q,av as xe,T as F,at as ue,X as pe}from"./vendor-react-BKQy8cua.js";import{t as G,o as J,s as w}from"./vendor-forms-BFjCwuAU.js";import{a as i}from"./index-B1iTD4yI.js";import"./vendor-other-Bzl34R3H.js";import"./vendor-network-CoR7wtyb.js";import"./vendor-i18n-DHwuzpMN.js";import"./vendor-state-BcnB54Y8.js";const he=J({newPassword:w().min(6,"Пароль должен содержать минимум 6 символов")}),fe=J({accessStartDate:w().optional(),accessEndDate:w().optional()}).refine(t=>t.accessEndDate&&t.accessStartDate?new Date(t.accessEndDate)>=new Date(t.accessStartDate):!0,{message:"Дата окончания не может быть раньше даты начала",path:["accessEndDate"]});function Ee(){var P,I,O,$,A,M,R;const{id:t}=ne(),U=le(),x=ie(),[X,c]=b.useState(!1),[u,d]=b.useState(null),[be,q]=b.useState({isOpen:!1,message:""}),[je,n]=b.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}}),{data:z,isLoading:B}=L(["student",t],async()=>(await i.get(`/students/${t}`)).data.data),{data:K}=L("allCourses",async()=>(await i.get("/courses")).data.data||[]),N=j(async({courseId:s,action:r})=>(await i.put(`/students/${t}/courses/${s}`,{action:r})).data,{onSuccess:()=>{x.invalidateQueries(["student",t])}}),l=j(async({courseId:s,data:r})=>(await i.post(`/students/${t}/courses/${s}`,r)).data,{onSuccess:()=>{x.invalidateQueries(["student",t]),c(!1),d(null),m()}}),D=j(async s=>(await i.delete(`/students/${t}/courses/${s}`)).data,{onSuccess:()=>{x.invalidateQueries(["student",t])}}),o=j(async s=>(await i.put(`/students/${t}/reset-password`,s)).data,{onSuccess:()=>{x.invalidateQueries(["student",t])}}),{register:H,handleSubmit:W,formState:{errors:C},reset:Y}=T({resolver:G(he),defaultValues:{newPassword:""}}),{register:E,handleSubmit:Z,formState:{errors:p},reset:m,watch:_}=T({resolver:G(fe),defaultValues:{accessStartDate:"",accessEndDate:""}}),S=_("accessEndDate"),k=!!S&&S.trim()!=="";if(B)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block relative",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-primary-200 border-t-primary-500"})}),e.jsx("p",{className:"mt-4 text-neutral-600",children:"Загрузка студента..."})]});const a=z;if(!a)return e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-neutral-600",children:"Студент не найден"})});const g=(a==null?void 0:a.studentCourses)||[],ee=K||[],se=g.map(s=>s.courseId),v=ee.filter(s=>!se.includes(s.id)),te=s=>{o.mutate(s,{onSuccess:()=>{Y(),q({isOpen:!0,message:"Пароль успешно изменен"})}})},ae=s=>{u&&l.mutate({courseId:u,data:{accessStartDate:s.accessStartDate||void 0,accessEndDate:s.accessEndDate||void 0}})},re=s=>{d(s),c(!0)},h=s=>s?new Date(s).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}):null;return e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>U("/teacher/students"),className:"flex items-center text-neutral-600 hover:text-primary-600 mb-6 transition-colors animate-slide-in",children:[e.jsx(ce,{className:"h-5 w-5 mr-2"}),"Назад к студентам"]}),e.jsx("div",{className:"relative mb-8 animate-fade-scale",children:e.jsxs("h1",{className:"text-xl md:text-2xl lg:text-4xl font-bold text-gradient break-words",children:[a.firstName," ",a.lastName]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6",children:[e.jsxs("div",{className:"lg:col-span-1",children:[e.jsx("div",{className:"card p-6 mb-6 animate-fade-scale",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("div",{className:"flex items-center justify-center w-24 h-24 rounded-full bg-gradient-primary text-white mb-4 animate-pulse-glow",children:e.jsx(de,{className:"h-12 w-12"})}),e.jsxs("h2",{className:"text-2xl font-bold text-neutral-900 mb-2",children:[a.firstName," ",a.lastName]}),e.jsxs("p",{className:"text-neutral-600",children:["Телефон: ",a.phone]}),a.email&&e.jsxs("p",{className:"text-neutral-600",children:["Email: ",a.email]})]})}),e.jsxs("div",{className:"card p-6 animate-fade-scale",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(oe,{className:"h-6 w-6 text-primary-500 mr-3"}),e.jsx("h2",{className:"text-xl font-semibold text-neutral-900",children:"Сбросить пароль"})]}),e.jsxs("form",{onSubmit:W(te),className:"space-y-4",children:[e.jsxs("div",{className:"animate-slide-in",style:{animationDelay:"0.1s"},children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Новый пароль"}),e.jsx("input",{...H("newPassword"),type:"password",className:"input-field",placeholder:"Введите новый пароль"}),C.newPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:C.newPassword.message})]}),o.error&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm",children:((O=(I=(P=o.error)==null?void 0:P.response)==null?void 0:I.data)==null?void 0:O.message)||"Ошибка при изменении пароля"}),e.jsx("div",{className:"animate-slide-in",style:{animationDelay:"0.2s"},children:e.jsxs("button",{type:"submit",disabled:o.isLoading,className:"btn-primary w-full disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(me,{className:"h-5 w-5 mr-2"}),o.isLoading?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"animate-spin",children:"⟳"}),e.jsx("span",{children:"Сброс..."})]}):"Сбросить пароль"]})})]})]})]}),e.jsxs("div",{className:"lg:col-span-2",children:[e.jsxs("div",{className:"card p-6 mb-6 animate-fade-scale",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(V,{className:"h-6 w-6 text-primary-500 mr-3"}),e.jsx("h2",{className:"text-xl font-semibold text-neutral-900",children:"Курсы студента"})]}),g.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-neutral-500",children:"Нет курсов"})}):e.jsx("div",{className:"space-y-3 mb-6",children:g.map((s,r)=>{var f;return e.jsxs("div",{className:"flex items-center justify-between p-4 border border-[#374151] rounded-lg hover:border-[#39ff14]/50 hover:bg-[#1f2937]/50 transition-all animate-slide-in",style:{animationDelay:`${.1*r}s`},children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-neutral-900 mb-1",children:(f=s.course)==null?void 0:f.title}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[s.status==="APPROVED"&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-mono bg-[#39ff14]/20 text-[#39ff14] border border-[#39ff14]/50",children:[e.jsx(y,{className:"h-3 w-3 mr-1"}),"APPROVED"]}),s.status==="PENDING"&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-mono bg-yellow-500/20 text-yellow-400 border border-yellow-500/50",children:"PENDING"}),s.status==="REJECTED"&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-mono bg-red-500/20 text-red-400 border border-red-500/50",children:[e.jsx(Q,{className:"h-3 w-3 mr-1"}),"REJECTED"]}),s.status==="APPROVED"&&(s.accessStartDate||s.accessEndDate)&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-mono bg-blue-500/20 text-blue-400 border border-blue-500/50",children:[e.jsx(xe,{className:"h-3 w-3 mr-1"}),s.accessStartDate&&s.accessEndDate?`${h(s.accessStartDate)} - ${h(s.accessEndDate)}`:s.accessStartDate?`с ${h(s.accessStartDate)}`:s.accessEndDate?`до ${h(s.accessEndDate)}`:"бессрочно"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[s.status==="PENDING"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>N.mutate({courseId:s.courseId,action:"approve"}),className:"p-2 text-[#39ff14] hover:bg-[#39ff14]/10 rounded-lg border border-[#39ff14]/50 hover:border-[#39ff14] transition-all",title:"Одобрить",children:e.jsx(y,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>N.mutate({courseId:s.courseId,action:"reject"}),className:"p-2 text-red-400 hover:bg-red-500/10 rounded-lg border border-red-500/50 hover:border-red-500 transition-all",title:"Отклонить",children:e.jsx(Q,{className:"h-5 w-5"})})]}),s.status==="APPROVED"&&e.jsx("button",{onClick:()=>{n({isOpen:!0,title:"Открепить курс",message:"Вы уверены, что хотите открепить этот курс от студента?",variant:"danger",onConfirm:()=>{D.mutate(s.courseId),n({isOpen:!1,title:"",message:"",onConfirm:()=>{}})}})},className:"p-2 text-red-400 hover:bg-red-500/10 rounded-lg border border-red-500/50 hover:border-red-500 transition-all",title:"Открепить курс",children:e.jsx(F,{className:"h-5 w-5"})}),s.status==="REJECTED"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{n({isOpen:!0,title:"Одобрить курс",message:"Одобрить этот курс для студента?",variant:"info",onConfirm:()=>{N.mutate({courseId:s.courseId,action:"approve"}),n({isOpen:!1,title:"",message:"",onConfirm:()=>{}})}})},className:"p-2 text-[#39ff14] hover:bg-[#39ff14]/10 rounded-lg border border-[#39ff14]/50 hover:border-[#39ff14] transition-all",title:"Одобрить курс",children:e.jsx(y,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>{n({isOpen:!0,title:"Удалить курс",message:"Вы уверены, что хотите удалить этот отклоненный курс из списка?",variant:"danger",onConfirm:()=>{D.mutate(s.courseId),n({isOpen:!1,title:"",message:"",onConfirm:()=>{}})}})},className:"p-2 text-red-400 hover:bg-red-500/10 rounded-lg border border-red-500/50 hover:border-red-500 transition-all",title:"Удалить из списка",children:e.jsx(F,{className:"h-5 w-5"})})]})]})]},s.id)})})]}),v.length>0&&e.jsxs("div",{className:"card p-6 animate-fade-scale",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(ue,{className:"h-6 w-6 text-primary-500 mr-3"}),e.jsx("h3",{className:"text-lg font-semibold text-neutral-900",children:"Назначить курс"})]}),e.jsx("div",{className:"space-y-2",children:v.map((s,r)=>e.jsxs("button",{onClick:()=>re(s.id),disabled:l.isLoading,className:"w-full flex items-center justify-between p-4 border border-[#374151] rounded-lg hover:border-[#39ff14]/50 hover:bg-[#1f2937]/50 text-left transition-all animate-slide-in group",style:{animationDelay:`${.1*r}s`},children:[e.jsx("span",{className:"font-medium text-neutral-900 group-hover:text-primary-600 transition-colors",children:s.title}),e.jsx(V,{className:"h-5 w-5 text-neutral-400 group-hover:text-primary-500 transition-colors"})]},s.id))})]})]})]}),X&&u&&e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 transition-opacity bg-black/75",onClick:()=>{c(!1),d(null),m()}}),e.jsx("div",{className:"inline-block align-bottom bg-[#111827] rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full border border-[#39ff14]/50 neon-border",children:e.jsxs("div",{className:"bg-[#111827] px-6 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gradient",children:"Назначить курс"}),e.jsx("button",{onClick:()=>{c(!1),d(null),m()},className:"text-gray-400 hover:text-[#39ff14] transition-colors",children:e.jsx(pe,{className:"h-6 w-6"})})]}),e.jsxs("form",{onSubmit:Z(ae),className:"space-y-4",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-neutral-700 mb-4",children:["Курс: ",e.jsx("span",{className:"text-primary-600 font-semibold",children:($=v.find(s=>s.id===u))==null?void 0:$.title})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Тип доступа"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{children:e.jsxs("label",{className:"flex items-center text-neutral-700 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:!!k,onChange:s=>{s.target.checked||m({accessStartDate:"",accessEndDate:""})},className:"mr-2 w-4 h-4 text-primary-500 bg-white border-neutral-300 rounded focus:ring-primary-500"}),e.jsx("span",{children:"Установить срок доступа"})]})}),k&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Дата начала доступа"}),e.jsx("input",{...E("accessStartDate"),type:"date",className:"input-field"}),p.accessStartDate&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:p.accessStartDate.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Дата окончания доступа"}),e.jsx("input",{...E("accessEndDate"),type:"date",className:"input-field"}),p.accessEndDate&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:p.accessEndDate.message})]})]})]})]}),l.error&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm",children:((R=(M=(A=l.error)==null?void 0:A.response)==null?void 0:M.data)==null?void 0:R.message)||"Ошибка при прикреплении курса"}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{c(!1),d(null),m()},className:"btn-secondary flex-1",children:"Отмена"}),e.jsx("button",{type:"submit",disabled:l.isLoading,className:"btn-primary flex-1 disabled:opacity-50 disabled:cursor-not-allowed",children:l.isLoading?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"animate-spin",children:"⟳"}),e.jsx("span",{children:"Назначение..."})]}):"Назначить"})]})]})]})})]})})]})}export{Ee as default};
