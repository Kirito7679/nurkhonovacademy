import{k as V,e as i,j as e,au as K,t as T,s as G,M as E,a6 as M,a4 as I,ag as O,ay as r,az as B,aA as N,aB as v,aC as w,aD as c,aE as g,aF as _,aG as D,aH as C,aI as S,aJ as k,aK as L,G as F,aL as U,aM as W,aN as q}from"./vendor-AHBWVCc0.js";import{a as n}from"./index-FtXy3uCz.js";function J(){const{t:a}=V(),{data:$,isLoading:R,error:f}=i("teacherStatistics",async()=>(await n.get("/statistics/teacher")).data,{staleTime:1*60*1e3,cacheTime:3*60*1e3,refetchInterval:5*60*1e3}),{data:u}=i("newUsersGrowth",async()=>(await n.get("/statistics/new-users-growth?days=30")).data,{staleTime:2*60*1e3,cacheTime:5*60*1e3}),{data:m}=i("deviceStatistics",async()=>(await n.get("/statistics/device-statistics")).data,{staleTime:2*60*1e3,cacheTime:5*60*1e3}),{data:o}=i("activeStudents",async()=>(await n.get("/statistics/active-students?days=30")).data,{staleTime:2*60*1e3,cacheTime:5*60*1e3}),{data:h}=i("locationStatistics",async()=>(await n.get("/statistics/location-statistics?type=country&action=all")).data,{staleTime:2*60*1e3,cacheTime:5*60*1e3}),{data:p}=i("loginLocationStatistics",async()=>(await n.get("/statistics/location-statistics?type=country&action=LOGIN")).data,{staleTime:2*60*1e3,cacheTime:5*60*1e3}),{data:b}=i("registerLocationStatistics",async()=>(await n.get("/statistics/location-statistics?type=country&action=CREATE")).data,{staleTime:2*60*1e3,cacheTime:5*60*1e3}),{data:x}=i("studentsByCountry",async()=>(await n.get("/statistics/students-by-country")).data,{staleTime:2*60*1e3,cacheTime:5*60*1e3}),l=$?.data,j=["#3b82f6","#10b981","#f59e0b","#6b7280"];return f?(console.error("Statistics error:",f),e.jsx("div",{className:"text-center py-12",children:e.jsx("div",{className:"text-red-600",children:f?.response?.data?.message||a("errors.somethingWentWrong")})})):R?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block relative",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-primary-200 border-t-primary-500"})}),e.jsx("p",{className:"mt-4 text-neutral-600",children:a("common.loading")})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8",children:[e.jsx("h1",{className:"text-2xl md:text-3xl lg:text-5xl font-bold text-gradient",children:a("statistics.title")}),e.jsxs("button",{onClick:()=>{const t=localStorage.getItem("token");window.open(`/api/export/course-statistics?token=${t}`,"_blank")},className:"btn-secondary inline-flex items-center",children:[e.jsx(K,{className:"h-5 w-5 mr-2"}),e.jsx("span",{children:"Экспорт"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12",children:[e.jsxs("div",{className:"card p-6 animate-fade-scale bg-gradient-to-br from-primary-50 to-blue-50",style:{animationDelay:"0.1s"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-primary-900",children:a("courses.totalCourses",{defaultValue:"Всего курсов"})}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-primary flex items-center justify-center shadow-glow",children:e.jsx(T,{className:"h-6 w-6 text-white"})})]}),e.jsx("p",{className:"text-2xl md:text-3xl lg:text-4xl font-bold text-primary-900",children:l?.overview.totalCourses||0})]}),e.jsxs("div",{className:"card p-6 animate-fade-scale bg-gradient-to-br from-accent-50 to-emerald-50",style:{animationDelay:"0.2s"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-accent-900",children:a("students.totalStudents",{defaultValue:"Всего студентов"})}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-accent flex items-center justify-center shadow-glow",children:e.jsx(G,{className:"h-6 w-6 text-white"})})]}),e.jsx("p",{className:"text-2xl md:text-3xl lg:text-4xl font-bold text-accent-900",children:l?.overview.totalStudents||0})]}),e.jsxs("div",{className:"card p-6 animate-fade-scale bg-gradient-to-br from-education-50 to-purple-50",style:{animationDelay:"0.3s"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-education-900",children:a("statistics.totalLessons",{defaultValue:"Всего уроков"})}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-education flex items-center justify-center shadow-glow",children:e.jsx(T,{className:"h-6 w-6 text-white"})})]}),e.jsx("p",{className:"text-2xl md:text-3xl lg:text-4xl font-bold text-education-900",children:l?.overview.totalLessons||0})]}),e.jsxs("div",{className:"card p-6 animate-fade-scale bg-gradient-to-br from-primary-50 to-indigo-50",style:{animationDelay:"0.4s"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-primary-900",children:a("statistics.totalComments",{defaultValue:"Всего комментариев"})}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-primary flex items-center justify-center shadow-glow",children:e.jsx(E,{className:"h-6 w-6 text-white"})})]}),e.jsx("p",{className:"text-2xl md:text-3xl lg:text-4xl font-bold text-primary-900",children:l?.overview.totalComments||0})]}),e.jsxs("div",{className:"card p-6 animate-fade-scale bg-gradient-to-br from-yellow-50 to-amber-50",style:{animationDelay:"0.5s"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-yellow-900",children:a("statistics.recentComments",{defaultValue:"Недавние комментарии"})}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-yellow-500 to-amber-500 flex items-center justify-center shadow-glow",children:e.jsx(M,{className:"h-6 w-6 text-white"})})]}),e.jsx("p",{className:"text-2xl md:text-3xl lg:text-4xl font-bold text-yellow-900",children:l?.overview.recentComments||0}),e.jsx("p",{className:"text-xs text-yellow-700 mt-2 font-medium",children:a("statistics.last7Days",{defaultValue:"За последние 7 дней"})})]}),e.jsxs("div",{className:"card p-6 animate-fade-scale bg-gradient-to-br from-orange-50 to-red-50",style:{animationDelay:"0.6s"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-orange-900",children:a("statistics.courseRequests",{defaultValue:"Запросы на курсы"})}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-orange-500 to-red-500 flex items-center justify-center shadow-glow",children:e.jsx(I,{className:"h-6 w-6 text-white"})})]}),e.jsx("p",{className:"text-2xl md:text-3xl lg:text-4xl font-bold text-orange-900",children:l?.overview.recentCourseRequests||0}),e.jsx("p",{className:"text-xs text-orange-700 mt-2 font-medium",children:a("statistics.last7Days",{defaultValue:"За последние 7 дней"})})]})]}),l?.courseStats&&l.courseStats.length>0&&e.jsxs("div",{className:"card p-6 mb-12 animate-fade-scale",style:{animationDelay:"0.7s"},children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gradient mb-4 md:mb-6",children:a("statistics.byCourses",{defaultValue:"Статистика по курсам"})}),e.jsx("div",{className:"space-y-3 md:space-y-4",children:l.courseStats.map((t,s)=>e.jsxs("div",{className:"border border-neutral-200 rounded-lg p-4 bg-neutral-50 animate-slide-in",style:{animationDelay:`${.1*s}s`},children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-2 mb-3",children:[e.jsx("h3",{className:"text-base md:text-lg font-semibold text-neutral-900 break-words",children:t.title}),e.jsxs("div",{className:"text-left sm:text-right",children:[e.jsxs("div",{className:"text-xl md:text-2xl font-bold text-gradient",children:[t.completionRate,"%"]}),e.jsx("div",{className:"text-xs text-neutral-500",children:a("lessons.completed")})]})]}),e.jsx("div",{className:"w-full bg-neutral-200 rounded-full h-2 md:h-2.5 mb-3",children:e.jsx("div",{className:"bg-gradient-primary h-2 md:h-2.5 rounded-full transition-all",style:{width:`${t.completionRate}%`}})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 md:gap-6 text-xs md:text-sm text-neutral-600",children:[e.jsxs("span",{children:[e.jsxs("span",{className:"font-medium",children:[a("students.title"),":"]})," ",t.students]}),e.jsxs("span",{children:[e.jsxs("span",{className:"font-medium",children:[a("lessons.title"),":"]})," ",t.lessons]}),e.jsxs("span",{children:[e.jsxs("span",{className:"font-medium",children:[a("comments.title"),":"]})," ",t.comments]})]})]},t.id))})]}),l?.topStudents&&l.topStudents.length>0&&e.jsxs("div",{className:"card p-6 animate-fade-scale",style:{animationDelay:"0.8s"},children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gradient mb-4 md:mb-6",children:a("statistics.topStudents",{defaultValue:"Топ студентов"})}),e.jsx("div",{className:"space-y-2 md:space-y-3",children:l.topStudents.map((t,s)=>e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-0 p-3 md:p-4 border border-neutral-200 rounded-lg bg-neutral-50 animate-slide-in",style:{animationDelay:`${.05*s}s`},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-gradient-primary text-white font-bold shadow-soft",children:s+1}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-neutral-900",children:[t.student.firstName," ",t.student.lastName]}),e.jsxs("p",{className:"text-xs text-neutral-500",children:[e.jsxs("span",{className:"font-medium",children:[a("lessons.completed"),":"]})," ",t.completed," / ",t.total]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 md:gap-4",children:[e.jsxs("div",{className:"text-left sm:text-right",children:[e.jsxs("div",{className:"text-lg md:text-xl font-bold text-gradient",children:[t.completionRate,"%"]}),e.jsx("div",{className:"text-xs text-neutral-500",children:a("dashboard.overallProgress",{defaultValue:"Прогресс"})})]}),s<3&&e.jsx(O,{className:`h-6 w-6 ${s===0?"text-yellow-500":s===1?"text-neutral-400":"text-orange-500"}`})]})]},t.student.id))})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-12",children:[e.jsxs("div",{className:"card p-6 animate-fade-scale",style:{animationDelay:"0.9s"},children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gradient mb-6",children:"Рост новых пользователей"}),u?.data&&u.data.length>0?e.jsx(r,{width:"100%",height:300,children:e.jsxs(B,{data:u.data,children:[e.jsx(N,{strokeDasharray:"3 3"}),e.jsx(v,{dataKey:"date",tick:{fontSize:12},angle:-45,textAnchor:"end",height:80}),e.jsx(w,{tick:{fontSize:12}}),e.jsx(c,{labelFormatter:t=>`Дата: ${t}`,formatter:t=>[t,"Новых пользователей"]}),e.jsx(g,{}),e.jsx(_,{type:"monotone",dataKey:"count",stroke:"#3b82f6",strokeWidth:2,name:"Новых пользователей",dot:{fill:"#3b82f6",r:4}})]})}):e.jsx("div",{className:"text-center py-12 text-neutral-500",children:"Нет данных для отображения"})]}),e.jsxs("div",{className:"card p-6 animate-fade-scale",style:{animationDelay:"1s"},children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gradient mb-6",children:"Устройства пользователей"}),m?.data&&m.data.length>0?e.jsx(r,{width:"100%",height:300,children:e.jsxs(D,{children:[e.jsx(C,{data:m.data,cx:"50%",cy:"50%",labelLine:!1,label:({name:t,percent:s})=>`${t}: ${((s||0)*100).toFixed(0)}%`,outerRadius:100,fill:"#8884d8",dataKey:"value",children:m.data.map((t,s)=>e.jsx(S,{fill:j[s%j.length]},`cell-${s}`))}),e.jsx(c,{formatter:t=>[t,"Пользователей"]}),e.jsx(g,{})]})}):e.jsx("div",{className:"text-center py-12 text-neutral-500",children:"Нет данных для отображения"})]})]}),e.jsxs("div",{className:"card p-6 animate-fade-scale mb-12",style:{animationDelay:"1.1s"},children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gradient mb-6",children:"Активность студентов"}),o?.data&&o.data.length>0?e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(r,{width:"100%",height:300,children:e.jsxs(D,{children:[e.jsx(C,{data:o.data,cx:"50%",cy:"50%",labelLine:!1,label:({name:t,percent:s})=>`${t}: ${((s||0)*100).toFixed(0)}%`,outerRadius:100,fill:"#8884d8",dataKey:"value",children:o.data.map((t,s)=>e.jsx(S,{fill:t.name==="Активные"?"#10b981":"#ef4444"},`cell-${s}`))}),e.jsx(c,{formatter:t=>[t,"Студентов"]}),e.jsx(g,{})]})}),e.jsx("div",{className:"flex flex-col justify-center space-y-4",children:o.data.map((t,s)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-neutral-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:t.name==="Активные"?"#10b981":"#ef4444"}}),e.jsx("span",{className:"font-semibold text-neutral-900",children:t.name})]}),e.jsx("span",{className:"text-2xl font-bold text-gradient",children:t.value})]},s))})]}):e.jsx("div",{className:"text-center py-12 text-neutral-500",children:"Нет данных для отображения"})]}),e.jsxs("div",{className:"card p-6 animate-fade-scale mb-12",style:{animationDelay:"1.2s"},children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gradient mb-6",children:"Статистика по локациям"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-neutral-900",children:"Все активности по странам"}),h?.data&&h.data.length>0?e.jsx(r,{width:"100%",height:300,children:e.jsxs(D,{children:[e.jsx(C,{data:h.data,cx:"50%",cy:"50%",labelLine:!1,label:({name:t,percent:s})=>`${t}: ${((s||0)*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:h.data.map((t,s)=>e.jsx(S,{fill:j[s%j.length]},`cell-${s}`))}),e.jsx(c,{formatter:t=>[t,"Активностей"]}),e.jsx(g,{})]})}):e.jsx("div",{className:"text-center py-12 text-neutral-500",children:"Нет данных для отображения"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-neutral-900",children:"Входы по странам"}),p?.data&&p.data.length>0?e.jsx(r,{width:"100%",height:300,children:e.jsxs(k,{data:p.data,children:[e.jsx(N,{strokeDasharray:"3 3"}),e.jsx(v,{dataKey:"name",angle:-45,textAnchor:"end",height:80}),e.jsx(w,{}),e.jsx(c,{formatter:t=>[t,"Входов"]}),e.jsx(L,{dataKey:"value",fill:"#3b82f6"})]})}):e.jsx("div",{className:"text-center py-12 text-neutral-500",children:"Нет данных для отображения"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-neutral-900",children:"Регистрации по странам"}),b?.data&&b.data.length>0?e.jsx(r,{width:"100%",height:300,children:e.jsxs(k,{data:b.data,children:[e.jsx(N,{strokeDasharray:"3 3"}),e.jsx(v,{dataKey:"name",angle:-45,textAnchor:"end",height:80}),e.jsx(w,{}),e.jsx(c,{formatter:t=>[t,"Регистраций"]}),e.jsx(L,{dataKey:"value",fill:"#10b981"})]})}):e.jsx("div",{className:"text-center py-12 text-neutral-500",children:"Нет данных для отображения"})]})]})]}),e.jsxs("div",{className:"card p-6 animate-fade-scale mb-12",style:{animationDelay:"1.3s"},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(F,{className:"h-6 w-6 text-primary-600"}),e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gradient",children:"Распределение студентов по странам"})]}),x?.data&&x.data.length>0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-neutral-50 rounded-lg p-4 border border-neutral-200",children:e.jsx(U,{projectionConfig:{scale:147,center:[0,20]},style:{width:"100%",height:"500px"},children:e.jsx(W,{geography:"https://cdn.jsdelivr.net/npm/world-atlas@3/countries-110m.json",children:({geographies:t})=>t.map(s=>{const y=x.data.find(d=>d.code===s.properties.ISO_A2||d.code===s.properties.ISO_A3||d.name===s.properties.NAME||d.name===s.properties.NAME_LONG)?.value||0,A=y>0?`rgba(59, 130, 246, ${Math.min(.3+y/Math.max(...x.data.map(d=>d.value))*.7,1)})`:"#e5e7eb";return e.jsx(q,{geography:s,fill:A,stroke:"#94a3b8",strokeWidth:.5,style:{default:{outline:"none"},hover:{outline:"none",fill:y>0?"#3b82f6":"#cbd5e1",cursor:"pointer"},pressed:{outline:"none"}}},s.rsmKey)})})})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:x.data.sort((t,s)=>s.value-t.value).map((t,s)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gradient-to-r from-primary-50 to-indigo-50 rounded-lg border border-primary-200 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-primary flex items-center justify-center text-white font-bold shadow-soft",children:s+1}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-neutral-900",children:t.name}),e.jsxs("div",{className:"text-xs text-neutral-500",children:["Код: ",t.code]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-gradient",children:t.value}),e.jsx("div",{className:"text-xs text-neutral-500",children:"студентов"})]})]},t.code||t.name))})]}):e.jsx("div",{className:"text-center py-12 text-neutral-500",children:"Нет данных для отображения"})]})]})}export{J as default};
