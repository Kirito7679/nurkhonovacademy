import{r as d,e as j,f as v,j as e,X as C,C as k,h as L,k as S,s as f,D as N,a2 as V,a3 as D,a4 as A,L as w}from"./vendor-DS3OdKc2.js";import{a as x,u as P}from"./index-dPFm3pqh.js";import{B as T}from"./Banner--J5ElPR1.js";import{g as b,a as I,b as U}from"./courseUtils-Bo8LqfoL.js";const z=d.memo(function(){const[y,h]=d.useState(0),[u,c]=d.useState(!1),[a,m]=d.useState(0),{data:n}=j("stories",async()=>(await x.get("/stories")).data.data||[],{staleTime:10*60*1e3,cacheTime:30*60*1e3,refetchOnWindowFocus:!1}),l=v(async i=>{await x.post(`/stories/${i}/view`)}),t=n||[];d.useEffect(()=>{if(t.length===0)return;const i=setInterval(()=>{h(p=>(p+1)%t.length)},5e3);return()=>clearInterval(i)},[t.length]);const s=i=>{m(i),c(!0),t[i]&&l.mutate(t[i].id)},o=()=>{a<t.length-1&&(m(a+1),l.mutate(t[a+1].id))},g=()=>{a>0&&(m(a-1),l.mutate(t[a-1].id))};return t.length===0?null:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex gap-3 overflow-x-auto pb-2 scrollbar-hide",children:t.map((i,p)=>e.jsx("div",{onClick:()=>s(p),className:"flex-shrink-0 w-20 h-20 rounded-full overflow-hidden cursor-pointer border-2 border-primary-300 hover:border-primary-500 transition-all",children:e.jsx("img",{src:i.imageUrl,alt:i.title||"Story",className:"w-full h-full object-cover"})},i.id))}),u&&t[a]&&e.jsxs("div",{className:"fixed inset-0 bg-black z-50 flex items-center justify-center",children:[e.jsx("button",{onClick:()=>c(!1),className:"absolute top-4 right-4 text-white hover:text-gray-300 z-10",children:e.jsx(C,{className:"h-6 w-6"})}),a>0&&e.jsx("button",{onClick:g,className:"absolute left-4 text-white hover:text-gray-300 z-10",children:e.jsx(k,{className:"h-8 w-8"})}),a<t.length-1&&e.jsx("button",{onClick:o,className:"absolute right-4 text-white hover:text-gray-300 z-10",children:e.jsx(L,{className:"h-8 w-8"})}),e.jsxs("div",{className:"max-w-md w-full mx-4",children:[t[a].videoUrl?e.jsx("video",{src:t[a].videoUrl,autoPlay:!0,loop:!0,className:"w-full h-auto rounded-lg"}):e.jsx("img",{src:t[a].imageUrl,alt:t[a].title||"Story",className:"w-full h-auto rounded-lg"}),t[a].title&&e.jsx("p",{className:"text-white text-center mt-4",children:t[a].title})]})]})]})});function F(){const{t:r}=S(),{user:y}=P(),{data:h,isLoading:u}=j("myCourses",async()=>(await x.get("/courses")).data.data||[],{staleTime:5*60*1e3,cacheTime:10*60*1e3,refetchOnWindowFocus:!1}),{data:c,isLoading:a}=j("myStats",async()=>(await x.get("/auth/me/stats")).data.data,{staleTime:2*60*1e3,cacheTime:5*60*1e3,refetchOnWindowFocus:!1}),n=(h||[]).filter(s=>s.hasAccess),l=c||{totalCourses:0,totalLessons:0,completedLessons:0,inProgressLessons:0,overallProgress:0,recentActivity:[]},t=()=>{const s=new Date().getHours();return s<12?r("dashboard.goodMorning",{defaultValue:"Доброе утро"}):s<18?r("dashboard.goodAfternoon",{defaultValue:"Добрый день"}):r("dashboard.goodEvening",{defaultValue:"Добрый вечер"})};return e.jsxs("div",{children:[e.jsx(T,{position:"TOP"}),e.jsx("div",{className:"mb-6",children:e.jsx(z,{})}),e.jsxs("div",{className:"mb-8 animate-slide-in",children:[e.jsxs("h1",{className:"text-2xl md:text-4xl lg:text-5xl font-bold text-gradient mb-2",children:[t(),", ",y?.firstName,"!"]}),e.jsx("p",{className:"text-primary-700 text-sm md:text-base lg:text-lg font-medium",children:r("dashboard.welcome")})]}),!a&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6 mb-6 md:mb-8",children:[e.jsx("div",{className:"card p-6 animate-fade-scale bg-gradient-to-br from-primary-50 to-blue-50",style:{animationDelay:"0.1s"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-primary-700 text-sm mb-1 font-semibold",children:r("dashboard.totalCourses",{defaultValue:"Всего курсов"})}),e.jsx("p",{className:"text-2xl md:text-3xl font-bold text-primary-900",children:l.totalCourses})]}),e.jsx("div",{className:"w-14 h-14 rounded-xl bg-gradient-primary flex items-center justify-center shadow-glow",children:e.jsx(f,{className:"h-7 w-7 text-white"})})]})}),e.jsx("div",{className:"card p-6 animate-fade-scale bg-gradient-to-br from-accent-50 to-emerald-50",style:{animationDelay:"0.2s"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-accent-700 text-sm mb-1 font-semibold",children:r("dashboard.completedLessons",{defaultValue:"Завершено уроков"})}),e.jsxs("p",{className:"text-2xl md:text-3xl font-bold text-accent-900",children:[l.completedLessons,e.jsxs("span",{className:"text-accent-600 text-lg",children:["/",l.totalLessons]})]})]}),e.jsx("div",{className:"w-14 h-14 rounded-xl bg-gradient-accent flex items-center justify-center shadow-glow",children:e.jsx(N,{className:"h-7 w-7 text-white"})})]})}),e.jsxs("div",{className:"card p-6 animate-fade-scale bg-gradient-to-br from-education-50 to-purple-50",style:{animationDelay:"0.3s"},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-education-700 text-sm mb-1 font-semibold",children:r("dashboard.overallProgress",{defaultValue:"Общий прогресс"})}),e.jsxs("p",{className:"text-2xl md:text-3xl font-bold text-education-900",children:[l.overallProgress,e.jsx("span",{className:"text-education-600 text-lg",children:"%"})]})]}),e.jsx("div",{className:"w-14 h-14 rounded-xl bg-gradient-education flex items-center justify-center shadow-glow",children:e.jsx(V,{className:"h-7 w-7 text-white"})})]}),e.jsx("div",{className:"mt-4 w-full bg-primary-200 rounded-full h-3 overflow-hidden shadow-inner",children:e.jsx("div",{className:"bg-gradient-education h-full transition-all duration-500 shadow-sm",style:{width:`${l.overallProgress}%`}})})]}),e.jsx("div",{className:"card p-6 animate-fade-scale bg-gradient-to-br from-primary-50 to-indigo-50",style:{animationDelay:"0.4s"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-primary-700 text-sm mb-1 font-semibold",children:"В процессе"}),e.jsx("p",{className:"text-2xl md:text-3xl font-bold text-primary-900",children:l.inProgressLessons})]}),e.jsx("div",{className:"w-14 h-14 rounded-xl bg-gradient-primary flex items-center justify-center shadow-glow",children:e.jsx(D,{className:"h-7 w-7 text-white"})})]})})]}),!a&&l.recentActivity.length>0&&e.jsxs("div",{className:"card p-6 mb-8 animate-fade-scale",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(A,{className:"h-6 w-6 text-primary-600 mr-3"}),e.jsx("h2",{className:"text-lg md:text-xl lg:text-2xl font-bold text-primary-900",children:r("dashboard.recentActivity")})]}),e.jsx("div",{className:"space-y-3",children:l.recentActivity.map((s,o)=>e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3 sm:gap-4 p-3 md:p-4 bg-gradient-to-r from-primary-50/50 to-transparent rounded-lg border-2 border-primary-200 hover:border-primary-400 transition-all animate-slide-in",style:{animationDelay:`${.1*o}s`},children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-accent flex items-center justify-center flex-shrink-0 shadow-glow",children:e.jsx(N,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-primary-900 font-semibold break-words text-sm md:text-base",children:s.lesson.title}),e.jsx("p",{className:"text-primary-700 text-xs md:text-sm break-words",children:s.lesson.course.title})]}),s.watchedAt&&e.jsx("div",{className:"text-primary-600 text-xs font-medium bg-primary-100 px-2 py-1 rounded",children:new Date(s.watchedAt).toLocaleDateString("ru-RU")})]},s.id))})]}),e.jsxs("div",{className:"relative mb-8 animate-slide-in",children:[e.jsx("h2",{className:"text-xl md:text-2xl lg:text-3xl font-bold text-gradient mb-2",children:r("courses.myCourses")}),e.jsxs("div",{className:"absolute top-0 right-0 text-xs text-primary-700 font-semibold bg-primary-100 px-2 py-1 rounded",children:[n.length," ",r("courses.coursesCount",{count:n.length,defaultValue:n.length===1?"курс":"курсов"})]})]}),u?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block relative",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-primary-300 border-t-primary-600"})}),e.jsx("p",{className:"mt-4 text-primary-700 font-medium",children:"Загрузка курсов..."})]}):n.length===0?e.jsxs("div",{className:"text-center py-12 animate-fade-scale",children:[e.jsx(f,{className:"mx-auto h-16 w-16 text-primary-300 mb-4"}),e.jsx("p",{className:"text-primary-700 mb-4 text-lg font-semibold",children:r("courses.noAccess",{defaultValue:"У вас пока нет доступа к курсам"})}),e.jsx(w,{to:"/courses",className:"btn-primary inline-flex items-center",children:r("courses.allCourses")})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:n.map((s,o)=>e.jsxs(w,{to:`/courses/${s.id}`,className:"card card-hover overflow-hidden group animate-fade-scale",style:{animationDelay:`${.1*o}s`},children:[s.thumbnailUrl&&e.jsxs("div",{className:"relative overflow-hidden",children:[e.jsx("img",{src:s.thumbnailUrl,alt:s.title,loading:"lazy",className:"w-full h-48 object-cover group-hover:scale-110 transition-transform duration-500",onError:g=>{g.target.style.display="none"}}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-primary-900/40 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),e.jsxs("div",{className:"absolute top-2 left-2 flex flex-wrap gap-2 z-10",children:[b(s.language)&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-white/90 backdrop-blur-sm border border-white/20 shadow-sm",children:[e.jsx("span",{className:"mr-1",children:b(s.language).flag}),e.jsx("span",{children:b(s.language).label})]}),s.category&&e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-md text-xs font-medium border ${U(s.category)} backdrop-blur-sm shadow-sm`,children:I(s.category)})]})]}),e.jsxs("div",{className:"p-4 md:p-6",children:[e.jsx("h3",{className:"text-lg md:text-xl font-semibold text-primary-900 mb-3 group-hover:text-primary-700 transition-colors break-words",children:s.title}),e.jsxs("div",{className:"flex items-center text-sm text-primary-600 font-medium",children:[e.jsx(f,{className:"h-4 w-4 mr-2 text-primary-500"}),e.jsxs("span",{children:[s._count?.lessons||0," ",r("lessons.lessonsCount",{count:s._count?.lessons||0,defaultValue:s._count?.lessons===1?"урок":"уроков"})]})]})]})]},s.id))})]})}export{F as default};
