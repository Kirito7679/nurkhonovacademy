import{k as C,ad as k,d as A,u as T,r as x,e as j,f as D,j as e,L as S,aN as P,ag as N,D as f,a4 as V,z as O}from"./vendor-DS3OdKc2.js";import{u as L,a as p}from"./index-BAsZs2-V.js";function Q(){const{t}=C(),{lessonId:r}=k();A();const g=T(),{user:l}=L(),[c,i]=x.useState(null),[d,o]=x.useState(""),[$,n]=x.useState(!1),{data:v,isLoading:w}=j(["practiceExercises",r],async()=>(await p.get(`/practice/lessons/${r}`)).data.data||[],{enabled:!!r}),{data:y}=j(["practiceResults",c?.id],async()=>c?(await p.get(`/practice/${c.id}/results`)).data.data||[]:[],{enabled:!!c&&l?.role==="STUDENT"}),m=D(async s=>(await p.post(`/practice/${s}/submit`,{answer:d})).data.data,{onSuccess:()=>{g.invalidateQueries(["practiceResults",c?.id]),n(!0),o("")}}),h=v||[],E=y||[],R=l?.role==="TEACHER"||l?.role==="ADMIN"||l?.role==="MODERATOR"||l?.role==="CURATOR";return w?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block relative",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-primary-200 border-t-primary-500"})}),e.jsx("p",{className:"mt-4 text-neutral-600",children:"Загрузка упражнений..."})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsx("h1",{className:"text-2xl md:text-3xl lg:text-5xl font-bold text-gradient",children:t("practice.title")}),R&&r&&e.jsxs(S,{to:`/lessons/${r}/practice/new`,className:"btn-primary",children:[e.jsx(P,{className:"h-5 w-5 mr-2"}),"Создать упражнение"]})]}),h.length===0?e.jsxs("div",{className:"text-center py-12 animate-fade-scale",children:[e.jsx(N,{className:"h-16 w-16 text-neutral-300 mx-auto mb-4"}),e.jsx("p",{className:"text-neutral-500",children:t("practice.noExercises")})]}):e.jsx("div",{className:"space-y-6",children:h.map(s=>{const a=E.find(u=>u.exerciseId===s.id),b=l?.role==="STUDENT"&&(!a||a.attemptNumber<s.maxAttempts);return e.jsxs("div",{className:"card p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-semibold text-neutral-900 mb-2",children:s.title}),s.description&&e.jsx("p",{className:"text-neutral-600 mb-4",children:s.description}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-neutral-500 mb-4",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(N,{className:"h-4 w-4"}),s.type]}),s.autoCheck&&e.jsxs("span",{className:"flex items-center gap-1 text-green-600",children:[e.jsx(f,{className:"h-4 w-4"}),"Автопроверка"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(V,{className:"h-4 w-4"}),t("practice.attempts"),": ",a?.attemptNumber||0,"/",s.maxAttempts]})]}),a&&e.jsxs("div",{className:`p-3 rounded-lg mb-4 ${a.status==="APPROVED"?"bg-green-50 border border-green-200":a.status==="REJECTED"?"bg-red-50 border border-red-200":"bg-yellow-50 border border-yellow-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.status==="APPROVED"?e.jsx(f,{className:"h-5 w-5 text-green-600"}):e.jsx(O,{className:"h-5 w-5 text-yellow-600"}),e.jsx("span",{className:"font-medium",children:a.status==="APPROVED"?t("practice.approved"):a.status==="REJECTED"?t("practice.rejected"):t("practice.pending")}),a.score!==null&&e.jsxs("span",{className:"ml-auto",children:[t("practice.score"),": ",a.score,"%"]})]}),a.feedback&&e.jsx("p",{className:"text-sm",children:a.feedback})]})]})}),c?.id===s.id?e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:t("practice.instructions")}),e.jsx("div",{className:"p-4 bg-neutral-50 rounded-lg",children:e.jsx("p",{className:"text-neutral-700 whitespace-pre-line",children:s.instructions})})]}),b&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:t("practice.yourAnswer")}),e.jsx("textarea",{value:d,onChange:u=>o(u.target.value),placeholder:t("practice.enterAnswer",{defaultValue:"Введите ваш ответ..."}),rows:6,className:"input-field"}),e.jsxs("div",{className:"flex gap-3 mt-4",children:[e.jsx("button",{onClick:()=>m.mutate(s.id),disabled:!d.trim()||m.isLoading,className:"btn-primary disabled:opacity-50",children:m.isLoading?t("common.loading"):t("practice.submit")}),e.jsx("button",{onClick:()=>{i(null),o(""),n(!1)},className:"btn-secondary",children:t("common.cancel")})]})]})]}):e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{i(s),n(!1)},className:"btn-primary",children:b?t("practice.execute",{defaultValue:"Выполнить"}):t("practice.view",{defaultValue:"Просмотреть"})}),a&&e.jsx("button",{onClick:()=>{i(s),n(!0)},className:"btn-secondary",children:t("practice.myResults",{defaultValue:"Мои результаты"})})]})]},s.id)})})]})}export{Q as default};
