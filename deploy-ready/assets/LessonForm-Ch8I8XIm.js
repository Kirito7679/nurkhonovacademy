import{k as pe,r as c,j as e,ac as tt,aO as De,z as st,Z as at,aq as te,X as _,aF as A,T as se,aJ as ue,ab as lt,aP as rt,u as it,d as nt,e as Q,f as k,H as ot,am as ct,aQ as Oe,q as dt,aR as mt,v as ut,P as pt,V as xt,W as Z,aL as ht,as as Ve}from"./vendor-react-B4b84SyH.js";import{a as b,C as ft}from"./index-D6PcLXw1.js";import{E as gt}from"./ErrorModal-BsuAe5nl.js";import{S as bt}from"./SuccessModal-D5rdaVaY.js";import{F as Se}from"./FileUploadProgress-Bee-_BeT.js";function jt({docUrl:s,title:m,width:r="100%",height:x="600px"}){const{t:j}=pe(),[h,l]=c.useState(!1),y=(N=>{const v=N.match(/\/d\/([a-zA-Z0-9-_]+)/);return v?`https://docs.google.com/document/d/${v[1]}/preview`:N})(s),w=()=>{window.open(s,"_blank")};return h?e.jsxs("div",{className:"card p-6 text-center",children:[e.jsx(tt,{className:"h-12 w-12 text-neutral-400 mx-auto mb-4"}),e.jsx("p",{className:"text-neutral-600 mb-4",children:j("integrations.failedToLoad",{defaultValue:"Не удалось загрузить документ"})}),e.jsxs("button",{onClick:w,className:"btn-secondary inline-flex items-center gap-2",children:[e.jsx(De,{className:"h-4 w-4"}),j("integrations.openInNewTab",{defaultValue:"Открыть в новой вкладке"})]})]}):e.jsxs("div",{className:"card p-4",children:[m&&e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-neutral-900",children:m}),e.jsx("button",{onClick:w,className:"text-primary-600 hover:text-primary-700 transition-colors",title:j("integrations.openInNewTab",{defaultValue:"Открыть в новой вкладке"}),children:e.jsx(De,{className:"h-5 w-5"})})]}),e.jsx("iframe",{src:y,width:r,height:x,className:"border-0 rounded-lg",onError:()=>l(!0),title:m||"Google Docs Document"})]})}function Nt({lessonId:s,onImportComplete:m}){const{t:r}=pe(),[x,j]=c.useState(""),[h,l]=c.useState(!1),[u,y]=c.useState(null),[w,N]=c.useState(!1),v=async()=>{var C,D;if(!x.trim()){y(r("integrations.enterQuizletUrl",{defaultValue:"Введите URL набора Quizlet"}));return}l(!0),y(null),N(!1);try{if(!x.match(/quizlet\.com\/([^\/]+)\/([^\/]+)/))throw new Error(r("integrations.invalidQuizletUrl",{defaultValue:"Неверный формат URL Quizlet"}));const I=await b.post("/api/flashcards/import-quizlet",{lessonId:s,quizletUrl:x});N(!0),m==null||m(I.data.data||[]),j("")}catch(p){y(((D=(C=p.response)==null?void 0:C.data)==null?void 0:D.message)||r("integrations.importError",{defaultValue:"Ошибка при импорте карточек"}))}finally{l(!1)}};return e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-900 mb-4",children:r("integrations.importFromQuizlet",{defaultValue:"Импорт из Quizlet"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:r("integrations.quizletSetUrl",{defaultValue:"URL набора Quizlet"})}),e.jsx("input",{type:"url",value:x,onChange:C=>j(C.target.value),placeholder:"https://quizlet.com/...",className:"input-field"}),e.jsx("p",{className:"text-xs text-neutral-500 mt-1",children:r("integrations.pasteQuizletLink",{defaultValue:"Вставьте ссылку на набор карточек Quizlet"})})]}),u&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(st,{className:"h-5 w-5 text-red-500"}),e.jsx("p",{className:"text-sm text-red-700",children:u})]}),w&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx(at,{className:"h-5 w-5 text-green-500"}),e.jsx("p",{className:"text-sm text-green-700",children:r("integrations.importSuccess",{defaultValue:"Карточки успешно импортированы!"})})]}),e.jsxs("button",{onClick:v,disabled:h||!x.trim(),className:"btn-primary w-full disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[e.jsx(te,{className:"h-5 w-5"}),h?r("common.loading"):r("integrations.importCards",{defaultValue:"Импортировать карточки"})]})]})]})}function vt({isOpen:s,onClose:m,onConfirm:r,title:x,label:j,placeholder:h,confirmText:l="OK",cancelText:u="Отмена",defaultValue:y="",required:w=!0}){const[N,v]=c.useState("");c.useEffect(()=>{s?(v(y),setTimeout(()=>{const p=document.getElementById("input-modal-field");p==null||p.focus()},100)):v("")},[s,y]);const C=()=>{if(w&&!N.trim())return;const p=N.trim();v(""),r(p),m()},D=p=>{p.key==="Enter"?(p.preventDefault(),C()):p.key==="Escape"&&m()};return s?e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 animate-fade-in-scale p-4",onClick:p=>{p.target===p.currentTarget&&m()},children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md relative animate-slide-in overflow-hidden",children:[e.jsx("button",{onClick:m,className:"absolute top-4 right-4 z-10 text-neutral-400 hover:text-neutral-600 transition-colors bg-white/80 backdrop-blur-sm rounded-full p-1.5 hover:bg-white",children:e.jsx(_,{className:"h-5 w-5"})}),e.jsx("div",{className:"bg-gradient-to-br from-primary-500 to-primary-600 p-6 md:p-8 pb-6",children:e.jsx("h3",{className:"text-2xl md:text-3xl font-bold text-white pr-8",children:x})}),e.jsx("div",{className:"p-6 md:p-8",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"input-modal-field",className:"block text-sm font-semibold text-neutral-900 mb-2",children:j}),e.jsx("input",{id:"input-modal-field",type:"text",value:N,onChange:p=>v(p.target.value),onKeyDown:D,placeholder:h,className:"w-full px-4 py-3 border-2 border-neutral-300 rounded-xl text-neutral-900 placeholder-neutral-400 focus:outline-none focus:border-primary-500 focus:ring-2 focus:ring-primary-200 transition-all",autoFocus:!0})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{onClick:m,className:"flex-1 px-4 py-3 border-2 border-neutral-300 rounded-xl text-sm font-semibold text-neutral-700 hover:bg-neutral-50 hover:border-neutral-400 transition-all",children:u}),e.jsx("button",{onClick:C,disabled:w&&!N.trim(),className:"flex-1 px-4 py-3 bg-gradient-primary text-white rounded-xl text-sm font-semibold hover:shadow-lg hover:scale-[1.02] transition-all disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100",children:l})]})]})})]})}):null}function yt({isOpen:s,onClose:m,onSave:r,exercise:x}){const[j,h]=c.useState(""),[l,u]=c.useState(null);if(c.useEffect(()=>{if(s&&x){h(x.title);try{const n=x.instructions?JSON.parse(x.instructions):null;u(n)}catch{x.type==="DRAG_DROP"?u({type:"DRAG_DROP",items:[],dropZones:[]}):x.type==="MATCHING"&&u({type:"MATCHING",items:[]})}}},[s,x]),!s||!x)return null;const y=()=>{if(!j.trim())return;const n={...x,title:j.trim(),instructions:l?JSON.stringify(l):""};r(n),m()},w=()=>{if(l&&l.type==="DRAG_DROP"){const n=`item_${Date.now()}`;u({...l,items:[...l.items,{id:n,content:""}]})}},N=()=>{if(l&&l.type==="DRAG_DROP"){const n=`zone_${Date.now()}`;u({...l,dropZones:[...l.dropZones,{id:n,label:"",correctItemId:""}]})}},v=()=>{if(l&&l.type==="MATCHING"){const n=`item_${Date.now()}`;u({...l,items:[...l.items,{id:n,left:"",right:""}]})}},C=(n,d)=>{l&&l.type==="DRAG_DROP"&&u({...l,items:l.items.map(V=>V.id===n?{...V,content:d}:V)})},D=(n,d,V)=>{l&&l.type==="DRAG_DROP"&&u({...l,dropZones:l.dropZones.map(S=>S.id===n?{...S,[d]:V}:S)})},p=(n,d,V)=>{l&&l.type==="MATCHING"&&u({...l,items:l.items.map(S=>S.id===n?{...S,[d]:V}:S)})},I=n=>{l&&l.type==="DRAG_DROP"&&u({...l,items:l.items.filter(d=>d.id!==n),dropZones:l.dropZones.map(d=>d.correctItemId===n?{...d,correctItemId:""}:d)})},P=n=>{l&&l.type==="DRAG_DROP"&&u({...l,dropZones:l.dropZones.filter(d=>d.id!==n)})},$=n=>{l&&l.type==="MATCHING"&&u({...l,items:l.items.filter(d=>d.id!==n)})};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 animate-fade-in-scale p-4 overflow-y-auto",onClick:n=>{n.target===n.currentTarget&&m()},children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-4xl relative animate-slide-in overflow-hidden my-8 max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary-500 to-primary-600 p-6 flex items-center justify-between",children:[e.jsx("h3",{className:"text-2xl font-bold text-white",children:"Редактировать упражнение"}),e.jsx("button",{onClick:m,className:"text-white/80 hover:text-white transition-colors bg-white/20 backdrop-blur-sm rounded-full p-1.5 hover:bg-white/30",children:e.jsx(_,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"p-6 overflow-y-auto flex-1",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-neutral-900 mb-2",children:"Название упражнения"}),e.jsx("input",{type:"text",value:j,onChange:n=>h(n.target.value),className:"w-full px-4 py-3 border-2 border-neutral-300 rounded-xl text-neutral-900 focus:outline-none focus:border-primary-500 focus:ring-2 focus:ring-primary-200 transition-all",placeholder:"Введите название упражнения"})]}),x.type==="DRAG_DROP"&&l&&l.type==="DRAG_DROP"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-lg font-semibold text-neutral-900",children:"Элементы для перетаскивания"}),e.jsxs("button",{onClick:w,className:"btn-secondary flex items-center gap-2 text-sm",children:[e.jsx(A,{className:"h-4 w-4"}),"Добавить элемент"]})]}),e.jsx("div",{className:"space-y-2",children:l.items.map(n=>e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-neutral-50 rounded-lg",children:[e.jsx("input",{type:"text",value:n.content,onChange:d=>C(n.id,d.target.value),className:"flex-1 px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:border-primary-500",placeholder:"Содержимое элемента"}),e.jsx("button",{onClick:()=>I(n.id),className:"text-red-500 hover:text-red-600 p-2",children:e.jsx(se,{className:"h-4 w-4"})})]},n.id))}),e.jsxs("div",{className:"flex items-center justify-between mt-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-neutral-900",children:"Зоны для размещения"}),e.jsxs("button",{onClick:N,className:"btn-secondary flex items-center gap-2 text-sm",children:[e.jsx(A,{className:"h-4 w-4"}),"Добавить зону"]})]}),e.jsx("div",{className:"space-y-2",children:l.dropZones.map(n=>e.jsxs("div",{className:"p-3 bg-neutral-50 rounded-lg space-y-2",children:[e.jsx("input",{type:"text",value:n.label,onChange:d=>D(n.id,"label",d.target.value),className:"w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:border-primary-500",placeholder:"Название зоны"}),e.jsxs("select",{value:n.correctItemId,onChange:d=>D(n.id,"correctItemId",d.target.value),className:"w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:border-primary-500",children:[e.jsx("option",{value:"",children:"Выберите правильный элемент"}),l.items.map(d=>e.jsx("option",{value:d.id,children:d.content||`Элемент ${d.id}`},d.id))]}),e.jsxs("button",{onClick:()=>P(n.id),className:"text-red-500 hover:text-red-600 text-sm flex items-center gap-1",children:[e.jsx(se,{className:"h-4 w-4"}),"Удалить зону"]})]},n.id))})]}),x.type==="MATCHING"&&l&&l.type==="MATCHING"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-lg font-semibold text-neutral-900",children:"Пары для сопоставления"}),e.jsxs("button",{onClick:v,className:"btn-secondary flex items-center gap-2 text-sm",children:[e.jsx(A,{className:"h-4 w-4"}),"Добавить пару"]})]}),e.jsx("div",{className:"space-y-2",children:l.items.map(n=>e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-neutral-50 rounded-lg",children:[e.jsx("input",{type:"text",value:n.left,onChange:d=>p(n.id,"left",d.target.value),className:"flex-1 px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:border-primary-500",placeholder:"Левая часть"}),e.jsx("span",{className:"text-neutral-500",children:"→"}),e.jsx("input",{type:"text",value:n.right,onChange:d=>p(n.id,"right",d.target.value),className:"flex-1 px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:border-primary-500",placeholder:"Правая часть"}),e.jsx("button",{onClick:()=>$(n.id),className:"text-red-500 hover:text-red-600 p-2",children:e.jsx(se,{className:"h-4 w-4"})})]},n.id))})]})]})}),e.jsxs("div",{className:"p-6 border-t border-neutral-200 flex gap-3",children:[e.jsx("button",{onClick:m,className:"flex-1 px-4 py-3 border-2 border-neutral-300 rounded-xl text-sm font-semibold text-neutral-700 hover:bg-neutral-50 transition-all",children:"Отмена"}),e.jsxs("button",{onClick:y,disabled:!j.trim(),className:"flex-1 px-4 py-3 bg-gradient-primary text-white rounded-xl text-sm font-semibold hover:shadow-lg hover:scale-[1.02] transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[e.jsx(ue,{className:"h-5 w-5"}),"Сохранить"]})]})]})})}const wt=xt({courseId:Z().uuid("Неверный ID курса"),moduleId:Z().uuid("Неверный ID модуля").optional().or(Ve("")),title:Z().min(1,"Название урока обязательно"),description:Z().optional(),order:ht().int().min(0).default(0),videoUrl:Z().optional().or(Ve("")).refine(s=>!!(!s||s===""||s.startsWith("http://")||s.startsWith("https://")||s.startsWith("/api/files/")||s.includes("supabase.co")||s.includes("cloudinary.com")),{message:"Введите валидный URL или загрузите видео файл"})});function It(){const{t:s}=pe(),{courseId:m,lessonId:r}=lt(),[x]=rt(),j=it(),h=nt(),l=!!r,u=x.get("moduleId")||"",[y,w]=c.useState(!1),[N,v]=c.useState(!1),[C,D]=c.useState(null),[p,I]=c.useState(null),P=c.useRef(null),[$,n]=c.useState(!1),[d,V]=c.useState(""),[S,xe]=c.useState(""),[he,fe]=c.useState(70),[O,R]=c.useState([]),[ae,Ie]=c.useState(!1),[le,Me]=c.useState(!1),[ge,ke]=c.useState([]),[be,Ee]=c.useState([]),q=c.useRef(!1),[E,H]=c.useState({isOpen:!1,title:"",label:"",onConfirm:()=>{}}),[B,f]=c.useState({isOpen:!1,title:"",message:""}),[K,z]=c.useState({isOpen:!1,title:"",message:""}),[G,W]=c.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}}),[je,re]=c.useState({isOpen:!1,exercise:null}),{data:T,isLoading:ze}=Q(["lesson",r],async()=>(await b.get(`/lessons/${r}`)).data.data,{enabled:l}),{data:Te}=Q(["lessonFiles",r],async()=>(await b.get(`/lessons/${r}/files`)).data.data||[],{enabled:l}),{data:U}=Q(["quiz",r],async()=>{try{return(await b.get(`/quizzes/lesson/${r}`)).data.data}catch{return null}},{enabled:l&&!!r}),{data:Le}=Q(["modules",m],async()=>(await b.get(`/modules/courses/${m}/modules`)).data.data||[],{enabled:!!m}),{data:ie}=Q(["lessonExercises",r],async()=>{try{return(await b.get(`/practice/lessons/${r}`)).data.data||[]}catch{return[]}},{enabled:l&&!!r}),{data:ne}=Q(["lessonIntegrations",r],async()=>{try{return(await b.get("/integrations",{params:{lessonId:r}})).data.data||[]}catch{return[]}},{enabled:l&&!!r});c.useEffect(()=>{ie&&ke(ie)},[ie]),c.useEffect(()=>{ne&&Ee(ne)},[ne]);const oe=k(async()=>{const t=O.map(i=>({question:i.question,type:i.type,order:0,metadata:i.metadata||null,options:i.options,correctAnswer:i.correctAnswer||(i.metadata?JSON.stringify(JSON.parse(i.metadata).correctMapping||{}):null)}));return(await b.post(`/quizzes/lesson/${r}`,{title:d||null,description:S||null,passingScore:he,questions:t})).data.data},{onSuccess:()=>{h.invalidateQueries(["quiz",r]),z({isOpen:!0,title:s("common.success",{defaultValue:"Успешно"}),message:s("quiz.saveSuccess",{defaultValue:"Тест успешно сохранен!"})})},onError:t=>{var a,i;f({isOpen:!0,title:s("common.error",{defaultValue:"Ошибка"}),message:((i=(a=t.response)==null?void 0:a.data)==null?void 0:i.message)||"Ошибка при сохранении теста"})}}),ce=k(async t=>(await b.post("/lessons",t)).data.data,{onSuccess:t=>{h.invalidateQueries(["course",m]),j(`/teacher/courses/${m}/lessons/${t==null?void 0:t.id}/edit`)}}),de=k(async t=>(await b.put(`/lessons/${r}`,t)).data.data,{onSuccess:()=>{h.invalidateQueries(["lesson",r]),h.invalidateQueries(["course",m])}}),Re=k(async t=>{await b.delete(`/files/${t}`)},{onSuccess:()=>{h.invalidateQueries(["lessonFiles",r])}}),Ne=k(async t=>(await b.post(`/practice/lessons/${r}`,{title:t.title,description:t.description,type:t.type,instructions:t.metadata})).data.data,{onSuccess:()=>{h.invalidateQueries(["lessonExercises",r]),z({isOpen:!0,title:s("common.success",{defaultValue:"Успешно"}),message:s("practice.createSuccess",{defaultValue:"Упражнение успешно создано!"})})},onError:t=>{var a,i;f({isOpen:!0,title:s("common.error",{defaultValue:"Ошибка"}),message:((i=(a=t.response)==null?void 0:a.data)==null?void 0:i.message)||s("practice.createError",{defaultValue:"Ошибка при создании упражнения"})})}}),Ae=k(async t=>(await b.put(`/practice/exercises/${t.exerciseId}`,{title:t.title,instructions:t.instructions})).data.data,{onSuccess:()=>{h.invalidateQueries(["lessonExercises",r]),z({isOpen:!0,title:s("common.success",{defaultValue:"Успешно"}),message:s("practice.updateSuccess",{defaultValue:"Упражнение успешно обновлено!"})}),re({isOpen:!1,exercise:null})},onError:t=>{var a,i;f({isOpen:!0,title:s("common.error",{defaultValue:"Ошибка"}),message:((i=(a=t.response)==null?void 0:a.data)==null?void 0:i.message)||s("practice.updateError",{defaultValue:"Ошибка при обновлении упражнения"})})}}),Pe=k(async t=>{await b.delete(`/practice/exercises/${t}`)},{onSuccess:()=>{h.invalidateQueries(["lessonExercises",r]),z({isOpen:!0,title:s("common.success",{defaultValue:"Успешно"}),message:s("practice.deleteSuccess",{defaultValue:"Упражнение успешно удалено"})})},onError:t=>{var a,i;f({isOpen:!0,title:s("common.error",{defaultValue:"Ошибка"}),message:((i=(a=t.response)==null?void 0:a.data)==null?void 0:i.message)||s("practice.deleteError",{defaultValue:"Ошибка при удалении упражнения"})})}}),Ge=k(async t=>(await b.post(`/lessons/${r}/integrations`,t)).data.data,{onSuccess:()=>{h.invalidateQueries(["lessonIntegrations",r]),z({isOpen:!0,title:s("common.success",{defaultValue:"Успешно"}),message:s("integrations.addSuccess",{defaultValue:"Интеграция успешно добавлена!"})})},onError:t=>{var a,i;f({isOpen:!0,title:s("common.error",{defaultValue:"Ошибка"}),message:((i=(a=t.response)==null?void 0:a.data)==null?void 0:i.message)||"Ошибка при добавлении интеграции"})}}),Ue=k(async t=>{await b.delete(`/integrations/${t}`)},{onSuccess:()=>{h.invalidateQueries(["lessonIntegrations",r])}}),Fe=()=>{H({isOpen:!0,title:s("practice.createDragDrop",{defaultValue:"Создать упражнение Drag & Drop"}),label:s("practice.enterExerciseTitle",{defaultValue:"Введите название упражнения:"}),placeholder:s("practice.exerciseTitlePlaceholder",{defaultValue:"Название упражнения"}),required:!0,onConfirm:t=>{if(!t)return;const a={type:"DRAG_DROP",items:[{id:"1",content:"Пример 1"},{id:"2",content:"Пример 2"}],dropZones:[{id:"zone1",label:"Зона 1",correctItemId:"1"},{id:"zone2",label:"Зона 2",correctItemId:"2"}]};Ne.mutate({title:t,type:"DRAG_DROP",metadata:JSON.stringify(a)})}})},Qe=()=>{H({isOpen:!0,title:s("practice.createMatching",{defaultValue:"Создать упражнение Matching"}),label:s("practice.enterExerciseTitle",{defaultValue:"Введите название упражнения:"}),placeholder:s("practice.exerciseTitlePlaceholder",{defaultValue:"Название упражнения"}),required:!0,onConfirm:t=>{if(!t)return;const a={type:"MATCHING",items:[{id:"1",left:"Пример 1",right:"Example 1"},{id:"2",left:"Пример 2",right:"Example 2"}]};Ne.mutate({title:t,type:"MATCHING",metadata:JSON.stringify(a)})}})},_e=()=>{H({isOpen:!0,title:s("integrations.addGoogleDocs",{defaultValue:"Добавить Google Docs"}),label:"Введите URL документа Google Docs:",placeholder:"https://docs.google.com/...",required:!0,onConfirm:t=>{t&&setTimeout(()=>{H({isOpen:!0,title:s("integrations.addGoogleDocs",{defaultValue:"Добавить Google Docs"}),label:s("integrations.enterDocumentTitle",{defaultValue:"Введите название документа (необязательно):"}),placeholder:s("integrations.documentTitlePlaceholder",{defaultValue:"Название документа"}),required:!1,onConfirm:a=>{Ge.mutate({type:"GOOGLE_DOCS",externalUrl:t,metadata:a?JSON.stringify({title:a}):void 0})}})},100)}})},{register:J,handleSubmit:$e,formState:{errors:F},reset:ve,setValue:ye}=ot({resolver:pt(wt),defaultValues:{courseId:m||"",moduleId:u||"",title:"",description:"",order:0,videoUrl:""}});c.useEffect(()=>{T&&l&&!q.current?(ve({courseId:T.courseId,moduleId:T.moduleId||"",title:T.title,description:T.description||"",order:T.order,videoUrl:T.videoUrl||""}),q.current=!0):m&&!l&&!q.current&&(ve({courseId:m,moduleId:u||"",title:"",description:"",order:0,videoUrl:""}),q.current=!0),u&&!l&&q.current&&ye("moduleId",u)},[T,m,l,u]),c.useEffect(()=>{U&&(V(U.title||""),xe(U.description||""),fe(U.passingScore),R(U.questions.map(t=>{var a;return{question:t.question,type:t.type,options:(a=t.options)==null?void 0:a.map(i=>({text:i.text,isCorrect:i.isCorrect||!1})),correctAnswer:t.correctAnswer||void 0,metadata:t.metadata||void 0}})),n(!0))},[U]);const qe=t=>{l?de.mutate(t):ce.mutate(t)},He=async t=>{var o,g,M;const a=(o=t.target.files)==null?void 0:o[0];if(!a||!r)return;w(!0),D({fileName:a.name,progress:0});const i=new FormData;i.append("file",a),i.append("lessonId",r);try{await b.post("/files/upload",i,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:L=>{if(L.total){const Y=Math.round(L.loaded*100/L.total);D({fileName:a.name,progress:Y})}}}),h.invalidateQueries(["lessonFiles",r]),D(null)}catch(L){f({isOpen:!0,title:s("common.error",{defaultValue:"Ошибка"}),message:((M=(g=L.response)==null?void 0:g.data)==null?void 0:M.message)||"Ошибка при загрузке файла"}),D(null)}finally{w(!1),t.target.value=""}},Je=async t=>{var g,M,L,Y;const a=(g=t.target.files)==null?void 0:g[0];if(!a)return;if(!["video/mp4","video/webm","video/ogg","video/quicktime","video/x-msvideo","video/x-ms-wmv","video/x-flv","video/mpeg"].includes(a.type)&&!a.name.match(/\.(mp4|webm|ogg|mov|avi|wmv|flv|mpeg|mpg)$/i)){f({isOpen:!0,title:s("common.error",{defaultValue:"Ошибка"}),message:"Пожалуйста, выберите видео файл (MP4, WebM, MOV, AVI и т.д.)"}),t.target.value="";return}if(a.size>500*1024*1024){f({isOpen:!0,title:s("common.error",{defaultValue:"Ошибка"}),message:"Размер видео файла не должен превышать 500 MB"}),t.target.value="";return}v(!0),I({fileName:a.name,progress:0});const o=new FormData;o.append("file",a),r&&o.append("lessonId",r);try{const ee=await b.post("/files/upload",o,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:me=>{if(me.total){const et=Math.round(me.loaded*100/me.total);I({fileName:a.name,progress:et})}}});(M=ee.data.data)!=null&&M.fileUrl&&(ye("videoUrl",ee.data.data.fileUrl),r&&h.invalidateQueries(["lessonFiles",r]),z({isOpen:!0,title:s("common.success",{defaultValue:"Успешно"}),message:"Видео успешно загружено! Не забудьте сохранить урок."})),I(null)}catch(ee){f({isOpen:!0,title:s("common.error",{defaultValue:"Ошибка"}),message:((Y=(L=ee.response)==null?void 0:L.data)==null?void 0:Y.message)||"Ошибка при загрузке видео"}),I(null)}finally{v(!1),t.target.value=""}},Ze=t=>{W({isOpen:!0,title:s("files.deleteFile",{defaultValue:"Удалить файл"}),message:s("files.deleteConfirm",{defaultValue:"Вы уверены, что хотите удалить этот файл?"}),variant:"danger",onConfirm:()=>{Re.mutate(t)}})},Be=()=>{R([...O,{question:"",type:"MULTIPLE_CHOICE",options:[{text:"",isCorrect:!1},{text:"",isCorrect:!1}],metadata:void 0}])},Ke=t=>{R(O.filter((a,i)=>i!==t))},X=(t,a,i)=>{const o=[...O];o[t]={...o[t],[a]:i},a==="type"&&(i==="TRUE_FALSE"?(o[t].options=void 0,o[t].metadata=void 0):i==="MULTIPLE_CHOICE"&&!o[t].options?(o[t].options=[{text:"",isCorrect:!1},{text:"",isCorrect:!1}],o[t].metadata=void 0):(i==="DRAG_DROP"||i==="MATCHING"||i==="FILL_BLANK")&&(o[t].options=void 0,o[t].metadata||(i==="DRAG_DROP"?o[t].metadata=JSON.stringify({items:[],targets:[],correctMapping:{}}):i==="MATCHING"?o[t].metadata=JSON.stringify({leftItems:[],rightItems:[],correctPairs:[]}):i==="FILL_BLANK"&&(o[t].metadata=JSON.stringify({text:"",blanks:[]}))))),R(o)},We=t=>{const a=[...O];a[t].options||(a[t].options=[]),a[t].options.push({text:"",isCorrect:!1}),R(a)},Xe=(t,a)=>{const i=[...O];i[t].options&&(i[t].options=i[t].options.filter((o,g)=>g!==a)),R(i)},we=(t,a,i,o)=>{const g=[...O];g[t].options&&(g[t].options[a]={...g[t].options[a],[i]:o}),R(g)},Ye=()=>{if(!r){f({isOpen:!0,title:s("common.error",{defaultValue:"Ошибка"}),message:s("lessons.saveLessonFirst",{defaultValue:"Сначала сохраните урок"})});return}for(let t=0;t<O.length;t++){const a=O[t];if(!a.question.trim()){f({isOpen:!0,title:s("common.error",{defaultValue:"Ошибка"}),message:s("quiz.enterQuestionText",{questionNum:t+1,defaultValue:`Вопрос ${t+1}: введите текст вопроса`})});return}if(a.type==="MULTIPLE_CHOICE"){if(!a.options||a.options.length<2){f({isOpen:!0,title:s("common.error",{defaultValue:"Ошибка"}),message:s("quiz.addMinOptions",{questionNum:t+1,defaultValue:`Вопрос ${t+1}: добавьте минимум 2 варианта ответа`})});return}if(!a.options.some(o=>o.isCorrect)){f({isOpen:!0,title:s("common.error",{defaultValue:"Ошибка"}),message:s("quiz.selectCorrectAnswer",{questionNum:t+1,defaultValue:`Вопрос ${t+1}: выберите правильный ответ`})});return}for(let o=0;o<a.options.length;o++)if(!a.options[o].text.trim()){f({isOpen:!0,title:s("common.error",{defaultValue:"Ошибка"}),message:`Вопрос ${t+1}, вариант ${o+1}: введите текст варианта`});return}}else if(a.type==="TRUE_FALSE"){if(!a.correctAnswer){f({isOpen:!0,title:s("common.error",{defaultValue:"Ошибка"}),message:s("quiz.selectTrueFalse",{questionNum:t+1,defaultValue:`Вопрос ${t+1}: выберите правильный ответ (Верно/Неверно)`})});return}}else if(a.type==="DRAG_DROP"||a.type==="MATCHING"||a.type==="FILL_BLANK"){if(!a.metadata||!a.metadata.trim()){f({isOpen:!0,title:s("common.error",{defaultValue:"Ошибка"}),message:s("quiz.fillMetadata",{questionNum:t+1,defaultValue:`Вопрос ${t+1}: заполните метаданные для интерактивного задания`})});return}try{JSON.parse(a.metadata)}catch{f({isOpen:!0,title:s("common.error",{defaultValue:"Ошибка"}),message:s("quiz.metadataMustBeJson",{questionNum:t+1,defaultValue:`Вопрос ${t+1}: метаданные должны быть в формате JSON`})});return}}}oe.mutate()};if(ze)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block relative",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-primary-200 border-t-primary-500"})}),e.jsx("p",{className:"mt-4 text-neutral-600",children:s("common.loading")})]});const Ce=Te||[];return e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>j(`/teacher/courses/${m}/edit`),className:"flex items-center text-neutral-600 hover:text-primary-600 mb-6 transition-colors animate-slide-in",children:[e.jsx(ct,{className:"h-5 w-5 mr-2"}),s("common.back")," ",s("courses.title")]}),e.jsx("div",{className:"relative mb-8 animate-fade-scale",children:e.jsx("h1",{className:"text-2xl md:text-3xl lg:text-5xl font-bold text-gradient",children:s(l?"lessons.editLesson":"lessons.createLesson")})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx("div",{className:"card p-6 animate-fade-scale",children:e.jsxs("form",{onSubmit:$e(qe),className:"space-y-6",children:[e.jsxs("div",{className:"animate-slide-in",style:{animationDelay:"0.1s"},children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-neutral-700 mb-2",children:s("lessons.lessonTitle")}),e.jsx("input",{...J("title"),type:"text",className:"input-field",placeholder:s("lessons.lessonTitle")}),F.title&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:F.title.message})]}),e.jsxs("div",{className:"animate-slide-in",style:{animationDelay:"0.2s"},children:[e.jsxs("label",{htmlFor:"moduleId",className:"block text-sm font-medium text-neutral-700 mb-2",children:[s("modules.title")," ",e.jsxs("span",{className:"text-neutral-500 text-xs",children:["(",s("common.optional"),")"]})]}),e.jsxs("select",{...J("moduleId"),className:"input-field",children:[e.jsx("option",{value:"",children:s("courses.notSelected")}),(Le||[]).map(t=>e.jsx("option",{value:t.id,children:t.title},t.id))]})]}),e.jsxs("div",{className:"animate-slide-in",style:{animationDelay:"0.3s"},children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-neutral-700 mb-2",children:s("lessons.lessonDescription")}),e.jsx("textarea",{...J("description"),rows:4,className:"input-field",placeholder:s("lessons.lessonDescription")})]}),e.jsxs("div",{className:"animate-slide-in",style:{animationDelay:"0.4s"},children:[e.jsx("label",{htmlFor:"order",className:"block text-sm font-medium text-neutral-700 mb-2",children:s("lessons.order")}),e.jsx("input",{...J("order",{valueAsNumber:!0}),type:"number",min:"0",className:"input-field"}),F.order&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:F.order.message})]}),e.jsxs("div",{className:"animate-slide-in",style:{animationDelay:"0.5s"},children:[e.jsx("label",{htmlFor:"videoUrl",className:"block text-sm font-medium text-neutral-700 mb-2",children:"Видео урока"}),p&&e.jsx(Se,{fileName:p.fileName,progress:p.progress,onCancel:()=>{v(!1),I(null),P.current&&(P.current.value="")}}),e.jsxs("div",{className:"mb-3",children:[e.jsx("input",{ref:P,type:"file",accept:"video/mp4,video/webm,video/ogg,video/quicktime,video/x-msvideo,video/x-ms-wmv,video/x-flv,video/mpeg,.mp4,.webm,.ogg,.mov,.avi,.wmv,.flv,.mpeg,.mpg",onChange:Je,disabled:N,className:"hidden"}),e.jsxs("button",{type:"button",onClick:()=>{var t;return(t=P.current)==null?void 0:t.click()},disabled:N,className:"w-full px-4 py-2 border-2 border-dashed border-primary-300 rounded-lg hover:border-primary-500 cursor-pointer transition-all hover:bg-primary-50 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[e.jsx(te,{className:"h-5 w-5 text-primary-500"}),N?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"animate-spin",children:"⟳"}),e.jsx("span",{children:"Загрузка видео..."})]}):e.jsx("span",{children:"Загрузить видео с компьютера (MP4, WebM, MOV, AVI и т.д.)"})]}),e.jsx("p",{className:"mt-1 text-xs text-neutral-500",children:"Максимальный размер: 500 MB. Поддерживаются: MP4, WebM, MOV, AVI, WMV, FLV, MPEG"})]}),e.jsxs("div",{className:"flex items-center gap-3 my-4",children:[e.jsx("div",{className:"flex-1 border-t border-neutral-300"}),e.jsx("span",{className:"text-xs text-neutral-500",children:"или"}),e.jsx("div",{className:"flex-1 border-t border-neutral-300"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"videoUrl",className:"block text-sm font-medium text-neutral-700 mb-2",children:"Или введите URL видео"}),e.jsx("input",{...J("videoUrl"),type:"url",placeholder:"YouTube, Vimeo, Google Drive, VK или прямая ссылка на видео",className:"input-field"}),F.videoUrl&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:F.videoUrl.message}),e.jsx("p",{className:"mt-1 text-sm text-neutral-500",children:"Поддерживаются: YouTube, Vimeo, Google Drive, VK и прямые ссылки на видео (mp4, webm и т.д.)"}),e.jsxs("div",{className:"mt-2 text-xs text-neutral-400 space-y-1",children:[e.jsx("p",{children:"Примеры:"}),e.jsx("p",{children:"• YouTube: https://www.youtube.com/watch?v=..."}),e.jsx("p",{children:"• Vimeo: https://vimeo.com/123456789"}),e.jsx("p",{children:"• Google Drive: https://drive.google.com/file/d/FILE_ID/view"}),e.jsx("p",{children:"• VK: https://vk.com/video-123456789_123456789"}),e.jsx("p",{children:"• Прямая ссылка: https://example.com/video.mp4"})]})]})]}),e.jsx("div",{className:"animate-slide-in",style:{animationDelay:"0.5s"},children:e.jsxs("button",{type:"submit",disabled:ce.isLoading||de.isLoading,className:"btn-primary w-full disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ue,{className:"h-5 w-5 mr-2"}),ce.isLoading||de.isLoading?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"animate-spin",children:"⟳"})," ",e.jsx("span",{children:"Сохранение..."})]}):e.jsx("span",{children:"Сохранить"})]})})]})})}),l&&e.jsxs("div",{className:"space-y-6 animate-fade-scale",style:{animationDelay:"0.6s"},children:[e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold text-neutral-900 flex items-center gap-2",children:[e.jsx(Oe,{className:"h-5 w-5 text-primary-500"}),s("quiz.lessonQuiz",{defaultValue:"Тест к уроку"})]}),e.jsx("button",{type:"button",onClick:()=>n(!$),className:"text-sm text-primary-600 hover:text-primary-700",children:s($?"common.hide":"common.show")})]}),$&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:[s("quiz.quizTitle")," (",s("common.optional"),")"]}),e.jsx("input",{type:"text",value:d,onChange:t=>V(t.target.value),placeholder:s("quiz.quizTitleExample",{defaultValue:"Например: Проверочный тест"}),className:"input-field"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:[s("quiz.quizDescription")," (",s("common.optional"),")"]}),e.jsx("textarea",{value:S,onChange:t=>xe(t.target.value),rows:2,placeholder:s("quiz.quizDescription"),className:"input-field"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:s("quiz.passingScore")}),e.jsx("input",{type:"number",min:"0",max:"100",value:he,onChange:t=>fe(Number(t.target.value)),className:"input-field"})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-neutral-900",children:s("quiz.questions")}),e.jsxs("button",{type:"button",onClick:Be,className:"btn-secondary text-sm inline-flex items-center",children:[e.jsx(A,{className:"h-4 w-4 mr-1"}),s("quiz.addQuestion")]})]}),O.length===0?e.jsx("p",{className:"text-sm text-neutral-500 text-center py-4",children:s("quiz.noQuestions",{defaultValue:"Нет вопросов. Добавьте первый вопрос."})}):e.jsx("div",{className:"space-y-4",children:O.map((t,a)=>{var i;return e.jsxs("div",{className:"border border-neutral-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("span",{className:"text-sm font-medium text-neutral-700",children:[s("quiz.question")," ",a+1]}),e.jsx("button",{type:"button",onClick:()=>Ke(a),className:"text-red-500 hover:text-red-600",children:e.jsx(se,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"mb-3",children:e.jsx("input",{type:"text",value:t.question,onChange:o=>X(a,"question",o.target.value),placeholder:"Введите вопрос...",className:"input-field"})}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:s("quiz.questionType",{defaultValue:"Тип вопроса"})}),e.jsxs("select",{value:t.type,onChange:o=>X(a,"type",o.target.value),className:"input-field",children:[e.jsx("option",{value:"MULTIPLE_CHOICE",children:s("quiz.multipleChoice")}),e.jsx("option",{value:"TRUE_FALSE",children:s("quiz.trueFalse")}),e.jsx("option",{value:"DRAG_DROP",children:s("quiz.dragDrop")}),e.jsx("option",{value:"MATCHING",children:s("quiz.matching")}),e.jsx("option",{value:"FILL_BLANK",children:s("quiz.fillBlank")})]})]}),t.type==="MULTIPLE_CHOICE"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-sm font-medium text-neutral-700",children:"Варианты ответов"}),e.jsxs("button",{type:"button",onClick:()=>We(a),className:"text-xs text-primary-600 hover:text-primary-700",children:["+ ",s("quiz.addOption")]})]}),(i=t.options)==null?void 0:i.map((o,g)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:o.text,onChange:M=>we(a,g,"text",M.target.value),placeholder:`Вариант ${g+1}`,className:"input-field flex-1"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:o.isCorrect,onChange:M=>we(a,g,"isCorrect",M.target.checked),className:"w-4 h-4"}),e.jsx("span",{className:"text-sm text-neutral-600",children:"Правильный"})]}),t.options.length>2&&e.jsx("button",{type:"button",onClick:()=>Xe(a,g),className:"text-red-500 hover:text-red-600",children:e.jsx(_,{className:"h-4 w-4"})})]},g))]}),t.type==="TRUE_FALSE"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Правильный ответ"}),e.jsxs("select",{value:t.correctAnswer||"",onChange:o=>X(a,"correctAnswer",o.target.value),className:"input-field",children:[e.jsx("option",{value:"",children:"Выберите ответ"}),e.jsx("option",{value:"true",children:"Верно"}),e.jsx("option",{value:"false",children:"Неверно"})]})]}),(t.type==="DRAG_DROP"||t.type==="MATCHING"||t.type==="FILL_BLANK")&&e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("p",{className:"text-sm text-blue-800 mb-2",children:[e.jsx("strong",{children:"Интерактивные задания"})," требуют настройки метаданных."]}),e.jsx("p",{className:"text-xs text-blue-600",children:"Для создания таких заданий используйте JSON формат в поле метаданных. Примеры форматов можно найти в документации."}),e.jsx("textarea",{value:t.metadata||"",onChange:o=>X(a,"metadata",o.target.value),placeholder:'{"items": [...], "targets": [...], "correctMapping": {...}}',rows:4,className:"input-field mt-2 font-mono text-xs"})]})]},a)})}),e.jsx("button",{type:"button",onClick:Ye,disabled:oe.isLoading||O.length===0,className:"btn-primary w-full mt-4 disabled:opacity-50 disabled:cursor-not-allowed",children:oe.isLoading?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"animate-spin",children:"⟳"}),e.jsx("span",{children:"Сохранение..."})]}):"Сохранить тест"})]})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-neutral-900 mb-4",children:"Файлы урока"}),C&&e.jsx(Se,{fileName:C.fileName,progress:C.progress,onCancel:()=>{w(!1),D(null)}}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block w-full",children:[e.jsx("input",{type:"file",onChange:He,disabled:y||!r,accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.zip,.jpg,.jpeg,.png,.gif,.webp,.mp4,.webm,.ogg,.mov,.avi,.wmv,.flv,.mpeg",className:"hidden"}),e.jsxs("span",{className:"flex items-center justify-center w-full px-4 py-2 border-2 border-dashed border-neutral-300 rounded-lg hover:border-primary-400 cursor-pointer transition-all hover:bg-primary-50 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(te,{className:"h-5 w-5 mr-2 text-primary-500"}),y?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"animate-spin",children:"⟳"}),e.jsx("span",{children:"Загрузка..."})]}):r?e.jsx("span",{children:"Загрузить файл (PDF, DOC, видео, изображения и др.)"}):e.jsx("span",{className:"text-neutral-500",children:"Сначала сохраните урок"})]})]}),e.jsx("p",{className:"mt-2 text-xs text-neutral-500",children:"Поддерживаются: документы (PDF, DOC, DOCX, XLS, XLSX, PPT, PPTX), изображения (JPG, PNG, GIF, WebP), видео (MP4, WebM, MOV, AVI и др.), архивы (ZIP). Максимальный размер: 100 MB"})]}),Ce.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("p",{className:"text-neutral-500",children:"Нет файлов"}),e.jsx("p",{className:"text-xs text-neutral-400 mt-1",children:"Загрузите файлы к уроку (PDF, документы, видео и др.)"})]}):e.jsx("div",{className:"space-y-2",children:Ce.map((t,a)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-neutral-200 rounded-lg hover:border-primary-300 hover:bg-neutral-50 transition-all animate-slide-in",style:{animationDelay:`${.1*a}s`},children:[e.jsxs("div",{className:"flex items-center flex-1 min-w-0",children:[e.jsx("div",{className:"flex-shrink-0 mr-3",children:t.fileName.match(/\.(pdf|doc|docx)$/i)?e.jsx(Oe,{className:"h-5 w-5 text-blue-500"}):t.fileName.match(/\.(mp4|webm|mov|avi)$/i)?e.jsx(dt,{className:"h-5 w-5 text-purple-500"}):e.jsx(te,{className:"h-5 w-5 text-primary-500"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-neutral-900 truncate",children:t.fileName}),e.jsxs("p",{className:"text-xs text-neutral-500",children:[(t.fileSize/1024/1024).toFixed(2)," MB"]})]})]}),e.jsx("button",{onClick:()=>Ze(t.id),className:"ml-2 p-1 text-red-500 hover:text-red-600 hover:bg-red-50 rounded transition-all",title:"Удалить",children:e.jsx(_,{className:"h-4 w-4"})})]},t.id))})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold text-neutral-900 flex items-center gap-2",children:[e.jsx(mt,{className:"h-5 w-5 text-primary-500"}),"Интерактивные упражнения"]}),e.jsx("button",{type:"button",onClick:()=>Ie(!ae),className:"text-sm text-primary-600 hover:text-primary-700",children:ae?"Скрыть":"Показать"})]}),ae&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("button",{type:"button",onClick:Fe,className:"btn-secondary flex items-center gap-2",children:[e.jsx(A,{className:"h-4 w-4"}),"Добавить Drag & Drop"]}),e.jsxs("button",{type:"button",onClick:Qe,className:"btn-secondary flex items-center gap-2",children:[e.jsx(A,{className:"h-4 w-4"}),"Добавить Matching"]})]}),ge.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("p",{className:"text-neutral-500",children:"Нет упражнений"}),e.jsx("p",{className:"text-sm text-neutral-400 mt-1",children:"Создайте упражнение, нажав на кнопки выше"})]}):e.jsx("div",{className:"space-y-4",children:ge.map(t=>e.jsx("div",{className:"p-4 border border-neutral-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-neutral-900 mb-1",children:t.title}),t.description&&e.jsx("p",{className:"text-sm text-neutral-600 mb-1",children:t.description}),e.jsxs("p",{className:"text-sm text-neutral-600",children:["Тип: ",e.jsx("span",{className:"font-medium",children:t.type==="DRAG_DROP"?"Drag & Drop":t.type==="MATCHING"?"Matching":t.type})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>{re({isOpen:!0,exercise:t})},className:"px-3 py-1.5 text-sm font-medium text-primary-600 hover:text-primary-700 hover:bg-primary-50 rounded-lg transition-colors flex items-center gap-1.5",title:"Редактировать упражнение",children:[e.jsx(ue,{className:"h-4 w-4"}),"Редактировать"]}),e.jsx("button",{type:"button",onClick:()=>{W({isOpen:!0,title:s("practice.deleteExercise",{defaultValue:"Удалить упражнение"}),message:s("practice.deleteConfirm",{defaultValue:"Удалить это упражнение?"}),variant:"danger",onConfirm:()=>{Pe.mutate(t.id)}})},className:"text-red-500 hover:text-red-600 p-1.5 hover:bg-red-50 rounded transition-colors",title:"Удалить упражнение",children:e.jsx(_,{className:"h-4 w-4"})})]})]})},t.id))})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold text-neutral-900 flex items-center gap-2",children:[e.jsx(ut,{className:"h-5 w-5 text-primary-500"}),"Интеграции"]}),e.jsx("button",{type:"button",onClick:()=>Me(!le),className:"text-sm text-primary-600 hover:text-primary-700",children:le?"Скрыть":"Показать"})]}),le&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex gap-2 flex-wrap",children:e.jsxs("button",{type:"button",onClick:_e,className:"btn-secondary flex items-center gap-2",children:[e.jsx(A,{className:"h-4 w-4"}),"Добавить Google Docs"]})}),be.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("p",{className:"text-neutral-500",children:"Нет интеграций"}),e.jsx("p",{className:"text-sm text-neutral-400 mt-1",children:"Добавьте интеграцию, нажав на кнопку выше"})]}):e.jsx("div",{className:"space-y-4",children:be.map(t=>e.jsxs("div",{className:"p-4 border border-neutral-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold text-neutral-900",children:t.type==="GOOGLE_DOCS"?"Google Docs":t.type}),e.jsx("button",{type:"button",onClick:()=>{W({isOpen:!0,title:s("integrations.deleteIntegration",{defaultValue:"Удалить интеграцию"}),message:s("integrations.deleteConfirm",{defaultValue:"Удалить эту интеграцию?"}),variant:"danger",onConfirm:()=>{Ue.mutate(t.id)}})},className:"text-red-500 hover:text-red-600",children:e.jsx(_,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-sm text-neutral-600 break-all",children:t.externalUrl}),t.type==="GOOGLE_DOCS"&&e.jsx("div",{className:"mt-4",children:e.jsx(jt,{docUrl:t.externalUrl,title:t.metadata?JSON.parse(t.metadata).title:void 0})})]},t.id))}),r&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Импорт из Quizlet"}),e.jsx(Nt,{lessonId:r,onImportComplete:t=>{z({isOpen:!0,title:s("common.success",{defaultValue:"Успешно"}),message:s("flashcards.imported",{count:t.length,defaultValue:`Импортировано ${t.length} карточек!`})}),h.invalidateQueries(["lessonFlashcardDecks",r])}})]})]})]})]})]}),e.jsx(vt,{isOpen:E.isOpen,onClose:()=>H({...E,isOpen:!1}),onConfirm:E.onConfirm,title:E.title,label:E.label,placeholder:E.placeholder,defaultValue:E.defaultValue,required:E.required}),e.jsx(gt,{isOpen:B.isOpen,onClose:()=>f({...B,isOpen:!1}),title:B.title,message:B.message}),e.jsx(bt,{isOpen:K.isOpen,onClose:()=>z({...K,isOpen:!1}),title:K.title,message:K.message}),e.jsx(ft,{isOpen:G.isOpen,onClose:()=>W({...G,isOpen:!1}),onConfirm:G.onConfirm,title:G.title,message:G.message,variant:G.variant||"warning"}),e.jsx(yt,{isOpen:je.isOpen,onClose:()=>re({isOpen:!1,exercise:null}),onSave:t=>{Ae.mutate({exerciseId:t.id,title:t.title,instructions:t.instructions})},exercise:je.exercise})]})}export{It as default};
