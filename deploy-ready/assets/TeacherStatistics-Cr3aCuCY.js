import{m as w,h as c,j as e,ao as C,v as b,t as S,M as D,a2 as k,a0 as T,as as V}from"./vendor-react-BjEyyFPN.js";import{a as x}from"./index-DvAsZ7Fn.js";import{R as o,L as $,D as L,X as R,Y as A,T as h,E as f,F as E,P as p,G as N,H as y}from"./vendor-other-DqScX_4L.js";import"./vendor-state-J2SV4L1Z.js";import"./vendor-network-DuohUtNG.js";function I(){var u,g;const{t:a}=w(),{data:m,isLoading:v,error:d}=c("teacherStatistics",async()=>(await x.get("/statistics/teacher")).data,{staleTime:1*60*1e3,cacheTime:3*60*1e3,refetchInterval:5*60*1e3}),{data:r}=c("newUsersGrowth",async()=>(await x.get("/statistics/new-users-growth?days=30")).data,{staleTime:2*60*1e3,cacheTime:5*60*1e3}),{data:n}=c("deviceStatistics",async()=>(await x.get("/statistics/device-statistics")).data,{staleTime:2*60*1e3,cacheTime:5*60*1e3}),{data:i}=c("activeStudents",async()=>(await x.get("/statistics/active-students?days=30")).data,{staleTime:2*60*1e3,cacheTime:5*60*1e3}),s=m==null?void 0:m.data,j=["#3b82f6","#10b981","#f59e0b","#6b7280"];return d?(console.error("Statistics error:",d),e.jsx("div",{className:"text-center py-12",children:e.jsx("div",{className:"text-red-600",children:((g=(u=d==null?void 0:d.response)==null?void 0:u.data)==null?void 0:g.message)||a("errors.somethingWentWrong")})})):v?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block relative",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-primary-200 border-t-primary-500"})}),e.jsx("p",{className:"mt-4 text-neutral-600",children:a("common.loading")})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8",children:[e.jsx("h1",{className:"text-2xl md:text-3xl lg:text-5xl font-bold text-gradient",children:a("statistics.title")}),e.jsxs("button",{onClick:()=>{const t=localStorage.getItem("token");window.open(`/api/export/course-statistics?token=${t}`,"_blank")},className:"btn-secondary inline-flex items-center",children:[e.jsx(C,{className:"h-5 w-5 mr-2"}),e.jsx("span",{children:"Экспорт"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12",children:[e.jsxs("div",{className:"card p-6 animate-fade-scale bg-gradient-to-br from-primary-50 to-blue-50",style:{animationDelay:"0.1s"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-primary-900",children:a("courses.totalCourses",{defaultValue:"Всего курсов"})}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-primary flex items-center justify-center shadow-glow",children:e.jsx(b,{className:"h-6 w-6 text-white"})})]}),e.jsx("p",{className:"text-2xl md:text-3xl lg:text-4xl font-bold text-primary-900",children:(s==null?void 0:s.overview.totalCourses)||0})]}),e.jsxs("div",{className:"card p-6 animate-fade-scale bg-gradient-to-br from-accent-50 to-emerald-50",style:{animationDelay:"0.2s"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-accent-900",children:a("students.totalStudents",{defaultValue:"Всего студентов"})}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-accent flex items-center justify-center shadow-glow",children:e.jsx(S,{className:"h-6 w-6 text-white"})})]}),e.jsx("p",{className:"text-2xl md:text-3xl lg:text-4xl font-bold text-accent-900",children:(s==null?void 0:s.overview.totalStudents)||0})]}),e.jsxs("div",{className:"card p-6 animate-fade-scale bg-gradient-to-br from-education-50 to-purple-50",style:{animationDelay:"0.3s"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-education-900",children:a("statistics.totalLessons",{defaultValue:"Всего уроков"})}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-education flex items-center justify-center shadow-glow",children:e.jsx(b,{className:"h-6 w-6 text-white"})})]}),e.jsx("p",{className:"text-2xl md:text-3xl lg:text-4xl font-bold text-education-900",children:(s==null?void 0:s.overview.totalLessons)||0})]}),e.jsxs("div",{className:"card p-6 animate-fade-scale bg-gradient-to-br from-primary-50 to-indigo-50",style:{animationDelay:"0.4s"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-primary-900",children:a("statistics.totalComments",{defaultValue:"Всего комментариев"})}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-primary flex items-center justify-center shadow-glow",children:e.jsx(D,{className:"h-6 w-6 text-white"})})]}),e.jsx("p",{className:"text-2xl md:text-3xl lg:text-4xl font-bold text-primary-900",children:(s==null?void 0:s.overview.totalComments)||0})]}),e.jsxs("div",{className:"card p-6 animate-fade-scale bg-gradient-to-br from-yellow-50 to-amber-50",style:{animationDelay:"0.5s"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-yellow-900",children:a("statistics.recentComments",{defaultValue:"Недавние комментарии"})}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-yellow-500 to-amber-500 flex items-center justify-center shadow-glow",children:e.jsx(k,{className:"h-6 w-6 text-white"})})]}),e.jsx("p",{className:"text-2xl md:text-3xl lg:text-4xl font-bold text-yellow-900",children:(s==null?void 0:s.overview.recentComments)||0}),e.jsx("p",{className:"text-xs text-yellow-700 mt-2 font-medium",children:a("statistics.last7Days",{defaultValue:"За последние 7 дней"})})]}),e.jsxs("div",{className:"card p-6 animate-fade-scale bg-gradient-to-br from-orange-50 to-red-50",style:{animationDelay:"0.6s"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-orange-900",children:a("statistics.courseRequests",{defaultValue:"Запросы на курсы"})}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-orange-500 to-red-500 flex items-center justify-center shadow-glow",children:e.jsx(T,{className:"h-6 w-6 text-white"})})]}),e.jsx("p",{className:"text-2xl md:text-3xl lg:text-4xl font-bold text-orange-900",children:(s==null?void 0:s.overview.recentCourseRequests)||0}),e.jsx("p",{className:"text-xs text-orange-700 mt-2 font-medium",children:a("statistics.last7Days",{defaultValue:"За последние 7 дней"})})]})]}),(s==null?void 0:s.courseStats)&&s.courseStats.length>0&&e.jsxs("div",{className:"card p-6 mb-12 animate-fade-scale",style:{animationDelay:"0.7s"},children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gradient mb-4 md:mb-6",children:a("statistics.byCourses",{defaultValue:"Статистика по курсам"})}),e.jsx("div",{className:"space-y-3 md:space-y-4",children:s.courseStats.map((t,l)=>e.jsxs("div",{className:"border border-neutral-200 rounded-lg p-4 bg-neutral-50 animate-slide-in",style:{animationDelay:`${.1*l}s`},children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-2 mb-3",children:[e.jsx("h3",{className:"text-base md:text-lg font-semibold text-neutral-900 break-words",children:t.title}),e.jsxs("div",{className:"text-left sm:text-right",children:[e.jsxs("div",{className:"text-xl md:text-2xl font-bold text-gradient",children:[t.completionRate,"%"]}),e.jsx("div",{className:"text-xs text-neutral-500",children:a("lessons.completed")})]})]}),e.jsx("div",{className:"w-full bg-neutral-200 rounded-full h-2 md:h-2.5 mb-3",children:e.jsx("div",{className:"bg-gradient-primary h-2 md:h-2.5 rounded-full transition-all",style:{width:`${t.completionRate}%`}})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 md:gap-6 text-xs md:text-sm text-neutral-600",children:[e.jsxs("span",{children:[e.jsxs("span",{className:"font-medium",children:[a("students.title"),":"]})," ",t.students]}),e.jsxs("span",{children:[e.jsxs("span",{className:"font-medium",children:[a("lessons.title"),":"]})," ",t.lessons]}),e.jsxs("span",{children:[e.jsxs("span",{className:"font-medium",children:[a("comments.title"),":"]})," ",t.comments]})]})]},t.id))})]}),(s==null?void 0:s.topStudents)&&s.topStudents.length>0&&e.jsxs("div",{className:"card p-6 animate-fade-scale",style:{animationDelay:"0.8s"},children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gradient mb-4 md:mb-6",children:a("statistics.topStudents",{defaultValue:"Топ студентов"})}),e.jsx("div",{className:"space-y-2 md:space-y-3",children:s.topStudents.map((t,l)=>e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-0 p-3 md:p-4 border border-neutral-200 rounded-lg bg-neutral-50 animate-slide-in",style:{animationDelay:`${.05*l}s`},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-gradient-primary text-white font-bold shadow-soft",children:l+1}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-neutral-900",children:[t.student.firstName," ",t.student.lastName]}),e.jsxs("p",{className:"text-xs text-neutral-500",children:[e.jsxs("span",{className:"font-medium",children:[a("lessons.completed"),":"]})," ",t.completed," / ",t.total]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 md:gap-4",children:[e.jsxs("div",{className:"text-left sm:text-right",children:[e.jsxs("div",{className:"text-lg md:text-xl font-bold text-gradient",children:[t.completionRate,"%"]}),e.jsx("div",{className:"text-xs text-neutral-500",children:a("dashboard.overallProgress",{defaultValue:"Прогресс"})})]}),l<3&&e.jsx(V,{className:`h-6 w-6 ${l===0?"text-yellow-500":l===1?"text-neutral-400":"text-orange-500"}`})]})]},t.student.id))})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-12",children:[e.jsxs("div",{className:"card p-6 animate-fade-scale",style:{animationDelay:"0.9s"},children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gradient mb-6",children:"Рост новых пользователей"}),r!=null&&r.data&&r.data.length>0?e.jsx(o,{width:"100%",height:300,children:e.jsxs($,{data:r.data,children:[e.jsx(L,{strokeDasharray:"3 3"}),e.jsx(R,{dataKey:"date",tick:{fontSize:12},angle:-45,textAnchor:"end",height:80}),e.jsx(A,{tick:{fontSize:12}}),e.jsx(h,{labelFormatter:t=>`Дата: ${t}`,formatter:t=>[t,"Новых пользователей"]}),e.jsx(f,{}),e.jsx(E,{type:"monotone",dataKey:"count",stroke:"#3b82f6",strokeWidth:2,name:"Новых пользователей",dot:{fill:"#3b82f6",r:4}})]})}):e.jsx("div",{className:"text-center py-12 text-neutral-500",children:"Нет данных для отображения"})]}),e.jsxs("div",{className:"card p-6 animate-fade-scale",style:{animationDelay:"1s"},children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gradient mb-6",children:"Устройства пользователей"}),n!=null&&n.data&&n.data.length>0?e.jsx(o,{width:"100%",height:300,children:e.jsxs(p,{children:[e.jsx(N,{data:n.data,cx:"50%",cy:"50%",labelLine:!1,label:({name:t,percent:l})=>`${t}: ${((l||0)*100).toFixed(0)}%`,outerRadius:100,fill:"#8884d8",dataKey:"value",children:n.data.map((t,l)=>e.jsx(y,{fill:j[l%j.length]},`cell-${l}`))}),e.jsx(h,{formatter:t=>[t,"Пользователей"]}),e.jsx(f,{})]})}):e.jsx("div",{className:"text-center py-12 text-neutral-500",children:"Нет данных для отображения"})]})]}),e.jsxs("div",{className:"card p-6 animate-fade-scale mb-12",style:{animationDelay:"1.1s"},children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gradient mb-6",children:"Активность студентов"}),i!=null&&i.data&&i.data.length>0?e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(o,{width:"100%",height:300,children:e.jsxs(p,{children:[e.jsx(N,{data:i.data,cx:"50%",cy:"50%",labelLine:!1,label:({name:t,percent:l})=>`${t}: ${((l||0)*100).toFixed(0)}%`,outerRadius:100,fill:"#8884d8",dataKey:"value",children:i.data.map((t,l)=>e.jsx(y,{fill:t.name==="Активные"?"#10b981":"#ef4444"},`cell-${l}`))}),e.jsx(h,{formatter:t=>[t,"Студентов"]}),e.jsx(f,{})]})}),e.jsx("div",{className:"flex flex-col justify-center space-y-4",children:i.data.map((t,l)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-neutral-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:t.name==="Активные"?"#10b981":"#ef4444"}}),e.jsx("span",{className:"font-semibold text-neutral-900",children:t.name})]}),e.jsx("span",{className:"text-2xl font-bold text-gradient",children:t.value})]},l))})]}):e.jsx("div",{className:"text-center py-12 text-neutral-500",children:"Нет данных для отображения"})]})]})}export{I as default};
