import{k as R,ab as k,u as A,d as S,r as p,e as j,f as T,j as e,L as D,aF as P,ac as N,Z as f,a1 as V,z as L}from"./vendor-react-B4b84SyH.js";import{u as O,a as x}from"./index-D6PcLXw1.js";function Q(){const{t}=R(),{lessonId:n}=k();A();const g=S(),{user:l}=O(),[c,i]=p.useState(null),[d,m]=p.useState(""),[$,r]=p.useState(!1),{data:v,isLoading:w}=j(["practiceExercises",n],async()=>(await x.get(`/practice/lessons/${n}`)).data.data||[],{enabled:!!n}),{data:y}=j(["practiceResults",c==null?void 0:c.id],async()=>c?(await x.get(`/practice/${c.id}/results`)).data.data||[]:[],{enabled:!!c&&(l==null?void 0:l.role)==="STUDENT"}),o=T(async s=>(await x.post(`/practice/${s}/submit`,{answer:d})).data.data,{onSuccess:()=>{g.invalidateQueries(["practiceResults",c==null?void 0:c.id]),r(!0),m("")}}),h=v||[],C=y||[],E=(l==null?void 0:l.role)==="TEACHER"||(l==null?void 0:l.role)==="ADMIN"||(l==null?void 0:l.role)==="MODERATOR";return w?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block relative",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-primary-200 border-t-primary-500"})}),e.jsx("p",{className:"mt-4 text-neutral-600",children:"Загрузка упражнений..."})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsx("h1",{className:"text-2xl md:text-3xl lg:text-5xl font-bold text-gradient",children:t("practice.title")}),E&&n&&e.jsxs(D,{to:`/lessons/${n}/practice/new`,className:"btn-primary",children:[e.jsx(P,{className:"h-5 w-5 mr-2"}),"Создать упражнение"]})]}),h.length===0?e.jsxs("div",{className:"text-center py-12 animate-fade-scale",children:[e.jsx(N,{className:"h-16 w-16 text-neutral-300 mx-auto mb-4"}),e.jsx("p",{className:"text-neutral-500",children:t("practice.noExercises")})]}):e.jsx("div",{className:"space-y-6",children:h.map(s=>{const a=C.find(u=>u.exerciseId===s.id),b=(l==null?void 0:l.role)==="STUDENT"&&(!a||a.attemptNumber<s.maxAttempts);return e.jsxs("div",{className:"card p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-semibold text-neutral-900 mb-2",children:s.title}),s.description&&e.jsx("p",{className:"text-neutral-600 mb-4",children:s.description}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-neutral-500 mb-4",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(N,{className:"h-4 w-4"}),s.type]}),s.autoCheck&&e.jsxs("span",{className:"flex items-center gap-1 text-green-600",children:[e.jsx(f,{className:"h-4 w-4"}),"Автопроверка"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(V,{className:"h-4 w-4"}),t("practice.attempts"),": ",(a==null?void 0:a.attemptNumber)||0,"/",s.maxAttempts]})]}),a&&e.jsxs("div",{className:`p-3 rounded-lg mb-4 ${a.status==="APPROVED"?"bg-green-50 border border-green-200":a.status==="REJECTED"?"bg-red-50 border border-red-200":"bg-yellow-50 border border-yellow-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.status==="APPROVED"?e.jsx(f,{className:"h-5 w-5 text-green-600"}):e.jsx(L,{className:"h-5 w-5 text-yellow-600"}),e.jsx("span",{className:"font-medium",children:a.status==="APPROVED"?t("practice.approved"):a.status==="REJECTED"?t("practice.rejected"):t("practice.pending")}),a.score!==null&&e.jsxs("span",{className:"ml-auto",children:[t("practice.score"),": ",a.score,"%"]})]}),a.feedback&&e.jsx("p",{className:"text-sm",children:a.feedback})]})]})}),(c==null?void 0:c.id)===s.id?e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:t("practice.instructions")}),e.jsx("div",{className:"p-4 bg-neutral-50 rounded-lg",children:e.jsx("p",{className:"text-neutral-700 whitespace-pre-line",children:s.instructions})})]}),b&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:t("practice.yourAnswer")}),e.jsx("textarea",{value:d,onChange:u=>m(u.target.value),placeholder:t("practice.enterAnswer",{defaultValue:"Введите ваш ответ..."}),rows:6,className:"input-field"}),e.jsxs("div",{className:"flex gap-3 mt-4",children:[e.jsx("button",{onClick:()=>o.mutate(s.id),disabled:!d.trim()||o.isLoading,className:"btn-primary disabled:opacity-50",children:o.isLoading?t("common.loading"):t("practice.submit")}),e.jsx("button",{onClick:()=>{i(null),m(""),r(!1)},className:"btn-secondary",children:t("common.cancel")})]})]})]}):e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{i(s),r(!1)},className:"btn-primary",children:b?t("practice.execute",{defaultValue:"Выполнить"}):t("practice.view",{defaultValue:"Просмотреть"})}),a&&e.jsx("button",{onClick:()=>{i(s),r(!0)},className:"btn-secondary",children:t("practice.myResults",{defaultValue:"Мои результаты"})})]})]},s.id)})})]})}export{Q as default};
