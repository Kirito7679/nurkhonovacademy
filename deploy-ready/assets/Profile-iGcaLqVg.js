import{k as V,u as W,r as i,e as J,f as S,V as E,j as e,U as Z,as as H,at as K,au as X,aa as Y,$ as U,a0 as $,a1 as n,av as _}from"./vendor-D-riqg-X.js";import{u as ee,a as h}from"./index-CVGNmkiu.js";import{S as se}from"./SuccessModal-2VojkkiP.js";import{F as ae}from"./FileUploadProgress-YX5frkCv.js";const te=/^(\+?998)?[0-9]{9}$/,le=/^(?=.*[A-Za-z])(?=.*\d).{6,}$/,re=$({firstName:n().min(1,"Ð˜Ð¼Ñ Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾").max(50,"Ð˜Ð¼Ñ ÑÐ»Ð¸ÑˆÐºÐ¾Ð¼ Ð´Ð»Ð¸Ð½Ð½Ð¾Ðµ"),lastName:n().min(1,"Ð¤Ð°Ð¼Ð¸Ð»Ð¸Ñ Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð°").max(50,"Ð¤Ð°Ð¼Ð¸Ð»Ð¸Ñ ÑÐ»Ð¸ÑˆÐºÐ¾Ð¼ Ð´Ð»Ð¸Ð½Ð½Ð°Ñ"),phone:n().min(10,"ÐÐ¾Ð¼ÐµÑ€ Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½Ð° Ð´Ð¾Ð»Ð¶ÐµÐ½ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ Ð¼Ð¸Ð½Ð¸Ð¼ÑƒÐ¼ 10 ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð²").max(15,"ÐÐ¾Ð¼ÐµÑ€ Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½Ð° ÑÐ»Ð¸ÑˆÐºÐ¾Ð¼ Ð´Ð»Ð¸Ð½Ð½Ñ‹Ð¹").regex(te,"ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ Ð½Ð¾Ð¼ÐµÑ€Ð° Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½Ð°").optional(),email:n().email("ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ email").optional().or(_("")),language:n().optional()}),ne=$({currentPassword:n().min(1,"Ð¢ÐµÐºÑƒÑ‰Ð¸Ð¹ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÐµÐ½"),newPassword:n().min(6,"ÐÐ¾Ð²Ñ‹Ð¹ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ Ð´Ð¾Ð»Ð¶ÐµÐ½ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ Ð¼Ð¸Ð½Ð¸Ð¼ÑƒÐ¼ 6 ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð²").regex(le,"ÐŸÐ°Ñ€Ð¾Ð»ÑŒ Ð´Ð¾Ð»Ð¶ÐµÐ½ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ Ð±ÑƒÐºÐ²Ñ‹ Ð¸ Ñ†Ð¸Ñ„Ñ€Ñ‹"),confirmPassword:n().min(6,"ÐŸÐ¾Ð´Ñ‚Ð²ÐµÑ€Ð¶Ð´ÐµÐ½Ð¸Ðµ Ð¿Ð°Ñ€Ð¾Ð»Ñ Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾")}).refine(g=>g.newPassword===g.confirmPassword,{message:"ÐŸÐ°Ñ€Ð¾Ð»Ð¸ Ð½Ðµ ÑÐ¾Ð²Ð¿Ð°Ð´Ð°ÑŽÑ‚",path:["confirmPassword"]});function de(){const{t:g,i18n:f}=V(),{user:T,updateUser:k}=ee(),M=W(),[F,l]=i.useState(""),[m,N]=i.useState(!1),[u,j]=i.useState(null),[z,p]=i.useState(!1),[A,b]=i.useState(""),[L,w]=i.useState(""),C=i.useRef(null),{data:a}=J("me",async()=>(await h.get("/auth/me")).data.data,{initialData:T||void 0}),y=S(async s=>(await h.put("/auth/me",s)).data.data,{onSuccess:s=>{s&&(k(s),b("ÐŸÑ€Ð¾Ñ„Ð¸Ð»ÑŒ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½"),w("ÐŸÑ€Ð¾Ñ„Ð¸Ð»ÑŒ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½"),p(!0),l(""))},onError:s=>{s.isNetworkError?l("ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐµÑ‚Ð¸. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ðº Ð¸Ð½Ñ‚ÐµÑ€Ð½ÐµÑ‚Ñƒ Ð¸ Ð¿Ð¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ ÑÐ½Ð¾Ð²Ð°."):s.isTimeout?l("ÐŸÑ€ÐµÐ²Ñ‹ÑˆÐµÐ½Ð¾ Ð²Ñ€ÐµÐ¼Ñ Ð¾Ð¶Ð¸Ð´Ð°Ð½Ð¸Ñ. ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ ÑÐ½Ð¾Ð²Ð°."):l(s.response?.data?.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ð¸ Ð¿Ñ€Ð¾Ñ„Ð¸Ð»Ñ")}}),v=S(async s=>(await h.put("/auth/me/password",s)).data,{onSuccess:()=>{b("ÐŸÐ°Ñ€Ð¾Ð»ÑŒ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½"),w("ÐŸÐ°Ñ€Ð¾Ð»ÑŒ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½"),p(!0),l("")},onError:s=>{s.isNetworkError?l("ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐµÑ‚Ð¸. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ðº Ð¸Ð½Ñ‚ÐµÑ€Ð½ÐµÑ‚Ñƒ Ð¸ Ð¿Ð¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ ÑÐ½Ð¾Ð²Ð°."):s.isTimeout?l("ÐŸÑ€ÐµÐ²Ñ‹ÑˆÐµÐ½Ð¾ Ð²Ñ€ÐµÐ¼Ñ Ð¾Ð¶Ð¸Ð´Ð°Ð½Ð¸Ñ. ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ ÑÐ½Ð¾Ð²Ð°."):l(s.response?.data?.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ ÑÐ¼ÐµÐ½Ðµ Ð¿Ð°Ñ€Ð¾Ð»Ñ")}}),R=S(async s=>{const t=new FormData;return t.append("avatar",s),(await h.post("/auth/me/avatar",t,{onUploadProgress:d=>{if(d.total){const x=Math.round(d.loaded*100/d.total);j({fileName:s.name,progress:x})}}})).data.data},{onSuccess:s=>{s&&(k(s),M.setQueryData("me",s),M.invalidateQueries("me"),b("Ð£ÑÐ¿ÐµÑˆÐ½Ð¾!"),w("Ð¤Ð¾Ñ‚Ð¾ Ð¿Ñ€Ð¾Ñ„Ð¸Ð»Ñ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ð¾"),p(!0),l("")),N(!1),j(null)},onError:s=>{l(s.response?.data?.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐµ Ñ„Ð¾Ñ‚Ð¾"),N(!1),j(null)}}),G=s=>{const t=s.target.files?.[0];if(!t)return;const D=["image/jpeg","image/jpg","image/png","image/gif","image/webp"],d=/\.(jpg|jpeg|png|gif|webp)$/i;if(!D.includes(t.type)&&!d.test(t.name)){l("Ð Ð°Ð·Ñ€ÐµÑˆÐµÐ½Ñ‹ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ (JPEG, PNG, GIF, WebP)"),s.target.value="";return}const x=5*1024*1024;if(t.size>x){l(`Ð Ð°Ð·Ð¼ÐµÑ€ Ñ„Ð°Ð¹Ð»Ð° Ð½Ðµ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð¿Ñ€ÐµÐ²Ñ‹ÑˆÐ°Ñ‚ÑŒ ${(x/1024/1024).toFixed(0)} MB. Ð¢ÐµÐºÑƒÑ‰Ð¸Ð¹ Ñ€Ð°Ð·Ð¼ÐµÑ€: ${(t.size/1024/1024).toFixed(2)} MB`),s.target.value="";return}N(!0),l(""),R.mutate(t)},{register:c,handleSubmit:I,formState:{errors:r}}=E({resolver:U(re),defaultValues:{firstName:a?.firstName||"",lastName:a?.lastName||"",phone:a?.phone||"",email:a?.email||"",language:a?.language||f.language||"ru"}}),{register:P,handleSubmit:Q,formState:{errors:o},reset:q}=E({resolver:U(ne)}),B=async s=>{y.mutate(s),s.language&&s.language!==f.language&&(await f.changeLanguage(s.language),localStorage.setItem("i18nextLng",s.language))},O=s=>{v.mutate({currentPassword:s.currentPassword,newPassword:s.newPassword}),q()};return e.jsxs("div",{className:"max-w-2xl",children:[e.jsxs("div",{className:"relative mb-8 animate-slide-in",children:[e.jsx("h1",{className:"text-2xl md:text-3xl lg:text-5xl font-bold text-gradient",children:"ÐŸÑ€Ð¾Ñ„Ð¸Ð»ÑŒ"}),a?.coins!==void 0&&e.jsxs("div",{className:"mt-4 inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-yellow-50 to-amber-50 border-2 border-yellow-300 rounded-lg",children:[e.jsx("span",{className:"text-2xl",children:"ðŸª™"}),e.jsxs("span",{className:"text-lg font-bold text-yellow-700",children:[a.coins," ÐºÐ¾Ð¸Ð½Ð¾Ð²"]})]})]}),F&&e.jsx("div",{className:"mb-6 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg animate-fade-scale",children:F}),e.jsxs("div",{className:"card p-4 md:p-6 mb-4 md:mb-6 animate-fade-scale",style:{animationDelay:"0.1s"},children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center sm:items-start gap-4 mb-4 md:mb-6",children:[e.jsxs("div",{className:"relative group",children:[e.jsxs("label",{htmlFor:"avatar-upload-input",className:"flex items-center justify-center w-20 h-20 md:w-24 md:h-24 rounded-full bg-gradient-primary text-white shadow-soft overflow-hidden cursor-pointer relative",children:[a?.avatarUrl?e.jsx("img",{src:a.avatarUrl?.startsWith("http")?a.avatarUrl:`${"https://api.academy.dilmurodnurkhonov.uz/api".replace("/api","")||"https://api.academy.dilmurodnurkhonov.uz"}${a.avatarUrl}`,alt:`${a.firstName} ${a.lastName}`,className:"w-full h-full object-cover",loading:"lazy",onError:s=>{console.error("Error loading avatar:",a.avatarUrl),s.currentTarget.style.display="none";const t=s.currentTarget.parentElement?.querySelector(".avatar-fallback-icon");t&&(t.style.display="block")}},a.avatarUrl):null,!a?.avatarUrl&&e.jsx(Z,{className:"h-12 w-12 avatar-fallback-icon"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity rounded-full pointer-events-none",children:m?e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-white border-t-transparent"}):e.jsx(H,{className:"h-8 w-8 text-white"})})]}),e.jsx("input",{ref:C,type:"file",accept:"image/jpeg,image/jpg,image/png,image/gif,image/webp",onChange:G,disabled:m,style:{position:"absolute",width:0,height:0,opacity:0,overflow:"hidden",zIndex:-1,pointerEvents:m?"none":"auto"},id:"avatar-upload-input"})]}),e.jsxs("div",{className:"flex-1 text-center sm:text-left",children:[e.jsxs("h2",{className:"text-base md:text-xl font-semibold text-neutral-900 break-words",children:[a?.firstName," ",a?.lastName]}),e.jsx("p",{className:"text-sm md:text-base text-neutral-600 break-words",children:a?.phone}),u&&e.jsx("div",{className:"mt-2",children:e.jsx(ae,{fileName:u.fileName,progress:u.progress})}),!u&&e.jsxs("label",{htmlFor:"avatar-upload-input",className:`mt-2 flex items-center gap-2 text-sm text-neutral-600 hover:text-primary-600 transition-colors cursor-pointer ${m?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx(K,{className:"h-4 w-4"}),e.jsx("span",{children:m?"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ°...":"Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ñ„Ð¾Ñ‚Ð¾"})]})]})]}),e.jsxs("form",{onSubmit:I(B),className:"space-y-4",children:[e.jsxs("div",{className:"animate-slide-in",style:{animationDelay:"0.2s"},children:[e.jsx("label",{htmlFor:"firstName",className:"block text-sm font-medium text-neutral-700 mb-2",children:"Ð˜Ð¼Ñ"}),e.jsx("input",{...c("firstName"),type:"text",className:"input-field",placeholder:"Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð¸Ð¼Ñ"}),r.firstName&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.firstName.message})]}),e.jsxs("div",{className:"animate-slide-in",style:{animationDelay:"0.3s"},children:[e.jsx("label",{htmlFor:"lastName",className:"block text-sm font-medium text-neutral-700 mb-2",children:"Ð¤Ð°Ð¼Ð¸Ð»Ð¸Ñ"}),e.jsx("input",{...c("lastName"),type:"text",className:"input-field",placeholder:"Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ñ„Ð°Ð¼Ð¸Ð»Ð¸ÑŽ"}),r.lastName&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.lastName.message})]}),e.jsxs("div",{className:"animate-slide-in",style:{animationDelay:"0.4s"},children:[e.jsx("label",{htmlFor:"phone",className:"block text-sm font-medium text-neutral-700 mb-2",children:"Ð¢ÐµÐ»ÐµÑ„Ð¾Ð½"}),e.jsx("input",{...c("phone"),type:"text",className:"input-field",placeholder:"+998901234567"}),r.phone&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.phone.message})]}),e.jsxs("div",{className:"animate-slide-in",style:{animationDelay:"0.5s"},children:[e.jsxs("label",{htmlFor:"email",className:"block text-sm font-medium text-neutral-700 mb-2",children:["Email ",e.jsx("span",{className:"text-neutral-500 text-xs",children:"(Ð½ÐµÐ¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾)"})]}),e.jsx("input",{...c("email"),type:"email",className:"input-field",placeholder:"email@example.com"}),r.email&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.email.message})]}),e.jsxs("div",{className:"animate-slide-in",style:{animationDelay:"0.55s"},children:[e.jsxs("label",{htmlFor:"language",className:"block text-sm font-medium text-neutral-700 mb-2",children:[e.jsx(X,{className:"h-4 w-4 inline mr-2"}),"Ð¯Ð·Ñ‹Ðº Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ°"]}),e.jsxs("select",{...c("language"),className:"input-field",children:[e.jsx("option",{value:"ru",children:"ðŸ‡·ðŸ‡º Ð ÑƒÑÑÐºÐ¸Ð¹"}),e.jsx("option",{value:"en",children:"ðŸ‡ºðŸ‡¸ English"}),e.jsx("option",{value:"uz",children:"ðŸ‡ºðŸ‡¿ O'zbek"}),e.jsx("option",{value:"kk",children:"ðŸ‡°ðŸ‡¿ ÒšÐ°Ð·Ð°Ò›ÑˆÐ°"})]}),r.language&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.language.message})]}),e.jsx("div",{className:"animate-slide-in",style:{animationDelay:"0.6s"},children:e.jsx("button",{type:"submit",disabled:y.isLoading,className:"btn-primary w-full disabled:opacity-50 disabled:cursor-not-allowed",children:y.isLoading?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"animate-spin",children:"âŸ³"}),e.jsx("span",{children:"Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ..."})]}):"Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ"})})]})]}),e.jsxs("div",{className:"card p-6 animate-fade-scale",style:{animationDelay:"0.7s"},children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(Y,{className:"h-6 w-6 text-primary-500 mr-3"}),e.jsx("h2",{className:"text-xl font-semibold text-neutral-900",children:"Ð˜Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ"})]}),e.jsxs("form",{onSubmit:Q(O),className:"space-y-4",children:[e.jsxs("div",{className:"animate-slide-in",style:{animationDelay:"0.8s"},children:[e.jsx("label",{htmlFor:"currentPassword",className:"block text-sm font-medium text-neutral-700 mb-2",children:"Ð¢ÐµÐºÑƒÑ‰Ð¸Ð¹ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ"}),e.jsx("input",{...P("currentPassword"),type:"password",className:"input-field",placeholder:"Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ñ‚ÐµÐºÑƒÑ‰Ð¸Ð¹ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ"}),o.currentPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.currentPassword.message})]}),e.jsxs("div",{className:"animate-slide-in",style:{animationDelay:"0.9s"},children:[e.jsx("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-neutral-700 mb-2",children:"ÐÐ¾Ð²Ñ‹Ð¹ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ"}),e.jsx("input",{...P("newPassword"),type:"password",className:"input-field",placeholder:"Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð½Ð¾Ð²Ñ‹Ð¹ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ"}),o.newPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.newPassword.message})]}),e.jsxs("div",{className:"animate-slide-in",style:{animationDelay:"1s"},children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-neutral-700 mb-2",children:"ÐŸÐ¾Ð´Ñ‚Ð²ÐµÑ€Ð´Ð¸Ñ‚Ðµ Ð½Ð¾Ð²Ñ‹Ð¹ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ"}),e.jsx("input",{...P("confirmPassword"),type:"password",className:"input-field",placeholder:"ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚Ðµ Ð½Ð¾Ð²Ñ‹Ð¹ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ"}),o.confirmPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.confirmPassword.message})]}),e.jsx("div",{className:"animate-slide-in",style:{animationDelay:"1.1s"},children:e.jsx("button",{type:"submit",disabled:v.isLoading,className:"btn-primary w-full disabled:opacity-50 disabled:cursor-not-allowed",children:v.isLoading?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"animate-spin",children:"âŸ³"}),e.jsx("span",{children:"ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ..."})]}):"Ð˜Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ"})})]})]}),e.jsx(se,{isOpen:z,onClose:()=>p(!1),title:A,message:L})]})}export{de as default};
